(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,function(e,t,i){"use strict";i(63),i(27);var s=i(14);i.d(t,"CenterApi",function(){return s.a}),i.d(t,"UnitxApi",function(){return s.c}),i.d(t,"UqApi",function(){return s.d}),i.d(t,"appInFrame",function(){return s.f}),i.d(t,"getExHash",function(){return s.g}),i.d(t,"loadAppUqs",function(){return s.k}),i.d(t,"postWsToTop",function(){return s.m});var r=i(16);i.o(r,"Controller")&&i.d(t,"Controller",function(){return r.Controller}),i.o(r,"Field")&&i.d(t,"Field",function(){return r.Field}),i.o(r,"Form")&&i.d(t,"Form",function(){return r.Form}),i.o(r,"Image")&&i.d(t,"Image",function(){return r.Image}),i.o(r,"Loading")&&i.d(t,"Loading",function(){return r.Loading}),i.o(r,"NavView")&&i.d(t,"NavView",function(){return r.NavView}),i.o(r,"Page")&&i.d(t,"Page",function(){return r.Page}),i.o(r,"TabCaptionComponent")&&i.d(t,"TabCaptionComponent",function(){return r.TabCaptionComponent}),i.o(r,"Tabs")&&i.d(t,"Tabs",function(){return r.Tabs}),i.o(r,"VPage")&&i.d(t,"VPage",function(){return r.VPage}),i.o(r,"View")&&i.d(t,"View",function(){return r.View}),i.o(r,"nav")&&i.d(t,"nav",function(){return r.nav}),i.o(r,"resLang")&&i.d(t,"resLang",function(){return r.resLang});i(28);var n=i(70);i.d(t,"PageItems",function(){return n.a});i(71),i(90)},function(e,t,i){"use strict";var s=i(46);i.o(s,"EasyDate")&&i.d(t,"EasyDate",function(){return s.EasyDate}),i.o(s,"FA")&&i.d(t,"FA",function(){return s.FA}),i.o(s,"IconText")&&i.d(t,"IconText",function(){return s.IconText}),i.o(s,"LMR")&&i.d(t,"LMR",function(){return s.LMR}),i.o(s,"List")&&i.d(t,"List",function(){return s.List}),i.o(s,"Media")&&i.d(t,"Media",function(){return s.Media}),i.o(s,"Muted")&&i.d(t,"Muted",function(){return s.Muted}),i.o(s,"PropGrid")&&i.d(t,"PropGrid",function(){return s.PropGrid}),i.o(s,"SearchBox")&&i.d(t,"SearchBox",function(){return s.SearchBox});var r=i(84);i.d(t,"List",function(){return r.a});i(76);var n=i(77);i.d(t,"EasyDate",function(){return n.a});var a=i(85);i.d(t,"PropGrid",function(){return a.a});var o=i(83);i.d(t,"FA",function(){return o.a}),i.d(t,"IconText",function(){return o.b}),i.d(t,"LMR",function(){return o.c}),i.d(t,"Muted",function(){return o.d});var l=i(78);i.d(t,"Media",function(){return l.a});i(88);var c=i(79);i.d(t,"SearchBox",function(){return c.a});i(80),i(23)},,,,function(e,t,i){"use strict";i.d(t,"startApp",function(){return o});var s=i(1),r=i(0),n=i(34);i(36);i.o(n,"CApp")&&i.d(t,"CApp",function(){return n.CApp}),i.o(n,"CSheet")&&i.d(t,"CSheet",function(){return n.CSheet}),i.o(n,"CTuidEdit")&&i.d(t,"CTuidEdit",function(){return n.CTuidEdit}),i.o(n,"CTuidList")&&i.d(t,"CTuidList",function(){return n.CTuidList}),i.o(n,"CTuidMain")&&i.d(t,"CTuidMain",function(){return n.CTuidMain}),i.o(n,"CTuidSelect")&&i.d(t,"CTuidSelect",function(){return n.CTuidSelect}),i.o(n,"VEntity")&&i.d(t,"VEntity",function(){return n.VEntity}),i.o(n,"VTuidEdit")&&i.d(t,"VTuidEdit",function(){return n.VTuidEdit}),i.o(n,"VTuidMain")&&i.d(t,"VTuidMain",function(){return n.VTuidMain}),i.o(n,"VTuidMainList")&&i.d(t,"VTuidMainList",function(){return n.VTuidMainList}),i.o(n,"VTuidSelect")&&i.d(t,"VTuidSelect",function(){return n.VTuidSelect}),i.o(n,"tv")&&i.d(t,"tv",function(){return n.tv});i(50);var a=i(15);function o(e){return s.a(this,void 0,void 0,function*(){!function e(t){for(let i in t){let s=t[i];if(t[i.toLowerCase()]=s,"object"===typeof s&&!r.isValidElement(s))if(!0===Array.isArray(s))for(let t of s)e(t);else e(s)}}(e);let t=new(e&&e.CApp||n.CApp)(e);yield t.start()})}i.d(t,"tv",function(){return a.b})},function(e,t,i){"use strict";i.d(t,"a",function(){return l}),i.d(t,"b",function(){return c});var s=i(1),r=i(2),n=i(30),a=i(48),o=i(49);class l extends o.a{constructor(e,t,i,s){super(e,s),Object.setPrototypeOf(this.x,e.x);let{name:r,typeName:n}=t;this.entity=t,this.ui=i,this.label=this.res.label||r,this.icon=a.a[n]}beforeStart(){return s.a(this,void 0,void 0,function*(){return yield this.entity.loadSchema(),!0})}createForm(e,t,i){let s=this.buildFormOptions(i),r=new n.b(s,e);return r.setValues(t),r}buildFormOptions(e){let t,i,s,r,a,{fields:o,arrFields:l}=this.entity;void 0!==this.res&&(t=this.res.none,i=this.res.submit,s=this.res.arrNew,r=this.res.arrEdit,a=this.res.arrTitleNewButton),void 0===t&&(t=this.cUq.res.none||"none"),void 0===i&&(i=this.cUq.res.submit||"Submit"),void 0===s&&(s=this.cUq.res.arrNew||"New"),void 0===r&&(r=this.cUq.res.arrEdit||"Edit"),void 0===a&&(a=this.cUq.res.arrTitleNewButton),void 0===e&&(e=n.a.new);let c=this.ui.form;return{fields:o,arrs:l,ui:c,res:this.res||{},inputs:this.buildInputs(c),none:t,submitCaption:i,arrNewCaption:s,arrEditCaption:r,arrTitleNewButton:a,mode:e}}buildInputs(e){let{fields:t,arrFields:i}=this.entity,s={};if(this.buildFieldsInputs(s,t,void 0,e),void 0!==i)for(let r of i){let{name:t,fields:i}=r,n=e&&e.items;this.buildFieldsInputs(s,i,t,n&&n[t])}return s}buildFieldsInputs(e,t,i,s){if(void 0!==i){let t=e[i];void 0===t&&(e[i]=t={},e=t)}for(let r of t){let{name:t,_tuid:n}=r;if(void 0===n)continue;let a=s&&s.items&&s.items[t];e[t]={select:this.buildSelect(r,i,a),content:this.buildContent(r,i),placeHolder:this.cUq.getTuidPlaceHolder(n)}}}buildSelect(e,t,i){return(e,t,r)=>s.a(this,void 0,void 0,function*(){let{_tuid:s,_ownerField:r}=t,n=yield s.cSelectFrom(),a=void 0;void 0!==r&&(a=e.getValue(r.name)),i&&!0===i.autoList&&(console.log("select search set param=empty string"),a="");let o=yield n.call(a);if(n.removeCeased(),void 0===o)return;let l=n.idFromItem(o);return s.useId(l),l})}buildContent(e,t){}cQuerySelect(e){return this.cUq.cQuerySelect(e)}}class c extends r.VPage{constructor(e){super(e),this.entity=e.entity,this.ui=e.ui}get label(){return this.controller.label}createForm(e,t,i){return this.controller.createForm(e,t,i)}}},,function(e,t,i){"use strict";i.d(t,"d",function(){return a}),i.d(t,"b",function(){return o}),i.d(t,"a",function(){return l}),i.d(t,"c",function(){return c});var s=i(0),r=i(6),n=i(15);class a{render(e){return void 0===this.view?s.createElement("div",null,"??? viewModel \u5fc5\u987b\u5b9a\u4e49 view ???"):s.createElement(this.view,{vm:this,className:e})}}const o=(e,t)=>s.createElement(s.Fragment,null,"content: ",Object(n.a)(e)),l=Object(r.a)(o),c=e=>s.createElement("div",{className:"px-3 py-2"},Object(n.a)(e))},function(e,t,i){"use strict";(function(e){i.d(t,"b",function(){return v}),i.d(t,"a",function(){return y}),i.d(t,"c",function(){return E});var s=i(1),r=i(0),n=i(4),a=i(22),o=i(60),l=i(91),c=i(17),d=i(92),h=i(14),u=i(21),m=i(33),p=i(43);i(65),i(97),i(113),i(115);const v=new RegExp("Android|webOS|iPhone|iPad|BlackBerry|Windows Phone|Opera Mini|IEMobile|Mobile","i").test(navigator.userAgent)?{minHeight:"3em"}:void 0;i(98);let f;const g=[];let b=1;class y extends r.Component{constructor(e){super(e),this.waitCount=0,this.isHistoryBack=!1,this.clearError=(()=>{this.setState({fetchError:void 0})}),this.back=this.back.bind(this),this.navBack=this.navBack.bind(this),this.stack=[],this.state={stack:this.stack,wait:0,fetchError:void 0}}componentWillMount(){return s.a(this,void 0,void 0,function*(){window.addEventListener("popstate",this.navBack)})}componentDidMount(){return s.a(this,void 0,void 0,function*(){E.set(this),yield E.start()})}get level(){return this.stack.length}startWait(){0===this.waitCount&&(this.setState({wait:1}),this.waitTimeHandler=e.setTimeout(()=>{this.waitTimeHandler=void 0,this.setState({wait:2})},1e3)),++this.waitCount,this.setState({fetchError:void 0})}endWait(){setTimeout(()=>{--this.waitCount,0===this.waitCount&&(void 0!==this.waitTimeHandler&&(clearTimeout(this.waitTimeHandler),this.waitTimeHandler=void 0),this.setState({wait:0}))},100)}onError(e){return s.a(this,void 0,void 0,function*(){let t=e.error;void 0===t||!0!==t.unauthorized?this.setState({fetchError:e}):yield E.showLogin(void 0)})}show(e,t){return this.clear(),this.push(e,t)}push(e,t){this.removeCeased(),this.stack.length>0&&window.history.pushState("forward",null,null);let i=b++;return this.stack.push({key:i,view:e,ceased:!1,disposer:t}),this.refresh(),i}replace(e,t){let i=void 0,s=this.stack;s.length>0&&(i=s.pop());let r=b++;return this.stack.push({key:r,view:e,ceased:!1,disposer:t}),void 0!==i&&this.dispose(i.disposer),this.refresh(),r}ceaseTop(e=1){let t=this.stack.length-1;for(let i=0;i<e&&!(t<0);i++,t--){this.stack[t].ceased=!0}}pop(e=1){let t=this.stack,i=t.length;if(e<=0||i<=1)return;i<e&&(e=i);let s=0;for(let r=0;r<e&&0!==t.length;r++)this.popAndDispose(),++s;s>=i&&s--,this.refresh(),this.isHistoryBack}popTo(e){if(void 0!==e&&void 0!==this.stack.find(t=>t.key===e))for(;this.stack.length>0;){let t=this.stack.length;if(this.stack[t-1].key===e)break;this.pop()}}topKey(){let e=this.stack.length;if(0!==e)return this.stack[e-1].key}removeCeased(){for(;;){let e=this.stack.length-1;if(e<0)break;if(!1===this.stack[e].ceased)break;let t=this.stack.pop(),{disposer:i}=t;this.dispose(i)}this.refresh()}popAndDispose(){this.removeCeased();let e=this.stack.pop();if(void 0===e)return;let{disposer:t}=e;return this.dispose(t),this.removeCeased(),e}dispose(e){if(void 0===e)return;void 0===this.stack.find(t=>t.disposer===e)&&e()}clear(){this.stack.length;for(;this.stack.length>0;)this.popAndDispose()}regConfirmClose(e){let t=this.stack,i=t.length;0!==i&&(t[i-1].confirmClose=e)}navBack(){E.log("backbutton pressed - nav level: "+this.stack.length),this.isHistoryBack=!0,this.back(!0),this.isHistoryBack=!1}back(e=!0){return s.a(this,void 0,void 0,function*(){let t=this.stack,i=t.length;if(0===i)return;if(1===i)return void(self!=window.top&&window.top.postMessage({type:"pop-app"},"*"));let s=t[i-1];!0===e&&s.confirmClose?!0===(yield s.confirmClose())&&this.pop():this.pop()})}confirmBox(e){return window.confirm(e)}render(){const{wait:e,fetchError:t}=this.state;let i=this.state.stack,s=i.length-1,n=null,a=null;switch(e){case 1:n=r.createElement("li",{className:"va-wait va-wait1"});break;case 2:n=r.createElement("li",{className:"va-wait va-wait2"},r.createElement(p.a,null))}return t&&(a=r.createElement(l.a,Object.assign({clearError:this.clearError},t))),r.createElement("ul",{className:"va"},i.map((e,t)=>{let{key:i,view:n}=e;return r.createElement("li",{key:i,style:t<s?{visibility:"hidden"}:void 0},n)}),n,a)}refresh(){this.setState({stack:this.stack})}}class w{constructor(){this.local=new d.a,this.user=void 0;let{lang:e,district:t}=m.b;this.language=e,this.culture=t}get guest(){let e=this.local.guest;if(void 0===e)return 0;let t=e.get();return void 0===t?0:t.guest}set(e){this.nav=e}registerReceiveHandler(e){if(void 0!==this.ws)return this.ws.onWsReceiveAny(e)}unregisterReceiveHandler(e){void 0!==this.ws&&void 0!==e&&this.ws.endWsReceive(e)}onReceive(e){return s.a(this,void 0,void 0,function*(){void 0!==this.ws&&(yield this.ws.receive(e))})}getPredefinedUnitName(){return s.a(this,void 0,void 0,function*(){try{let t=yield fetch("unit.json",{});return(yield t.json()).unit}catch(e){return void this.local.unit.clear()}})}loadPredefinedUnit(){return s.a(this,void 0,void 0,function*(){let e,t=this.local.unit.get();if(void 0!==t){if(!0!==h.j)return t.id;if(void 0===(e=yield this.getPredefinedUnitName()))return;if(t.name===e)return t.id}else if(void 0===(e=yield this.getPredefinedUnitName()))return;let i=yield h.h.unitFromName(e);return void 0!==i&&this.local.unit.set({id:i,name:e}),i})}setSettings(e){this.navSettings=e}start(){return s.a(this,void 0,void 0,function*(){try{let t=document.location.hash;if(void 0!==t&&t.length>0){let e=Object(c.f)();e<0&&(e=void 0),this.hashParam=t.substring(1,e)}E.clear(),this.startWait(),yield h.i.start();let{url:i,ws:s,resHost:r}=h.i;this.centerHost=i,this.resUrl="http://"+r+"/res/",this.wsHost=s,Object(h.p)(i);let n=this.local.guest.get();void 0===n&&(n=yield h.h.guest()),E.setGuest(n);let a=Object(c.e)(),o=Object(c.i)(a);if(void 0!==a&&window!==window.parent&&void 0!==o)return this.ws=u.d,console.log("this.ws = wsBridge in sub frame"),void(self!==window.parent&&window.parent.postMessage({type:"sub-frame-started",hash:o.hash},"*"));let l=yield this.loadPredefinedUnit();o.predefinedUnit=l;let d=this.local.user.get();if(void 0===d){let{notLogined:e}=this.nav.props;return void(void 0!==e?yield e():yield E.showLogin(void 0))}yield E.logined(d)}catch(e){}finally{this.endWait()}})}showAppView(){return s.a(this,void 0,void 0,function*(){let{onLogined:e}=this.nav.props;void 0!==e?(E.clear(),yield e(),console.log("logined: AppView shown")):E.push(r.createElement("div",null,"NavView has no prop onLogined"))})}setGuest(e){this.local.guest.set(e),o.a.set(0,e.token)}saveLocalUser(){this.local.user.set(this.user)}logined(e,t){return s.a(this,void 0,void 0,function*(){Object(h.l)(),(this.ws=new h.e(this.wsHost,e.token)).connect(),console.log("logined: %s",JSON.stringify(e)),this.user=e,this.saveLocalUser(),o.a.set(e.id,e.token),void 0!==t?t(e):yield this.showAppView()})}loginTop(e){return this.navSettings&&this.navSettings.loginTop||e}showLogin(e,t){return s.a(this,void 0,void 0,function*(){let s=yield i.e(1).then(i.bind(null,133)),n=r.createElement(s.default,{withBack:t,callback:e});!0!==t&&(this.nav.clear(),this.pop()),this.nav.push(n)})}showLogout(e){return s.a(this,void 0,void 0,function*(){E.push(r.createElement(a.a,{header:"\u5b89\u5168\u9000\u51fa",back:"close"},r.createElement("div",{className:"m-5 border border-info bg-white rounded p-3 text-center"},r.createElement("div",null,"\u9000\u51fa\u5f53\u524d\u8d26\u53f7\u4e0d\u4f1a\u5220\u9664\u4efb\u4f55\u5386\u53f2\u6570\u636e\uff0c\u4e0b\u6b21\u767b\u5f55\u4f9d\u7136\u53ef\u4ee5\u4f7f\u7528\u672c\u8d26\u53f7"),r.createElement("div",{className:"mt-3"},r.createElement("button",{className:"btn btn-danger",onClick:()=>this.logout(e)},"\u9000\u51fa")))))})}logout(e){return s.a(this,void 0,void 0,function*(){h.f.unit=void 0,this.local.logoutClear(),this.user=void 0,Object(h.l)();let t=this.local.guest.get();Object(h.o)(0,t&&t.token),this.ws=void 0,void 0===e?yield E.start():yield e()})}changePassword(){return s.a(this,void 0,void 0,function*(){let e=yield i.e(2).then(i.bind(null,132));E.push(r.createElement(e.ChangePasswordPage,null))})}get level(){return this.nav.level}startWait(){this.nav.startWait()}endWait(){this.nav.endWait()}onError(e){return s.a(this,void 0,void 0,function*(){yield this.nav.onError(e)})}show(e,t){this.nav.show(e,t)}push(e,t){this.nav.push(e,t)}replace(e,t){this.nav.replace(e,t)}pop(e=1){this.nav.pop(e)}topKey(){return this.nav.topKey()}popTo(e){this.nav.popTo(e)}clear(){this.nav.clear()}navBack(){this.nav.navBack()}ceaseTop(e){this.nav.ceaseTop(e)}removeCeased(){this.nav.removeCeased()}back(e=!0){return s.a(this,void 0,void 0,function*(){yield this.nav.back(e)})}regConfirmClose(e){this.nav.regConfirmClose(e)}confirmBox(e){return this.nav.confirmBox(e)}navToApp(e,t,i,n,a){return s.a(this,void 0,void 0,function*(){return new Promise((s,o)=>{let l=!0===this.centerHost.includes("http://localhost:")?"sheet_debug":"sheet",d=void 0===a?Object(c.c)(e,t):Object(c.c)(e,t,l,[i,n,a]);console.log("navToApp: %s",JSON.stringify(d)),E.push(r.createElement("article",{className:"app-container"},r.createElement("span",{id:d.hash,onClick:()=>this.back(),style:v},r.createElement("i",{className:"fa fa-arrow-left"})),r.createElement("iframe",{src:d.url})),()=>{s()})})})}navToSite(e){window.open(e)}get logs(){return g}log(e){g.push(e)}logMark(){let e=new Date;f=e.getTime(),g.push("log-mark: "+e.toTimeString())}logStep(e){g.push(e+": "+((new Date).getTime()-f))}}s.b([n.l],w.prototype,"user",void 0);const E=new w}).call(this,i(38))},,function(e,t,i){"use strict";i.d(t,"c",function(){return c}),i.d(t,"b",function(){return d}),i.d(t,"a",function(){return h});var s=i(1),r=i(0),n=i(4),a=i(6);class o{constructor(e,t,i,s,n){if(this.widgets={},this.errors=[],this.errorWidgets=[],this.renderErrors=Object(a.a)(()=>{let{errors:e}=this;return 0===e.length?null:r.createElement(r.Fragment,null,e.map(e=>r.createElement("span",{key:e,className:"text-danger inline-block my-1 ml-3"},r.createElement("i",{className:"fa fa-exclamation-circle"})," \xa0",e)))}),this.form=e,this.uiSchema=t,this.initData=i,this.inNode=s,this.isRow=n,void 0!==t){let{rules:e}=t;void 0!==e&&(this.rules=[],!1===Array.isArray(e)?this.rules.push(e):this.rules.push(...e))}}getArrRowContexts(e){void 0===this.subContexts&&(this.subContexts={});let t=this.subContexts[name];return void 0===t&&(this.subContexts[name]=t={}),t}get arrName(){}getValue(e){return this.initData[e]}setValue(e,t){this.initData[e]=t;let i=this.widgets[e];void 0!==i&&i.setValue(t)}getDisabled(e){let t=this.widgets[e];if(void 0!==t)return t.getDisabled()}setDisabled(e,t){let i=this.widgets[e];void 0!==i&&i.setDisabled(t)}getReadOnly(e){let t=this.widgets[e];void 0!==t&&t.getReadOnly()}setReadOnly(e,t){let i=this.widgets[e];void 0!==i&&i.setReadOnly(t)}getVisible(e){let t=this.widgets[e];void 0!==t&&t.getVisible()}setVisible(e,t){let i=this.widgets[e];void 0!==i&&i.setVisible(t)}checkFieldRules(){for(let e in this.widgets)this.widgets[e].checkRules();if(void 0!==this.subContexts)for(let e in this.subContexts){let t=this.subContexts[e];for(let e in t)t[e].checkFieldRules()}}checkContextRules(){if(void 0!==this.rules){this.clearContextErrors();for(let e of this.rules){let t=e(this);if(void 0!==t)if(!0===Array.isArray(t))this.errors.push(...t);else if("string"===typeof t)this.errors.push(t);else for(let e in t)this.setError(e,t[e])}if(void 0!==this.subContexts)for(let e in this.subContexts){let t=this.subContexts[e];for(let e in t){let i=t[e];i.removeErrors(),i.checkContextRules()}}}}setError(e,t){let i=this.widgets[e];void 0!==i&&(i.setContextError(t),this.addErrorWidget(i))}clearContextErrors(){for(let e in this.widgets)this.widgets[e].clearContextError()}checkRules(){this.checkFieldRules(),this.checkContextRules()}addErrorWidget(e){this.errorWidgets.findIndex(t=>t===e)<0&&this.errorWidgets.push(e)}removeErrorWidget(e){let t=this.errorWidgets.findIndex(t=>t===e);t>=0&&this.errorWidgets.splice(t,1)}checkHasError(){if(!0===this.errorWidgets.length+this.errors.length>0)return!0;if(void 0===this.subContexts)return!1;for(let e in this.subContexts){let t=this.subContexts[e];for(let e in t)if(!0===t[e].hasError)return!0}return!1}get hasError(){return this.checkHasError()}removeErrors(){this.errors.splice(0),this.errorWidgets.splice(0);for(let e in this.widgets){let t=this.widgets[e];void 0!==t&&t.clearContextError()}}}s.b([n.l],o.prototype,"errors",void 0),s.b([n.l],o.prototype,"errorWidgets",void 0),s.b([n.e],o.prototype,"hasError",null);let l=1;class c extends o{constructor(e,t,i,s){let r,{uiSchema:n}=e;if(void 0!==n){let{items:e}=n;void 0!==e&&(r=e[t.name])}super(e.form,r,i,s,!0),this.parentContext=e,this.arrSchema=t,this.rowKey=l++,this.data=i}getItemSchema(e){return this.arrSchema.itemSchemas[e]}getUiItem(e){if(void 0===this.uiSchema)return;let{items:t}=this.uiSchema;return void 0!==t?t[e]:void 0}get arrName(){return this.arrSchema.name}removeErrors(){super.removeErrors(),this.parentContext.removeErrors()}get parentData(){return this.parentContext.data}}class d extends o{constructor(e,t){super(e,e.uiSchema,e.data,t,!1)}get data(){return this.form.data}getItemSchema(e){return this.form.itemSchemas[e]}getUiItem(e){let{uiSchema:t}=this.form;if(void 0===t)return;let{items:i}=t;return void 0!==i?i[e]:void 0}}const h=r.createContext({})},function(e,t,i){"use strict";var s=i(21),r=i(39),n=i(1),a=i(27),o=i(19);const l=new class extends o.a{guest(){return n.a(this,void 0,void 0,function*(){let e=yield this.get("",{});switch(typeof e){default:return;case"string":return Object(a.a)(e);case"object":return Object(a.a)(e.token)}})}unitFromName(e){return n.a(this,void 0,void 0,function*(){let t=yield this.get(e);return t&&t.unit})}}("tv/guest/",void 0);var c=i(17),d=i(26);i(31);i.d(t,"e",function(){return s.a}),i.d(t,"m",function(){return s.b}),i.d(t,"n",function(){return r.b}),i.d(t,"h",function(){return l}),i.d(t,"l",function(){return o.h}),i.d(t,"d",function(){return o.d}),i.d(t,"c",function(){return o.c}),i.d(t,"p",function(){return o.j}),i.d(t,"o",function(){return o.i}),i.d(t,"a",function(){return o.a}),i.d(t,"b",function(){return o.b}),i.d(t,"k",function(){return o.g}),i.d(t,"f",function(){return c.a}),i.d(t,"g",function(){return c.e}),i.d(t,"j",function(){return d.b}),i.d(t,"i",function(){return d.a})},function(e,t,i){"use strict";function s(e,t){switch(e.substr(0,1)){default:return t;case"$":case"_":return}}function r(e){return JSON.stringify(e,s," ")}var n=i(0),a=i(6),o=i(34);const l=Object(a.a)(({tuidValue:e,ui:t,x:i,nullUI:s})=>{let r=typeof e;switch(r){default:if(void 0===t)return n.createElement(n.Fragment,null,r,"-",e);{let s=t(e,i);return void 0!==s?s:n.createElement(n.Fragment,null,e)}case"undefined":break;case"object":if(null!==e)return function(e,t,i){if("number"===typeof e)return n.createElement(n.Fragment,null,e);let{id:s,_$tuid:r,_$com:a}=e,l=r;if(void 0===l)return void 0!==t?t(e,i):Object(o.PureJSONContent)(e,i);let c=t||a;void 0===c&&(c=e._$com=l.getTuidContent());let d=l.valueFromId(s);if("number"===typeof d&&(d={id:d}),void 0!==t){let e=t(d,i);return void 0!==e?e:n.createElement(n.Fragment,null,s)}return n.createElement(c,d)}(e,t,i);break;case"number":return n.createElement(n.Fragment,null,"id...",e)}return void 0===s?n.createElement(n.Fragment,null,"."):s()}),c=(e,t,i,s)=>n.createElement(l,{tuidValue:e,ui:t,x:i,nullUI:s});i.d(t,"a",function(){return r}),i.d(t,"b",function(){return c})},function(e,t,i){"use strict";var s=i(11);i.d(t,"NavView",function(){return s.a}),i.d(t,"nav",function(){return s.c});i(40);var r=i(22);i.d(t,"Page",function(){return r.a});var n=i(66);i.d(t,"Controller",function(){return n.a}),i.d(t,"VPage",function(){return n.b}),i.d(t,"View",function(){return n.c});var a=i(67);i.o(a,"Edit")&&i.d(t,"Edit",function(){return a.Edit}),i.o(a,"Field")&&i.d(t,"Field",function(){return a.Field}),i.o(a,"Form")&&i.d(t,"Form",function(){return a.Form}),i.o(a,"Image")&&i.d(t,"Image",function(){return a.Image}),i.o(a,"Loading")&&i.d(t,"Loading",function(){return a.Loading}),i.o(a,"TabCaptionComponent")&&i.d(t,"TabCaptionComponent",function(){return a.TabCaptionComponent}),i.o(a,"Tabs")&&i.d(t,"Tabs",function(){return a.Tabs}),i.o(a,"resLang")&&i.d(t,"resLang",function(){return a.resLang});var o=i(86);i.d(t,"Field",function(){return o.a}),i.d(t,"Form",function(){return o.b});var l=i(87);i.d(t,"Edit",function(){return l.a});var c=i(33);i.d(t,"resLang",function(){return c.a});var d=i(89);i.d(t,"TabCaptionComponent",function(){return d.a}),i.d(t,"Tabs",function(){return d.b});var h=i(43);i.d(t,"Loading",function(){return h.a});var u=i(25);i.d(t,"Image",function(){return u.a});i(44)},function(e,t,i){"use strict";i.d(t,"h",function(){return u}),i.d(t,"a",function(){return p}),i.d(t,"g",function(){return v}),i.d(t,"i",function(){return f}),i.d(t,"f",function(){return g}),i.d(t,"e",function(){return b}),i.d(t,"c",function(){return y}),i.d(t,"b",function(){return w}),i.d(t,"d",function(){return C});var s=i(1),r=i(9),n=i.n(r),a=i(16),o=i(28),l=i(19),c=i(21),d=i(26);const h={};function u(){for(let e in h)h[e]=void 0}const m={};let p=new class{get unit(){return this._unit}set unit(e){this._unit=e}};function v(){return self!==window.parent}function f(e){if(e){let t=e.split("-"),i=t.length;if(i>0){let e=1;p.hash=t[e++],i>0&&(p.unit=Number(t[e++])),i>1&&(p.page=t[e++]),i>2&&(p.param=t.slice(e++))}}return p}function g(){let e=document.location.hash;if(void 0!==e&&e.length>0){let t=e.lastIndexOf("#tv-");return t<0&&(t=e.lastIndexOf("#tvdebug-")),t}return-1}function b(){let e=g();if(!(e<0))return document.location.hash.substring(e)}function y(e,t,i,s){let r;for(;;){if(r=Object(o.a)(),void 0===m[r]){m[r]={hash:r,unit:t};break}}if(e+="#tv-"+r+"-"+t,void 0!==i&&(e+="-"+i,void 0!==s))for(let n=0;n<s.length;n++)e+="-"+s[n];return{url:e,hash:r}}function w(e,t,i){return s.a(this,void 0,void 0,function*(){let r=h[e];if(void 0!==r)return r;if(!v()){let{unit:s,predefinedUnit:n}=p;if(void 0===(r=yield l.k.uq({unit:s||n,uqOwner:t,uqName:i}))){throw"unauthorized call: uqTokenApi center return undefined!"}void 0===r.token&&(r.token=l.f);let{url:a,urlDebug:o}=r,c=d.a.getUrlOrDebug(a,o);return console.log("realUrl: %s",c),r.url=c,h[e]=r,r}return console.log("appApi parent send: %s",p.hash),r={name:e,url:void 0,urlDebug:void 0,token:void 0,resolve:void 0,reject:void 0},h[e]=r,new Promise((t,i)=>{r.resolve=(e=>s.a(this,void 0,void 0,function*(){let i=yield e;console.log("return from parent window: %s",JSON.stringify(i)),r.url=i.url,r.urlDebug=i.urlDebug,r.token=i.token,t(r)})),r.reject=i,(window.opener||window.parent).postMessage({type:"app-api",apiName:e,hash:p.hash},"*")})})}window.addEventListener("message",function(e){return s.a(this,void 0,void 0,function*(){var t=e.data;switch(t.type){case"sub-frame-started":!function(e){var t=e.data;let i=e.source;Object(c.c)(i),function(e){let t=document.getElementById(e);void 0!==t&&(t.hidden=!0)}(t.hash);let s=n.a.clone(a.nav.user);s.type="init-sub-win",i.postMessage(s,"*")}(e);break;case"ws":yield a.nav.onReceive(t.msg);break;case"init-sub-win":yield function(e){return s.a(this,void 0,void 0,function*(){console.log("initSubWin: set nav.user",e);let t=a.nav.user=e;Object(l.i)(t.id,t.token),yield a.nav.showAppView()})}(t);break;case"pop-app":a.nav.navBack();break;case"center-api":yield function(e,t){return s.a(this,void 0,void 0,function*(){let{callId:i,url:s,method:r,body:n}=t,a=yield l.e.directCall(s,r,n);e.postMessage({type:"center-api-return",callId:i,result:a},"*")})}(e.source,t);break;case"center-api-return":!function(e){let{callId:t,result:i}=e,s=E[t];if(void 0===s)return;E[t]=void 0,s.resolve(i)}(t);break;case"app-api":console.log("receive PostMessage: %s",JSON.stringify(t));let i=yield function(e,t){return s.a(this,void 0,void 0,function*(){let i=m[e];if(void 0===i)return{name:t,url:void 0,urlDebug:void 0,token:void 0};let{unit:s,predefinedUnit:r}=i,n=t.split("/"),a=yield l.k.uq({unit:s||r,uqOwner:n[0],uqName:n[1]});if(void 0===a)throw console.log("apiTokenApi.api return undefined. api=%s, unit=%s",t,s),"api not found";return{name:t,url:a.url,urlDebug:a.urlDebug,token:a.token}})}(t.hash,t.apiName);console.log("onReceiveAppApiMessage: %s",JSON.stringify(i)),e.source.postMessage({type:"app-api-return",apiName:t.apiName,url:i.url,urlDebug:i.urlDebug,token:i.token},"*");break;case"app-api-return":console.log("app-api-return: %s",JSON.stringify(t)),console.log("await onAppApiReturn(message);"),yield function(e){return s.a(this,void 0,void 0,function*(){let{apiName:t,url:i,urlDebug:s,token:r}=e,n=h[t];if(void 0===n)throw"error app api return";let a=d.a.getUrlOrDebug(i,s);console.log("onAppApiReturn(message:any): url="+i+", debug="+s+", real="+a),n.url=a,n.token=r,n.resolve(n)})}(t);break;default:this.console.log("message: %s",JSON.stringify(t))}})});const E={};function C(e,t,i){return s.a(this,void 0,void 0,function*(){return console.log("bridgeCenterApi: url=%s, method=%s",e,t),yield new Promise((r,n)=>s.a(this,void 0,void 0,function*(){let s;for(;;){if(s=Object(o.a)(),void 0===E[s]){E[s]={id:s,resolve:r,reject:n};break}}(window.opener||window.parent).postMessage({type:"center-api",callId:s,url:e,method:t,body:i},"*")}))})}},function(e,t,i){"use strict";var s=i(0),r=i(1),n=i(5),a=i.n(n),o=i(9),l=i.n(o);class c{}class d extends c{constructor(e){super(),this.func=e}check(e,t){let i=this.func(t);if(void 0!==i)switch(typeof i){case"undefined":return;case"string":return void e.push(i);default:return void e.push(...i)}}}class h extends c{constructor(e){super(),this.res=e}}class u extends h{check(e,t){switch(typeof t){default:case"boolean":return;case"object":if(null!==t)return;break;case"string":if(t.trim().length>0)return;break;case"number":if(NaN!==t)return;break;case"undefined":}e.push(this.res.required)}}class m extends h{constructor(e,t,i){super(e),this.minMsg=l.a.template(e.min),this.maxMsg=l.a.template(e.max),this.min=t,this.max=i}check(e,t){if(void 0===t||null===t)return;let i=Number(t);NaN===i?e.push(this.res.number):this.checkMore(e,i)}checkMore(e,t){void 0!==this.min&&Number(t)<this.min&&e.push(this.minMsg({min:this.min})),void 0!==this.max&&Number(t)>this.max&&e.push(this.maxMsg({max:this.max}))}}class p extends m{checkMore(e,t){super.checkMore(e,t),!1===Number.isInteger(t)&&e.push(this.res.integer)}}var v=i(4),f=i(6);class g{constructor(e,t,i,r){this.errors=[],this.contextErrors=[],this.onInputChange=(e=>{this.changeValue(e.target.value,!0)}),this.container=Object(f.a)(()=>{if(!1===this.visible)return null;let{form:e,inNode:t}=this.context;if(!0===t)return this.render();let i=this.label;return!0===this.itemSchema.required&&!1!==e.props.requiredFlag&&null!==i&&(i=s.createElement(s.Fragment,null,i,"\xa0",s.createElement("span",{className:"text-danger"},"*"))),e.FieldContainer(i,this.render())}),this.context=e;let{name:n}=t;if(this.name=n,this.itemSchema=t,this.fieldProps=i,this.children=r,this.ui=e.getUiItem(n),void 0===this.ui)this.readOnly=!1,this.disabled=!1,this.visible=!0;else{let{readOnly:e,disabled:t,visible:i}=this.ui;this.readOnly=!0===e,this.disabled=!0===t,this.visible=!(!1===i)}this.value=this.defaultValue=e.getValue(n),this.init()}get hasError(){return this.errors.length+this.contextErrors.length>0}init(){if(this.rules=[],!0===this.itemSchema.required&&this.rules.push(new u(this.context.form.res)),this.buildRules(),void 0===this.ui)return;let{rules:e}=this.ui;if(void 0!==e)if(!1!==Array.isArray(e))for(let t of e)this.rules.push(new d(t));else this.rules.push(new d(e))}buildRules(){}checkRules(){let e=[];for(let t of this.rules)t.check(e,this.value);0===e.length?this.context.removeErrorWidget(this):(this.context.addErrorWidget(this),this.errors.push(...e))}get isOk(){return 0===this.errors.length}setError(e){void 0!==e&&("string"===typeof e?this.errors.push(e):this.errors.push(...e))}setContextError(e){void 0!==e&&("string"===typeof e?this.contextErrors.push(e):this.contextErrors.push(...e))}clearError(){this.errors.splice(0)}clearContextError(){this.contextErrors.splice(0)}parse(e){return e}setElementValue(e){}setDataValue(e){!0!==this.isChanging&&(this.context.initData[this.name]=this.value=this.parse(e))}setValue(e){!0!==this.isChanging&&this.changeValue(e,!1)}getValue(){return this.context.getValue(this.name)}getReadOnly(){return this.readOnly}getDisabled(){return this.disabled}getVisible(){return this.visible}setReadOnly(e){this.readOnly=e}setDisabled(e){this.disabled=e}setVisible(e){this.visible=e}changeValue(e,t){let i,s,r=this.value;void 0!==this.ui&&(i=this.ui.onChanging,s=this.ui.onChanged);let n=!0;void 0!==i&&(this.isChanging=!0,n=i(this.context,this.value,r),this.isChanging=!1),!0===n&&(this.setDataValue(e),!0!==t&&this.setElementValue(e),void 0!==s&&(this.isChanging=!0,s(this.context,this.value,r),this.isChanging=!1))}get className(){let e;return!1===this.context.inNode&&(e="form-control"),a()(e,this.context.form.FieldClass,this.ui&&this.ui.className)}get label(){let e;if(void 0===this.ui)e=this.name;else{let t=this.ui.label;e=null===t?null:t||this.name}return e}renderTemplet(){if(void 0!==this.children)return s.createElement(s.Fragment,null,this.children);if(void 0===this.ui)return;let{Templet:e}=this.ui;return"function"===typeof e?e(this.value):e}renderErrors(){let e=[...this.errors,...this.contextErrors];if(0===e.length)return null;let{inNode:t}=this.context,i=!0===t?"span":"div";return e.map(e=>s.createElement(i,{key:e,className:"text-danger d-inline-block my-2 ml-3"},s.createElement(s.Fragment,null,s.createElement("i",{className:"fa fa-exclamation-circle"})," \xa0",e)))}}r.b([v.l],g.prototype,"errors",void 0),r.b([v.l],g.prototype,"contextErrors",void 0),r.b([v.e],g.prototype,"hasError",null),r.b([v.l],g.prototype,"visible",void 0),r.b([v.e],g.prototype,"isOk",null);class b extends g{constructor(){super(...arguments),this.inputType="text",this.onKeyDown=(e=>r.a(this,void 0,void 0,function*(){if(this.internalOnKeyDown(e),13!==e.keyCode)return;let{onEnter:t}=this.context.form.props;if(void 0===t)return;this.changeValue(e.currentTarget.value,!0),this.checkRules(),this.context.checkContextRules();let i=yield t(this.name,this.context);void 0!==i&&this.context.setError(this.name,i)}))}setElementValue(e){null!==this.input&&(this.input.value=e)}get placeholder(){return this.ui&&this.ui.placeholder||this.name}internalOnKeyDown(e){}onBlur(e){this.onInputChange(e),this.checkRules(),this.context.checkContextRules()}onFocus(e){this.clearError(),this.context.removeErrorWidget(this),this.context.removeErrors()}onChange(e){}setReadOnly(e){null!==this.input&&(this.input.readOnly=this.readOnly=e)}setDisabled(e){null!==this.input&&(this.input.disabled=this.disabled=e)}render(){let e=this.renderTemplet();if(void 0!==e)return e;let t={};return!0===this.hasError?t["is-invalid"]=!0:t["required-item"]=!0===this.itemSchema.required,s.createElement(s.Fragment,null,s.createElement("input",{ref:e=>this.input=e,className:a()(this.className,t),type:this.inputType,defaultValue:this.value,onChange:e=>this.onChange(e),placeholder:this.placeholder,readOnly:this.readOnly,disabled:this.disabled,onKeyDown:this.onKeyDown,onFocus:e=>this.onFocus(e),onBlur:e=>this.onBlur(e),maxLength:this.itemSchema.maxLength}),this.renderErrors())}}class y extends b{constructor(){super(...arguments),this.inputType="number"}buildRules(){super.buildRules();let e=this.context.form.res,{min:t,max:i}=this.itemSchema;this.rules.push("integer"===this.itemSchema.type?new p(e,t,i):new m(e,t,i))}parse(e){if(void 0!==e&&null!==e)return Number(e)}}class w extends y{constructor(){super(...arguments),this.inputType="number"}isValidKey(e){return 46===e||8===e||37===e||39===e||e>=48&&e<=57||e>=96&&e<=105||109===e||189===e}internalOnKeyDown(e){let t=e.keyCode;event.returnValue=this.isValidKey(t)}}class E extends b{constructor(){super(...arguments),this.inputType="date"}}class C extends g{constructor(){super(...arguments),this.onInputChange=(e=>{this.setDataValue(!0===e.target.checked?this.trueValue:this.falseValue)}),this.onClick=(()=>{this.context.removeErrors()})}init(){if(super.init(),void 0!==this.ui){let{trueValue:e,falseValue:t}=this.ui;this.trueValue=void 0===e||e,this.falseValue=void 0!==t&&t}else this.trueValue=!0,this.falseValue=!1}setElementValue(e){this.input.checked=e===this.trueValue}setReadOnly(e){this.input.readOnly=this.readOnly=e}setDisabled(e){this.input.disabled=this.disabled=e}render(){let e=a()(this.className,"form-check-inline p-0"),t=s.createElement("input",{ref:e=>this.input=e,className:"align-self-center",type:"checkbox",defaultChecked:this.defaultValue,onChange:this.onInputChange,onClick:this.onClick});return!0===this.context.inNode?s.createElement("label",{className:e},t," ",this.ui&&this.ui.label||this.name):s.createElement("div",{className:e},s.createElement("label",{className:"w-100 h-100 mb-0 d-flex justify-content-center"},t))}}class x extends g{constructor(){super(...arguments),this.onInputChange=(e=>{this.setDataValue(e.target.value)})}setElementValue(e){this.select.value=e}setReadOnly(e){this.select.disabled=this.readOnly=!e}setDisabled(e){this.select.disabled=this.disabled=e}render(){if(!0===this.readOnly){let e=this.ui.list.find(e=>e.value===this.value),t=void 0===e?"(???)":e.title;return s.createElement("span",{className:"form-control w-min-6c"},t)}return s.createElement("select",{ref:e=>this.select=e,className:a()(this.className,"form-control"),defaultValue:this.defaultValue,onChange:this.onInputChange},this.ui.list.map((e,t)=>{let{title:i,value:r}=e;return s.createElement("option",{className:void 0,key:t,value:r},i||r)}))}}r.b([v.l],x.prototype,"readOnly",void 0);class k extends g{constructor(){super(...arguments),this.onClick=(()=>r.a(this,void 0,void 0,function*(){let e=this.ui&&this.ui.pickId;if(void 0===e)return void alert("no pickId defined!");let t=yield e(this.context,this.name,this.value);this.setDataValue(t),this.clearError(),this.clearContextError(),this.checkRules()}))}setReadOnly(e){this.readOnly=e}setDisabled(e){this.disabled=e}render(){let e,t;void 0!==this.ui&&(e=this.ui.placeholder,t=this.ui.Templet);let i,r={"form-control":!0,"required-item":!0===this.itemSchema.required,"cursor-pointer":!0,"is-invalid":this.hasError};return void 0===this.value||null===this.value?(i=e||"placeholder",r["text-muted"]=!0):i=void 0===t?s.createElement(s.Fragment,null,this.value):"function"===typeof t?t(this.value):t,s.createElement(s.Fragment,null,s.createElement("div",{className:a()(r),onClick:this.onClick},i),this.renderErrors())}}r.b([v.l],k.prototype,"value",void 0);const N=(e,t,i)=>s.createElement("span",{className:"text-danger"},"!!data type ",e," only support ",(i||[]).join(", "),", can't use ui ",t,"!!");class S extends g{constructor(){super(...arguments),this.onClick=(()=>r.a(this,void 0,void 0,function*(){this.clearError(),this.clearContextError();let{name:e,type:t}=this.itemSchema;if("submit"===t&&(this.context.checkRules(),!0===this.context.hasError))return;let{onButtonClick:i}=this.context.form.props;if(void 0===i)return void alert(`button ${e} clicked. you should define form onButtonClick`);let s=yield i(e,this.context);void 0!==s&&this.context.setError(e,s)})),this.observerRender=Object(f.a)(()=>{let e,t,i,{name:r,type:n}=this.itemSchema;if(void 0!==this.ui){let{widget:s}=this.ui;if("button"!==s)return N(n,s,["button"]);e=this.ui.Templet,t=this.ui.className,i=this.ui.label}let a,{form:o,hasError:l}=this.context,c=this.context,d="submit"===n&&l;a=void 0!==this.children?this.children:"function"===typeof e?e():void 0!==e?e:i;let h=s.createElement("button",{className:t,type:"button",disabled:d,onClick:this.onClick},a||r);return!0===c.inNode?s.createElement(s.Fragment,null,h,this.renderErrors()):s.createElement("div",{className:o.ButtonClass},s.createElement("div",null,this.renderErrors()),h)})}get label(){return null}render(){return s.createElement(this.observerRender,null)}}var F=i(13);const P=Object(f.a)(({parentContext:e,arrSchema:t,children:i})=>{let r,n,o,l,{name:c,arr:d}=t,h=e.initData[c],{form:u}=e,m=e.getArrRowContexts(c),p=e.getUiItem(c),v=c,{ArrContainer:g,RowContainer:b,RowSeperator:y,uiSchema:w}=u;if(void 0!==w){let{selectable:e,deletable:t,restorable:i}=w;!0!==n&&(n=e),!0!==o&&(o=t),!0!==l&&(l=i)}if(void 0!==p){let{widget:e,label:i,selectable:s,deletable:a,restorable:c,ArrContainer:d,RowContainer:h,RowSeperator:u}=p;if(void 0!==s&&(n=s),void 0!==a&&(o=a),void 0!==c&&(l=c),void 0!==d&&(g=d),void 0!==h&&(b=h),void 0!==u&&(y=u),r=p.Templet,"arr"!==e)return N(t.type,e,["arr"]);v=i||v}let E=!0;return g(v,s.createElement(s.Fragment,null,h.map((c,u)=>{let p,v,g=void 0;if(!1===E?g=y:E=!1,void 0!==i)p=new F.c(e,t,c,!0),v=s.createElement(s.Fragment,null,i);else{let i=typeof r;"function"===i?(p=new F.c(e,t,c,!0),v=s.createElement(Object(f.a)(r),c)):"object"===i?(p=new F.c(e,t,c,!0),v=r):(p=new F.c(e,t,c,!1),v=s.createElement(s.Fragment,null,d.map((e,t)=>s.createElement(s.Fragment,{key:e.name},A(p,e,void 0)))))}let w,C,{rowKey:x}=p;if(m[x]=p,!0===n){let e=e=>{let{checked:t}=e.target;c.$isSelected=t;let{$source:i}=c;void 0!==i&&(i.$isSelected=t),p.removeErrors()};w=s.createElement("div",{className:"form-row-checkbox"},s.createElement("input",{type:"checkbox",onClick:e,defaultChecked:c.$isSelected}))}let k=!(void 0===c.$isDeleted||!1===c.$isDeleted);if(!0===o){let e=k?"fa-undo":"fa-trash",t=()=>{if(!0===l){c.$isDeleted=!k;let{$source:e}=c;void 0!==e&&(e.$isDeleted=!k)}else{let e=h.indexOf(c);e>=0&&h.splice(e,1)}p.removeErrors()};C=s.createElement("div",{className:"form-row-edit text-info",onClick:t},s.createElement("i",{className:a()("fa",e,"fa-fw")}))}let N=!0===n||!0===o?e=>s.createElement("fieldset",{disabled:k},s.createElement("div",{className:a()("d-flex",{deleted:k,"row-selected":c.$isSelected})},w,s.createElement("div",{className:"flex-grow-1"},e),C)):e=>e;return s.createElement(F.a.Provider,{key:x,value:p},g,b(N(s.createElement(s.Fragment,null,s.createElement(p.renderErrors,null),v))))})))});var T=i(25),V=i(42);class I extends g{constructor(){super(...arguments),this.onClick=(()=>r.a(this,void 0,void 0,function*(){let e=new V.a(this.itemSchema,this.ui,this.ui.label,this.value),t=yield e.start();null!==t&&(this.setValue(t),this.imageSrc=t),yield e.end()})),this.observerRender=Object(f.a)(()=>{let e,t=["bg-white p-1 d-flex justify-content-center"];return this.readOnly||this.disabled||(t.push("cursor-pointer"),e=this.onClick),s.createElement("div",{className:a()(t),onClick:e},s.createElement(T.a,{src:this.imageSrc,className:"w-4c h-4c"}))})}init(){super.init(),this.imageSrc=this.value}render(){return s.createElement(this.observerRender,null)}}r.b([v.l],I.prototype,"imageSrc",void 0);const L={id:{dataTypes:["id"],widget:k},text:{dataTypes:["integer","number","string"],widget:b},textarea:{dataTypes:["string"],widget:class extends g{constructor(){super(...arguments),this.onInputChange=(e=>{this.setValue(e.currentTarget.value)})}setElementValue(e){this.input.value=e}setReadOnly(e){this.input.readOnly=this.readOnly=e}setDisabled(e){this.input.disabled=this.disabled=e}render(){let e=this.renderTemplet();if(void 0!==e)return e;let t={};return!0===this.hasError?t["is-invalid"]=!0:t["required-item"]=!0===this.itemSchema.required,s.createElement("textarea",{ref:e=>this.input=e,className:a()(this.className,t),rows:this.ui&&this.ui.rows,maxLength:this.itemSchema.maxLength,defaultValue:this.defaultValue,onChange:this.onInputChange})}}},password:{dataTypes:["string"],widget:class extends b{constructor(){super(...arguments),this.inputType="password"}}},date:{dataTypes:["date"],widget:E},datetime:{dataTypes:["date"],widget:class extends b{constructor(){super(...arguments),this.inputType="datetime"}}},time:{dataTypes:["date"],widget:class extends b{constructor(){super(...arguments),this.inputType="time"}}},month:{dataTypes:["date"],widget:class extends b{constructor(){super(...arguments),this.inputType="month"}}},select:{dataTypes:["integer","number","string","date","boolean"],widget:x},url:{dataTypes:["string"],widget:class extends b{constructor(){super(...arguments),this.inputType="url"}}},email:{dataTypes:["string"],widget:class extends b{constructor(){super(...arguments),this.inputType="email"}}},number:{dataTypes:["integer","number"],widget:y},updown:{dataTypes:["integer","number"],widget:w},color:{},checkbox:{dataTypes:["boolean","integer","number"],widget:C},image:{dataTypes:["string"],widget:I},checkboxes:{},radio:{dataTypes:["integer","number","string","date","boolean"],widget:class extends g{constructor(){super(...arguments),this.inputs={}}setElementValue(e){for(let t in this.inputs){let i=this.inputs[t];i.checked=e===i.value}}setReadOnly(e){this.readOnly=e;for(let t in this.inputs)this.inputs[t].readOnly=e}setDisabled(e){this.disabled=e;for(let t in this.inputs)this.inputs[t].disabled=e}render(){let e,{defaultValue:t,list:i}=this.ui,{isRow:r,inNode:n}=this.context;!0===r&&(e=this.context.rowKey);let o=a()(this.className,"form-radio-inline");return s.createElement("span",{className:o},i.map((i,r)=>{let{value:n,title:a}=i,o=this.name;return void 0!==e&&(o+="-"+e),s.createElement("label",{key:r,className:"form-radio-inline"},s.createElement("input",{ref:e=>this.inputs[r]=e,type:"radio",name:o,value:n,defaultChecked:(this.defaultValue||t)===n}),a||n)}))}}},range:{dataTypes:["integer"],widget:class extends g{constructor(){super(...arguments),this.inputType="range"}setReadOnly(e){this.input.readOnly=this.readOnly=e}setDisabled(e){this.input.disabled=this.disabled=e}render(){let{min:e,max:t,step:i}=this.ui;return s.createElement(s.Fragment,null,s.createElement("input",{ref:e=>this.input=e,className:a()(this.className,"form-control","w-min-6c"),type:this.inputType,defaultValue:this.defaultValue,onChange:this.onInputChange,max:t,min:e,step:i}))}}},button:{dataTypes:["button","submit"],widget:S}};function A(e,t,i,r){if(void 0===e)return null;if(void 0===t)return;let n,{name:a,type:o}=t;switch(o){case"arr":let t=e.getItemSchema(a);return s.createElement(P,{parentContext:e,arrSchema:t,children:i})}let l=e.getUiItem(a);function c(e){switch(e){default:return b;case"id":return k;case"integer":return w;case"number":return y;case"string":return b;case"date":return E;case"boolean":return C;case"button":case"submit":return S}}if(void 0===l)n=c(o);else{let{widget:e}=l;switch(e){default:if(void 0!==e){n=L[e].widget}void 0===n&&(n=c(o));break;case"custom":n=l.WidgetClass;break;case"group":return s.createElement("span",null,"impletment group")}}let{isRow:d,widgets:h}=e,u=new n(e,t,r,i);return h[a]=u,s.createElement(u.container,null)}i.d(t,"b",function(){return A}),i.d(t,"a",function(){return y})},function(e,t,i){"use strict";var s=i(1),r=i(9),n=i.n(r),a=i(31),o=i(11);class l{startWait(){o.c.startWait()}endWait(){o.c.endWait()}showError(e){return s.a(this,void 0,void 0,function*(){o.c.endWait(),yield o.c.onError(e)})}}var c=i(17),d=i(39),h=i(26),u=i(16);i.d(t,"h",function(){return v}),i.d(t,"d",function(){return b}),i.d(t,"c",function(){return E}),i.d(t,"j",function(){return C}),i.d(t,"f",function(){return N}),i.d(t,"i",function(){return F}),i.d(t,"a",function(){return P}),i.d(t,"k",function(){return V}),i.d(t,"e",function(){return I}),i.d(t,"b",function(){return A}),i.d(t,"g",function(){return q});let m={},p={};function v(){m={},p={},w={},Object(c.h)()}const f="uqLocalEntities";const g=new class{loadAccess(e){return s.a(this,void 0,void 0,function*(){try{let i,{uqOwner:s,uqName:r}=e;if(void 0===this.local){let e=localStorage.getItem(f);null!==e&&(this.local=JSON.parse(e))}if(void 0!==this.local){let{user:e,uqs:t}=this.local;if(e!==S||void 0===t)this.local=void 0;else for(let i in t)t[i].isNet=void 0}void 0===this.local&&(this.local={user:S,unit:void 0,uqs:{}});let a=s+"/"+r,o=this.local.uqs[a];if(void 0!==o){let{value:e}=o;i=e}return void 0===i&&(i=yield e.__loadAccess(),this.saveLocal(a,i)),n.a.cloneDeep(i)}catch(t){throw this.local=void 0,localStorage.removeItem(f),t}})}saveLocal(e,t){this.local.uqs[e]={value:t,isNet:!0};let i=JSON.stringify(this.local);localStorage.setItem(f,i)}checkAccess(e){return s.a(this,void 0,void 0,function*(){let{uqOwner:t,uqName:i}=e,s=t+"/"+i,r=this.local.uqs[s];if(void 0===r)return!1;let{isNet:a,value:o}=r;if(!0===a)return!0;let l=yield e.__loadAccess();return!1===n.a.isMatch(o,l)?(this.saveLocal(s,l),!1):(r.isNet=!0,!0)})}};class b extends d.a{constructor(e,t,i,s,r){super(e,r),i&&(this.uqOwner=t,this.uqName=i,this.uq=t+"/"+i),this.access=s,this.showWaiting=r}getHttpChannel(){return s.a(this,void 0,void 0,function*(){let e,t;!0===this.showWaiting||void 0===this.showWaiting?(e=m,t=new l):e=p;let i=e[this.uq];if(void 0!==i)return i;let s=yield Object(c.b)(this.uq,this.uqOwner,this.uqName);return this.token=s.token,i=new a.a(!1,s.url,s.token,t),e[this.uq]=i})}update(){return s.a(this,void 0,void 0,function*(){return yield this.get("update")})}__loadAccess(){return s.a(this,void 0,void 0,function*(){let e=void 0===this.access?"":this.access.join("|");return yield this.get("access",{acc:e})})}loadAccess(){return s.a(this,void 0,void 0,function*(){return yield g.loadAccess(this)})}loadEntities(){return s.a(this,void 0,void 0,function*(){return yield this.get("entities")})}checkAccess(){return s.a(this,void 0,void 0,function*(){return yield g.checkAccess(this)})}schema(e){return s.a(this,void 0,void 0,function*(){return yield this.get("schema/"+e)})}schemas(e){return s.a(this,void 0,void 0,function*(){return yield this.post("schema",e)})}tuidGet(e,t){return s.a(this,void 0,void 0,function*(){return yield this.get("tuid/"+e+"/"+t)})}tuidGetAll(e){return s.a(this,void 0,void 0,function*(){return yield this.get("tuid-all/"+e+"/")})}tuidSave(e,t){return s.a(this,void 0,void 0,function*(){return yield this.post("tuid/"+e,t)})}tuidSearch(e,t,i,r,n,a){return s.a(this,void 0,void 0,function*(){return yield this.post("tuids/"+e,{arr:t,owner:i,key:r,pageStart:n,pageSize:a})})}tuidArrGet(e,t,i,r){return s.a(this,void 0,void 0,function*(){return yield this.get("tuid-arr/"+e+"/"+i+"/"+t+"/"+r)})}tuidArrGetAll(e,t,i){return s.a(this,void 0,void 0,function*(){return yield this.get("tuid-arr-all/"+e+"/"+i+"/"+t+"/")})}tuidArrSave(e,t,i,r){return s.a(this,void 0,void 0,function*(){return yield this.post("tuid-arr/"+e+"/"+i+"/"+t+"/",r)})}tuidArrPos(e,t,i,r,n){return s.a(this,void 0,void 0,function*(){return yield this.post("tuid-arr-pos/"+e+"/"+i+"/"+t+"/",{id:r,$order:n})})}tuidIds(e,t,i){return s.a(this,void 0,void 0,function*(){try{let r="tuidids/"+e+"/";return r+=void 0!==t?t:"$",yield this.post(r,i)}catch(s){console.error(s)}})}proxied(e,t,i){return s.a(this,void 0,void 0,function*(){try{let r="tuid-proxy/"+e+"/"+t+"/"+i;return yield this.get(r)}catch(s){console.error(s)}})}sheetSave(e,t){return s.a(this,void 0,void 0,function*(){return yield this.post("sheet/"+e,t)})}sheetAction(e,t){return s.a(this,void 0,void 0,function*(){return yield this.put("sheet/"+e,t)})}stateSheets(e,t){return s.a(this,void 0,void 0,function*(){return yield this.post("sheet/"+e+"/states",t)})}stateSheetCount(e){return s.a(this,void 0,void 0,function*(){return yield this.get("sheet/"+e+"/statecount")})}getSheet(e,t){return s.a(this,void 0,void 0,function*(){return yield this.get("sheet/"+e+"/get/"+t)})}sheetArchives(e,t){return s.a(this,void 0,void 0,function*(){return yield this.post("sheet/"+e+"/archives",t)})}sheetArchive(e,t){return s.a(this,void 0,void 0,function*(){return yield this.get("sheet/"+e+"/archive/"+t)})}action(e,t){return s.a(this,void 0,void 0,function*(){return yield this.post("action/"+e,t)})}page(e,t,i,r){return s.a(this,void 0,void 0,function*(){let s;switch(typeof r){case"undefined":s={key:""};break;default:s=n.a.clone(r)}return s.$pageStart=t,s.$pageSize=i,yield this.post("query-page/"+e,s)})}query(e,t){return s.a(this,void 0,void 0,function*(){return yield this.post("query/"+e,t)})}user(){return s.a(this,void 0,void 0,function*(){return yield this.get("user")})}}let y,w={};class E extends b{constructor(e){super("tv/",void 0,void 0,void 0,!0),this.unitId=e}getHttpChannel(){return s.a(this,void 0,void 0,function*(){let e=w[this.unitId];return void 0!==e?e:w[this.unitId]=yield this.buildChannel()})}buildChannel(){return s.a(this,void 0,void 0,function*(){let e=new l,t=new A("tv/",void 0),i=yield t.unitxUq(this.unitId),{token:s,url:r,urlDebug:n}=i,o=h.a.getUrlOrDebug(r,n);return this.token=s,new a.a(!1,o,s,e)})}}function C(e){console.log("setCenterUrl %s",e),y=e,N=void 0,k=void 0,x=void 0}let x,k,N=void 0,S=0;function F(e,t){S=e,N=t,console.log("setCenterToken %s",t),k=void 0,x=void 0}class P extends d.a{constructor(e,t){super(e,t)}getHttpChannel(){return s.a(this,void 0,void 0,function*(){return!0===this.showWaiting||void 0===this.showWaiting?void 0!==x?x:x=new a.a(!0,y,N,new l):void 0!==k?k:k=new a.a(!0,y,N)})}}const T="uqTokens";const V=new class extends P{uq(e){return s.a(this,void 0,void 0,function*(){try{let{unit:i,uqOwner:s,uqName:r}=e;if(void 0===this.local){let e=localStorage.getItem(T);null!==e&&(this.local=JSON.parse(e))}if(void 0!==this.local){let{unit:e,user:t}=this.local;e===i&&t===S||(this.local=void 0)}void 0===this.local&&(this.local={user:S,unit:e.unit,uqs:{}});let a=s+"/"+r,o=(new Date).getTime(),l=this.local.uqs[a];if(void 0!==l){let{tick:e,value:t}=l;if(o-e<864e5)return n.a.clone(t)}let c=yield this.get("app-uq",e);return this.local.uqs[a]={tick:o,value:c},localStorage.setItem(T,JSON.stringify(this.local)),n.a.clone(c)}catch(t){throw this.local=void 0,localStorage.removeItem(T),t}})}}("tv/tie/",void 0);const I=new class extends P{directCall(e,t,i){return this.call(e,t,i)}}("",void 0),L="appUqs";class A extends P{uqs(e,t){return s.a(this,void 0,void 0,function*(){let i,s=localStorage.getItem(L);if(null!==s){let r=JSON.parse(s),{appOwner:n,appName:a,value:o}=r;e===n&&t===a&&(i=o)}if(void 0===i){i=yield this.uqsPure(e,t);let s={appOwner:e,appName:t,value:i};localStorage.setItem(L,JSON.stringify(s))}return this.cachedUqs=n.a.cloneDeep(i)})}uqsPure(e,t){return s.a(this,void 0,void 0,function*(){return yield this.get("tie/app-uqs",{appOwner:e,appName:t})})}checkUqs(e,t){return s.a(this,void 0,void 0,function*(){let i=yield this.uqsPure(e,t),{id:s,uqs:r}=this.cachedUqs,{id:a,uqs:o}=i;if(s!==a)return!1;if(r.length!==o.length)return!1;let l=r.length;for(let e=0;e<l;e++)if(!1===n.a.isMatch(r[e],o[e]))return!1;return!0})}unitxUq(e){return s.a(this,void 0,void 0,function*(){return yield this.get("tie/unitx-uq",{unit:e})})}changePassword(e){return s.a(this,void 0,void 0,function*(){return yield this.post("tie/reset-password",e)})}}function q(e,t){return s.a(this,void 0,void 0,function*(){let i=new A("tv/",void 0),s=yield i.uqs(e,t);return i.checkUqs(e,t).then(e=>{!1===e&&(localStorage.removeItem(L),u.nav.start())}),s})}},function(e,t,i){"use strict";var s=i(1),r=i(0),n=i(5),a=i.n(n);class o{}class l extends o{constructor(e){super(),this.onClick=(()=>s.a(this,void 0,void 0,function*(){yield this.controller.start()})),this.controller=e,this.icon=e.icon,this.label=e.label}render(e){return r.createElement("div",{className:a()("px-3","py-2","align-items-center","cursor-pointer",e),onClick:this.onClick},this.icon," \xa0 ",this.label)}}i.d(t,"a",function(){return l})},function(e,t,i){"use strict";i.d(t,"c",function(){return n}),i.d(t,"b",function(){return a}),i.d(t,"d",function(){return c}),i.d(t,"a",function(){return d});var s=i(1);let r;function n(e){r=e}function a(e){window.top.postMessage({type:"ws",msg:e},"*")}class o{constructor(){this.handlerSeed=1,this.anyHandlers={},this.msgHandlers={}}onWsReceiveAny(e){let t=this.handlerSeed++;return this.anyHandlers[t]=e,t}onWsReceive(e,t){let i=this.handlerSeed++;return this.msgHandlers[i]={type:e,handler:t},i}endWsReceive(e){delete this.anyHandlers[e],delete this.msgHandlers[e]}receive(e){return s.a(this,void 0,void 0,function*(){let{$type:t}=e;for(let i in this.anyHandlers)yield this.anyHandlers[i](e);for(let i in this.msgHandlers){let{type:s,handler:r}=this.msgHandlers[i];s===t&&(yield r(e))}})}}let l=1;const c=new class extends o{constructor(){super(...arguments),this.wsBaseId="WsBridge seed "+l++}};class d extends o{constructor(e,t){super(),this.wsBaseId="WSChannel seed "+l++,this.wsHost=e,this.token=t}static setCenterToken(e){d.centerToken=e}connect(){if(void 0!==this.ws)return;let e=this;return new Promise((t,i)=>{let r=new WebSocket(this.wsHost,this.token||d.centerToken);console.log("connect webSocket %s",this.wsHost),r.onopen=(i=>{console.log("webSocket connected %s",this.wsHost),e.ws=r,t()}),r.onerror=(e=>{i("webSocket can't open!")}),r.onmessage=(t=>s.a(this,void 0,void 0,function*(){return yield e.wsMessage(t)})),r.onclose=(t=>{e.ws=void 0,console.log("webSocket closed!")})})}close(){void 0!==this.ws&&(this.ws.close(),this.ws=void 0)}wsMessage(e){return s.a(this,void 0,void 0,function*(){try{console.log("websocket message: %s",e.data);let i=JSON.parse(e.data);!function(e){void 0!==r&&r.postMessage({type:"ws",msg:e},"*")}(i),yield this.receive(i)}catch(t){console.log("ws msg error: ",t)}})}sendWs(e){let t=this;this.connect().then(()=>{t.ws.send(e)})}}},function(e,t,i){"use strict";i.d(t,"a",function(){return m});var s=i(1),r=i(0),n=i(6),a=i(5),o=i.n(a),l=i(9),c=i.n(l),d=i(40);const h=100;class u extends r.Component{constructor(){super(...arguments),this.bottomTime=0,this.topTime=0,this.onScroll=(e=>s.a(this,void 0,void 0,function*(){let{onScroll:t,onScrollTop:i,onScrollBottom:s}=this.props;t&&this.props.onScroll(e);let r=e.target;if(r.scrollTop<30&&void 0!==i){let e=(new Date).getTime();e-this.topTime>h&&(this.topTime=e,i())}if(r.scrollTop+r.offsetHeight>r.scrollHeight-30&&void 0!==s){let e=(new Date).getTime();e-this.bottomTime>h&&(this.bottomTime=e,s())}}))}eachChild(e,t){let{props:i}=e;if(void 0===i)return;let{children:s}=i;void 0!==s&&r.Children.forEach(s,(e,i)=>{let{_$scroll:s}=e;s&&s(t),console.log(e.toString()),this.eachChild(e,t)})}render(){return r.createElement("main",{className:this.props.className,onScroll:this.onScroll},this.props.children)}}let m=class extends r.Component{constructor(e){super(e);let t,{tabs:i}=e;if(void 0===i||0===i.length)return;this.tabs=i;let s=[];for(let r of i){let e=c.a.clone(r);void 0===t&&!0===e.isSelected?t=e:e.isSelected=!1,e.isMounted=!1,s.push(e)}this.state={cur:t,tabs:s}}componentDidMount(){return s.a(this,void 0,void 0,function*(){if(void 0===this.tabs)return;let e=this.state.tabs[0];void 0!==e&&(yield this.onTabClick(e))})}onTabClick(e){return s.a(this,void 0,void 0,function*(){if(!0===e.isSelected)return;let t,i=this.state.tabs;for(let s of i)s===e?(s.isSelected=!0,t=s):s.isSelected=!1;if(!0!==t.isMounted){let{load:e}=t;void 0!==e&&(yield e())}this.setState({cur:t,tabs:i})})}onTouchStart(e){}renderTabs(e){const{header:t,back:i,right:s,keepHeader:n}=this.props;let a,l=this.state.cur,c=r.createElement("div",null,this.state.tabs.map((e,t)=>{const{icon:i,isSelected:s,title:n,redDot:a}=e;let l,c,d;if(void 0!==i&&(l=r.createElement("img",{src:i})),void 0!==a){let e=a.get();e<0?(d=o()("red-dot"),c=r.createElement("u",null)):e>0&&(d=o()("red-dot","num"),c=r.createElement("u",null,e))}return r.createElement("div",{key:t,className:o()("va-tab",{cur:s}),onClick:()=>this.onTabClick(e)},l,r.createElement("div",{className:d},n,c))}));return!1!==t&&(a=r.createElement(d.a,{back:i,center:!0===n?t:l&&(l.header||l.title),right:s})),r.createElement("article",{className:"page-container"},a,r.createElement("section",{className:"position-relative"},this.props.sideBar,this.state.tabs.map((e,t)=>{let{isSelected:i,isMounted:s,content:n}=e;if(!0===i||!0===s)return e.isMounted=!0,r.createElement(u,{key:t,className:o()({invisible:!1===i}),onScroll:e.onScroll,onScrollTop:e.onScrollTop,onScrollBottom:e.onScrollBottom},"function"===typeof n?n():n)})),c,e)}renderSingle(e){const{back:t,header:i,right:s,onScroll:n,onScrollTop:a,onScrollBottom:o,children:l}=this.props;let c;return!1!==i&&(c=r.createElement(d.a,{back:t,center:i,right:s,logout:this.props.logout})),r.createElement("article",{className:"page-container",onTouchStart:this.onTouchStart},c,r.createElement("section",{className:"position-relative"},this.props.sideBar,r.createElement(u,{onScroll:n,onScrollTop:a,onScrollBottom:o},l)),e)}render(){const{footer:e}=this.props;let t;return void 0!==e&&(t=r.createElement("footer",null,e)),void 0!==this.tabs?this.renderTabs(t):this.renderSingle(t)}};m=s.b([n.a],m)},function(e,t,i){"use strict";i.d(t,"a",function(){return n});const s="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",r=8;function n(){let e=s.length,t="";for(let i=0;i<r;i++)t+=s.charAt(Math.floor(Math.random()*e));return t}},,function(e,t,i){"use strict";i.d(t,"a",function(){return o});var s=i(0),r=i(5),n=i.n(r),a=i(11);function o(e){let{className:t,style:i,src:r}=e;return r?(!0===r.startsWith(":")&&(r=a.c.resUrl+r.substr(1)),s.createElement("img",{src:r,className:t,style:i})):s.createElement("div",{className:n()(t,"image-none"),style:i},s.createElement("i",{className:"fa fa-file-o"}))}},function(e,t,i){"use strict";i.d(t,"b",function(){return r}),i.d(t,"a",function(){return c});var s=i(1);const r=!1,n="101.200.46.56",a=Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_CENTER_HOST:"101.200.46.56"}).REACT_APP_RES_HOST||n,o={centerhost:{value:Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_CENTER_HOST:"101.200.46.56"}).REACT_APP_CENTER_DEBUG_HOST||"localhost:3000",local:!1},reshost:{value:Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_CENTER_HOST:"101.200.46.56"}).REACT_APP_RES_DEBUG_HOST||"localhost:3015",local:!1},uqhost:{value:Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_CENTER_HOST:"101.200.46.56"}).REACT_APP_UQ_DEBUG_HOST||"localhost:3015",local:!1},unitxhost:{value:Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_CENTER_HOST:"101.200.46.56"}).REACT_APP_UQ_DEBUG_HOST||"localhost:3015",local:!1},"uq-build":{value:Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_CENTER_HOST:"101.200.46.56"}).REACT_APP_UQ_DEBUG_BUILDER_HOST||"localhost:3009",local:!1}};const l={method:"GET",mode:"no-cors",headers:{"Content-Type":"text/plain"}};const c=new class{start(){return s.a(this,void 0,void 0,function*(){!0===r&&(yield this.tryLocal());let e=this.getCenterHost();this.url=function(e){return`http://${e}/`}(e),this.ws=function(e){return`ws://${e}/tv/`}(e),this.resHost=this.getResHost()})}debugHostUrl(e){return`http://${e}/hello`}tryLocal(){return s.a(this,void 0,void 0,function*(){let e=[],t=[];for(let r in o){let e=o[r],{value:i}=e;t.findIndex(e=>e===i)<0&&t.push(i)}for(let r of t){let t=this.debugHostUrl(r);e.push(h(t))}let i=yield Promise.all(e),s=t.length;for(let r=0;r<s;r++){let e=i[r],s=t[r];for(let t in o){let i=o[t];i.value===s&&(i.local=e)}}})}getCenterHost(){let{value:e,local:t}=o.centerhost;return!0===document.location.hash.includes("sheet_debug")?e:!0===r&&!0===t?e:n}getResHost(){let{value:e,local:t}=o.reshost;return!0===document.location.hash.includes("sheet_debug")?e:!0===r&&!0===t?e:a}getUrlOrDebug(e,t){if(!0!==r)return e;if(!t)return e;for(let i in o){let s=o[i],{value:r,local:n}=s,a=`://${i}/`;if(t.indexOf(a)>0)return!1===n?e:t=t.replace(a,`://${r}/`)}return e}localCheck(e){return s.a(this,void 0,void 0,function*(){return yield h(e)})}},d=200;function h(e){return s.a(this,void 0,void 0,function*(){try{return yield function(e){return new Promise((t,i)=>{fetch(e,l).then(e=>{e.text().then(t).catch(i)}).catch(i);const s=new Error("Connection timed out");setTimeout(i,d,s)})}(e),!0}catch(t){return!1}})}},function(e,t,i){"use strict";i.d(t,"b",function(){return n}),i.d(t,"a",function(){return a});var s=i(59),r=i.n(s);function n(e){let t=r()(e);return{id:t.id,name:t.name,guest:t.guest,token:e}}function a(e){return{id:0,guest:r()(e).guest,token:e}}},function(e,t,i){"use strict";i.d(t,"a",function(){return n});const s="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",r=8;function n(){let e=s.length,t="";for(let i=0;i<r;i++)t+=s.charAt(Math.floor(Math.random()*e));return t}},function(e,t,i){"use strict";var s=i(1),r=i(9),n=i.n(r),a=i(8),o=i(0),l=i.n(o),c=i(3),d=i(2);class h extends a.b{constructor(){super(...arguments),this.onNew=(()=>this.event("new")),this.onList=(()=>this.event("list")),this.onSearch=(e=>s.a(this,void 0,void 0,function*(){return this.event("list",e)}))}open(e){return s.a(this,void 0,void 0,function*(){this.openPage(this.view)})}entityRender(e,t){return e.render()}entityClick(e){return s.a(this,void 0,void 0,function*(){yield e.onClick()})}get view(){let e,t,{label:i,proxyLinks:s,isFrom:r}=this.controller;if(!1===r&&(e=o.createElement("button",{className:"btn btn-outline-success ml-2",onClick:this.onNew},"\u65b0\u589e")),void 0===s){let s=o.createElement(o.Fragment,null,e,o.createElement("button",{className:"btn btn-outline-info ml-2",onClick:this.onList},"\u5168\u90e8"));t=o.createElement(c.LMR,{className:"m-3",right:s},o.createElement(c.SearchBox,{className:"w-100",size:"md",onSearch:this.onSearch,placeholder:"\u641c\u7d22"+i}))}else t=o.createElement(c.List,{className:"my-2",header:o.createElement(c.Muted,null,i," \u4ee3\u7406\u4e0b\u5217Tuid"),items:s,item:{render:this.entityRender,onClick:this.entityClick}});return()=>o.createElement(d.Page,{header:i},t)}}class u extends a.b{constructor(){super(...arguments),this.next=(()=>s.a(this,void 0,void 0,function*(){this.vForm.reset(),this.closePage()})),this.finish=(()=>{this.closePage(2),this.event("edit-end")}),this.onSubmit=(()=>s.a(this,void 0,void 0,function*(){let e=this.vForm.getValues(),t=yield this.controller.entity.save(this.id,e),{id:i}=t;if(i<0){let{unique:e}=this.controller.entity;if(void 0!==e)for(let t of e)this.vForm.setError(t,"\u4e0d\u80fd\u91cd\u590d")}else{if(this.controller.isCalling)return this.returnCall(i),void this.closePage();this.openPageElement(o.createElement(d.Page,{header:this.label+"\u63d0\u4ea4\u6210\u529f",back:"none"},o.createElement("div",{className:"m-3"},o.createElement("span",{className:"text-success"},o.createElement(c.FA,{name:"check-circle",size:"lg"})," \u6210\u529f\u63d0\u4ea4\uff01"),o.createElement("div",{className:"mt-5"},o.createElement("button",{className:"btn btn-primary mr-3",onClick:this.next},"\u7ee7\u7eed\u5f55\u5165"),o.createElement("button",{className:"btn btn-outline-primary",onClick:this.finish},"\u4e0d\u7ee7\u7eed"))))),this.event("item-changed",{id:this.id,values:e})}}))}open(e){return s.a(this,void 0,void 0,function*(){this.vForm=this.createForm(this.onSubmit,e),void 0!==e&&(this.id=e.id),this.openPage(this.editView)})}get editView(){return()=>o.createElement(d.Page,{header:(void 0===this.id?"\u65b0\u589e":"\u7f16\u8f91")+" - "+this.label},this.vForm.render("py-3"))}resetForm(){this.vForm.reset()}}var m=i(10),p=i(6);class v extends a.b{constructor(){super(...arguments),this.mainView=Object(p.a)(()=>{let e=l.a.createElement(c.SearchBox,{className:"mx-1 w-100",initKey:"",onSearch:this.onSearchMain,placeholder:"\u641c\u7d22"+this.label});return l.a.createElement(d.Page,{header:e,back:"close"},l.a.createElement(c.List,{items:this.controller.PageItems.items,item:{render:this.renderMainRow,onClick:this.clickMainRow},before:"\u641c\u7d22"+this.label+"\u8d44\u6599"}))}),this.onSearchMain=(e=>s.a(this,void 0,void 0,function*(){yield this.controller.searchMain(e)})),this.renderMainRow=((e,t)=>l.a.createElement(this.mainRowContent,Object.assign({},e))),this.clickMainRow=(e=>s.a(this,void 0,void 0,function*(){this.ceasePage(),void 0!==this.controller.entity.owner?yield this.showDiv(this.entity.getIdFromObj(e)):this.returnCall(e)})),this.divView=(e=>l.a.createElement(d.Page,{header:"\u9009\u62e9Div"},l.a.createElement(c.List,{items:e.items,item:{render:this.renderDivRow,onClick:this.clickDivRow}}))),this.renderDivRow=((e,t)=>l.a.createElement(this.divRowContent,Object.assign({},e))),this.clickDivRow=(e=>{this.ceasePage(),this.returnCall(e)})}open(e){return s.a(this,void 0,void 0,function*(){void 0===e?yield this.showMain(e):yield this.showDiv(e)})}showMain(e){return s.a(this,void 0,void 0,function*(){this.mainRowContent=this.ui.rowContent||m.c,yield this.controller.searchMain(e),this.openPage(this.mainView)})}showDiv(e){return s.a(this,void 0,void 0,function*(){let{divs:t}=this.ui;void 0!==t&&(this.divRowContent=t[this.entity.name].rowContent),void 0===this.divRowContent&&(this.divRowContent=m.c);let i=yield this.controller.getDivItems(e);this.openPage(this.divView,{items:i})})}}var f=i(15);class g extends a.b{constructor(){super(...arguments),this.next=(()=>s.a(this,void 0,void 0,function*(){this.vForm.reset(),this.closePage()})),this.finish=(()=>{this.closePage(2)}),this.onSubmit=(()=>s.a(this,void 0,void 0,function*(){let e=this.vForm.getValues(),t=yield this.entity.save(this.id,e);t&&alert("\u8fd9\u91cc\u8fd8\u8981\u5224\u65ad\u8fd4\u56de\u503c\uff0c\u5148\u4e0d\u5904\u7406\u4e86 \n"+Object(f.a)(t)),this.openPage(()=>o.createElement(d.Page,{header:this.label+"\u63d0\u4ea4\u6210\u529f",back:"none"},o.createElement("div",{className:"m-3"},o.createElement("span",{className:"text-success"},o.createElement(c.FA,{name:"check-circle",size:"lg"})," \u6210\u529f\u63d0\u4ea4\uff01"),o.createElement("div",{className:"mt-5"},o.createElement("button",{className:"btn btn-primary mr-3",onClick:this.next},"\u7ee7\u7eed\u5f55\u5165"),o.createElement("button",{className:"btn btn-outline-primary",onClick:this.finish},"\u4e0d\u7ee7\u7eed")))))})),this.view=(()=>o.createElement(d.Page,{header:this.label},this.vForm.render("py-3")))}buildForm(e){this.vForm=this.createForm(void 0,e)}open(e){return s.a(this,void 0,void 0,function*(){this.buildForm(e),this.openPage(this.view)})}render(e){return this.buildForm(e),this.vForm.render()}loadId(e){return s.a(this,void 0,void 0,function*(){this.id=e})}resetForm(){this.vForm.reset()}}class b extends g{}class y extends d.PageItems{constructor(e){super(!0),this.tuid=e}load(e,t,i){return s.a(this,void 0,void 0,function*(){return yield this.tuid.search(e,t,i)})}setPageStart(e){this.pageStart=void 0===e?0:e.id}}class w extends a.b{constructor(){super(...arguments),this.onSearch=(e=>s.a(this,void 0,void 0,function*(){yield this.controller.searchMain(e)})),this.renderRow=((e,t)=>o.createElement(this.rowContent,Object.assign({},e))),this.clickRow=(e=>{this.callOnSelected(e)}),this.rowKey=(e=>{let{id:t}=e;return t}),this.view=Object(p.a)(()=>{let e,t=o.createElement(c.SearchBox,{className:"mx-1 w-100",initKey:"",onSearch:this.onSearch,placeholder:"\u641c\u7d22"+this.label}),{owner:i}=this.entity;if(void 0!==i){let t=i.valueFromId(this.ownerId);e=o.createElement("div",null,"owner: ",Object(f.a)(t))}return o.createElement(d.Page,{header:t},e,o.createElement(c.List,{items:this.controller.PageItems.items,item:{render:this.renderRow,onClick:this.clickRow,key:this.rowKey},before:"\u641c\u7d22"+this.label+"\u8d44\u6599"}))})}open(e){return s.a(this,void 0,void 0,function*(){this.rowContent=this.ui.rowContent||m.c,void 0!==this.entity.owner&&(this.ownerId=Number(e)),yield this.controller.searchMain(""),this.openPage(this.view)})}callOnSelected(e){void 0!==this.onSelected?this.onSelected(e):alert("onSelect is undefined")}}class E extends w{onSelected(e){return s.a(this,void 0,void 0,function*(){!1===this.controller.isFrom?this.event("edit",e.id):this.event("info",e.id)})}}class C extends a.a{buildPageItems(){return new y(this.entity.owner||this.entity)}searchMain(e){return s.a(this,void 0,void 0,function*(){void 0===this.PageItems&&(this.PageItems=this.buildPageItems()),void 0!==e&&(yield this.PageItems.first(e))})}getDivItems(e){return s.a(this,void 0,void 0,function*(){return yield this.entity.searchArr(e,void 0,0,1e3)})}}class x extends C{constructor(e,t,i,s){if(super(e,t,i,s),void 0!==this.proxies){this.proxyLinks=[];for(let e in this.proxies){let t=this.cUq.linkFromName("tuid",e);this.proxyLinks.push(t)}}}from(){let e=this.entity.cFrom();return void 0===e?this:e}cUqFrom(){return this.entity.cUqFrom()}cEditFrom(){return this.entity.cUqFrom().cTuidEditFromName(this.entity.name)}cInfoFrom(){return this.entity.cUqFrom().cTuidInfoFromName(this.entity.name)}cSelectFrom(){return this.entity.cUqFrom().cTuidSelectFromName(this.entity.name)}getLable(e){if(e===this.entity)return this.label;let{name:t}=e,{arrs:i}=this.res;if(void 0!==i){let e=i[t];if(void 0!==e){let t=e.label;if(void 0!==t)return t}}return t}get VTuidMain(){return h}get VTuidEdit(){return u}get VTuidList(){return E}internalStart(e){return s.a(this,void 0,void 0,function*(){this.isFrom=void 0!==this.entity.schemaFrom,yield this.openVPage(this.VTuidMain)})}onEvent(e,t){return s.a(this,void 0,void 0,function*(){switch(e){default:return;case"new":yield this.onNew();break;case"list":yield this.onList();break;case"edit":return void(yield this.onEdit(t));case"item-changed":return void this.itemChanged(t);case"info":let i=new P(this.cUq,this.entity,this.ui,this.res);return void(yield i.start(t))}})}edit(e){return s.a(this,void 0,void 0,function*(){let t=this.ui&&this.ui.CTuidEdit;void 0===t?yield this.openVPage(this.VTuidEdit,e):yield new t(this.cUq,this.entity,this.ui,this.res).start(e)})}onNew(){return s.a(this,void 0,void 0,function*(){yield this.edit(void 0)})}onList(){return s.a(this,void 0,void 0,function*(){let e=this.ui&&this.ui.CTuidList;void 0===e?yield this.openVPage(this.VTuidList,void 0):yield new e(this.cUq,this.entity,this.ui,this.res).start(void 0)})}onEdit(e){return s.a(this,void 0,void 0,function*(){let t=void 0;void 0!==e&&(t=yield this.entity.load(e)),this.edit(t)})}itemChanged({id:e,values:t}){if(void 0===this.PageItems)return;let i=this.PageItems.items.find(t=>t.id===e);void 0!==i&&n.a.merge(i,t)}}class k extends x{internalStart(e){return s.a(this,void 0,void 0,function*(){this.isFrom=void 0!==this.entity.schemaFrom,yield this.openVPage(this.VTuidMain)})}}class N extends x{internalStart(e){return s.a(this,void 0,void 0,function*(){this.isFrom=void 0!==this.entity.schemaFrom,"number"===typeof e?yield this.onEdit(e):yield this.edit(e)})}edit(e){return s.a(this,void 0,void 0,function*(){yield this.openVPage(this.VTuidEdit,e)})}}class S extends x{internalStart(e){return s.a(this,void 0,void 0,function*(){this.isFrom=void 0!==this.entity.schemaFrom,yield this.openVPage(this.VTuidList)})}}class F extends C{internalStart(e){return s.a(this,void 0,void 0,function*(){yield this.openVPage(this.VTuidSelect,e)})}beforeStart(){return s.a(this,void 0,void 0,function*(){return yield this.entity.loadSchema(),void 0!==this.PageItems&&this.PageItems.reset(),!0})}get VTuidSelect(){return v}idFromItem(e){return e.id}}class P extends C{internalStart(e){return s.a(this,void 0,void 0,function*(){let t=yield this.entity.load(e);yield this.openVPage(this.VTuidInfo,t)})}get VTuidInfo(){return b}}i.d(t,"d",function(){return k}),i.d(t,"a",function(){return N}),i.d(t,"c",function(){return S}),i.d(t,"e",function(){return F}),i.d(t,"b",function(){return P}),i.d(t,"g",function(){return h}),i.d(t,"f",function(){return u}),i.d(t,"i",function(){return v}),i.d(t,"h",function(){return E})},function(e,t,i){"use strict";var s=i(1),r=i(0),n=i.n(r),a=i(6);class o{constructor(e){this.view=(()=>r.createElement("div",null)),this.label=e}render(){return r.createElement("div",{key:this.key,className:"px-3"},r.createElement("div",{className:"form-group row"},r.createElement("label",{className:"col-sm-2 col-form-label"},this.label),r.createElement("div",{className:"col-sm-10"},this.renderContent())))}setAddRow(e){}get key(){return this.label}getVFields(){}getVArr(){}getVSubmit(){}renderContent(){return r.createElement("div",{className:"form-control form-control-plaintext bg-white border border-info rounded "},"content")}}class l extends o{constructor(e,t){super(e),this.vField=t}get key(){return this.vField.name}getVFields(){return[this.vField]}renderContent(){return this.vField.render()}}class c extends o{constructor(e,t){super(e),this.vArr=t}setAddRow(e){this.vArr.setAddRow(e)}get key(){return this.vArr.name}getVArr(){return this.vArr}render(){return r.createElement(r.Fragment,{key:this.key},this.vArr&&this.vArr.render())}}class d extends o{constructor(e){super(void 0),this.vSubmit=e}get key(){return"$submit"}getVSubmit(){return this.vSubmit}render(){return r.createElement("div",{key:"$submit",className:"px-3"},r.createElement("div",{className:"form-group row"},r.createElement("div",{className:"offset-sm-2 col-sm-10"},this.vSubmit.render())))}}var h=i(10),u=i(4);class m extends h.d{constructor(e){super(),this.onClickSubmit=(()=>s.a(this,void 0,void 0,function*(){this.vForm.submit()})),this.view=Object(a.a)(()=>{let{isOk:e}=this.vForm;return r.createElement("button",{type:"button",onClick:this.onClickSubmit,className:this.className,disabled:!1===e},this.caption)}),this.vForm=e,this.caption=this.vForm.submitCaption,this.className="btn btn-primary w-25"}}s.b([u.l],m.prototype,"caption",void 0),s.b([u.l],m.prototype,"className",void 0);var p=i(5),v=i.n(p),f=i(3);class g{}class b extends g{check(e,t){switch(typeof t){default:case"boolean":return;case"object":if(null!==t)return;break;case"string":if(t.trim().length>0)return;break;case"number":if(NaN!==t)return;break;case"undefined":}e.push("\u4e0d\u80fd\u4e3a\u7a7a")}}class y extends g{check(e,t){if(void 0===t||null===t)return;NaN===Number(t)&&e.push("\u5fc5\u987b\u662f\u6570\u5b57")}}class w extends g{check(e,t){if(void 0===t||null===t)return;let i=Number(t);!0!==Number.isNaN(i)&&!1!==Number.isInteger(i)||e.push("\u5fc5\u987b\u662f\u6574\u6570")}}class E extends y{constructor(e){super(),this.min=e}check(e,t){super.check(e,t),Number(t)<this.min&&e.push("\u4e0d\u80fd\u5c0f\u4e8e"+this.min)}}class C extends y{constructor(e){super(),this.max=e}check(e,t){super.check(e,t),Number(t)>this.max&&e.push("\u4e0d\u80fd\u5c0f\u4e8e"+this.max)}}class x extends h.d{constructor(e,t,i,s){super(),this.form=e,this.field=t,this.name=t.name,this.fieldUI=i||{},this.fieldRes=s||{},this.init()}init(){this.buildRules()}buildRules(){this.rules=[];let{required:e}=this.fieldUI;(!0===e||void 0!==this.field&&!1===this.field.null)&&this.rules.push(new b)}get checkRules(){let e=[];for(let t of this.rules)t.check(e,this.value);return e}get isOk(){if(0===this.rules.length)return!0;return 0===this.checkRules.length}get value(){return this.form.values[this.name]}setValue(e){this.form.values[this.name]=e}get error(){return this.form.errors[this.name]}set error(e){this.form.errors[this.name]=e}parse(e){return e}get readonly(){let{mode:e}=this.form;return e===$.readonly||e===$.edit&&!1===this.fieldUI.editable}}s.b([u.e],x.prototype,"checkRules",null),s.b([u.e],x.prototype,"isOk",null),s.b([u.e],x.prototype,"value",null);class k extends x{constructor(){super(...arguments),this.renderError=(e=>{let{errors:t}=this.form,i=t[this.name];if(void 0!==i)return r.createElement("div",{className:e},r.createElement(f.FA,{name:"exclamation-circle"})," ",i)}),this.ref=(e=>{this.input=e,this.setInputValue()}),this.onFocus=(()=>{this.error=void 0}),this.onBlur=(()=>{let e=this.checkRules;e.length>0&&(this.error=e[0]),this.form.computeFields()}),this.onChange=(e=>{let t=this.parse(e.currentTarget.value);null!==t&&this.setValue(t)}),this.view=Object(a.a)(()=>{let e,t,i,{required:s}=this.fieldUI,{placeHolder:n,suffix:a}=this.fieldRes,o=["form-control","form-control-input"];return!0===this.readonly?t=r.createElement("input",{className:v()(o,"bg-light"),ref:this.ref,type:this.inputType,readOnly:!0}):(t=r.createElement("input",{className:v()(o),ref:this.ref,type:this.inputType,onFocus:this.onFocus,onBlur:this.onBlur,onChange:this.onChange,placeholder:n,readOnly:!1,maxLength:this.maxLength,onKeyPress:this.onKeyPress}),!0!==s&&!1!==this.field.null||(e=r.createElement(N,null))),i=void 0===a?t:r.createElement("div",{className:"input-group"},t,r.createElement("div",{className:"input-group-append"},r.createElement("span",{className:"input-group-text"},a))),r.createElement(r.Fragment,null,e,i,this.renderError("text-danger small mt-1 mx-2"))})}get maxLength(){}setValue(e){super.setValue(e),this.setInputValue()}setInputValue(){if(!this.input)return;let e=this.value;this.input.value=null===e||void 0===e?"":e}}const N=()=>r.createElement("b",{style:{color:"red",position:"absolute",left:"0.1em",top:"0.5em"}},"*");class S extends k{constructor(){super(...arguments),this.inputType="text"}get maxLength(){return this.field.size}}const F=45,P=46;class T extends k{constructor(){super(...arguments),this.inputType="number",this.onKeyPress=(e=>{let t=e.charCode;if(!(8===t||0===t||13===t||t>=48&&t<=57))if(void 0!==this.extraChars&&this.extraChars.indexOf(t)>=0)switch(t){case P:this.onKeyDot();break;case F:this.onKeyNeg(),e.preventDefault()}else e.preventDefault()})}init(){if(super.init(),this.extraChars=[],void 0!==this.fieldUI){let{min:e,max:t}=this.fieldUI;void 0!==e?e<0&&this.extraChars.push(F):this.extraChars.push(F)}switch(this.field.type){case"dec":case"bigint":case"int":case"smallint":case"tinyint":this.extraChars.push(P)}}buildRules(){super.buildRules(),this.rules.push(new y);let{min:e,max:t}=this.fieldUI;void 0!==e&&this.rules.push(new E(e)),void 0!==t&&this.rules.push(new C(t))}parse(e){try{if(0===e.trim().length)return;let i=Number(e);return NaN===i?null:i}catch(t){return null}}setInputValue(){if(!this.input)return;let e=this.value;this.parse(this.input.value)!=e&&(this.input.value=null===e||void 0===e?"":e)}onKeyDot(){let e=this.input.value;e.indexOf(".")>=0&&(this.input.value=e.replace(".",""))}onKeyNeg(){let e=this.input.value,t=e.indexOf("-");e=t>=0?e.replace("-",""):"-"+e,this.input.value=e}}class V extends T{buildRules(){super.buildRules(),this.rules.push(new w)}}class I extends T{}class L extends S{}class A extends S{}class q extends S{}class R extends x{constructor(e,t,i){super(e,t,void 0,i),this.view=Object(a.a)(()=>{let e=this.form.values[this.field.name],{placeHolder:t,suffix:i}=this.fieldRes;null===e&&(e="");let s,r=n.a.createElement("input",{className:"form-control form-control-input bg-light",type:"text",placeholder:t,readOnly:!0,value:e});return s=void 0===i?r:n.a.createElement("div",{className:"input-group"},r,n.a.createElement("div",{className:"input-group-append"},n.a.createElement("span",{className:"input-group-text"},i)))})}}var M=i(9),O=i.n(M),D=i(2);class U extends h.d{constructor(e,t,i){super(),this.rowPage=(()=>r.createElement(D.Page,{header:this.label,back:"close"},this.vForm.render("py-3"))),this.onSubmit=(()=>s.a(this,void 0,void 0,function*(){let{valueBoxs:e}=this.vForm;yield this.onRowChanged(e)})),this.onRowChanged=(e=>s.a(this,void 0,void 0,function*(){void 0===this.rowValues?(e.$owner=this.ownerForm.values,this.list.push(e),void 0===this.onEditRow?this.vForm.reset():yield this.onEditRow(void 0,this.onRowChanged)):(O.a.merge(this.rowValues,e),void 0===this.onEditRow&&D.nav.pop())})),this.renderItem=((e,t)=>void 0===this.rowContent?r.createElement("div",{className:"px-3 py-2"},r.createElement(h.a,Object.assign({},e))):r.createElement(this.rowContent,Object.assign({},e))),this.showRow=(e=>s.a(this,void 0,void 0,function*(){void 0===this.onEditRow?(this.vForm.reset(),void 0!==e&&this.vForm.setValues(e),D.nav.push(r.createElement(this.rowPage,null))):yield this.onEditRow(e,this.onRowChanged)})),this.editRow=(e=>s.a(this,void 0,void 0,function*(){this.rowValues=e;let{vSubmit:t}=this.vForm;void 0!==t&&(t.caption=this.editSubmitCaption,t.className="btn btn-outline-success"),this.vForm.mode=this.ownerForm.mode,yield this.showRow(e)})),this.internalAddRow=(()=>s.a(this,void 0,void 0,function*(){this.rowValues=void 0;let{vSubmit:e}=this.vForm;e.caption=this.newSubmitCaption,e.className="btn btn-outline-success",this.vForm.reset(),this.vForm.mode=$.new,yield this.showRow(void 0)})),this.view=(()=>{let e;void 0===this.addRow&&this.mode===$.readonly||(e=r.createElement("button",{onClick:this.addRow||this.internalAddRow,type:"button",className:"btn btn-link p-0"},this.ownerForm.arrTitleNewButton));let t=this.header||r.createElement("div",{className:"px-3 bg-light small",style:{paddingTop:"1px",paddingBottom:"1px"}},r.createElement("div",{className:"flex-fill align-self-center"},this.label),e);return r.createElement(f.List,{className:"pb-3",header:t,none:r.createElement(f.Muted,{className:"px-3 py-2"},this.none),items:this.list,item:{render:this.renderItem,onClick:this.editRow}})}),this.ownerForm=e;let{name:n,fields:a}=t;this.name=n;let{ui:o,res:l,mode:c,inputs:d,values:u}=e,m=l.arrs,p=void 0!==m?m[n]:{},{label:v,none:g,newSubmit:b,editSubmit:y}=p;this.none=g||e.none,this.newSubmitCaption=b||e.arrNewCaption,this.editSubmitCaption=y||e.arrEditCaption,this.label=v||n;let w=o&&o.items[n]||{};this.rowContent=w.rowContent,this.mode=c,void 0===this.onEditRow?this.vForm=new W({fields:a,arrs:void 0,ui:w,res:p,inputs:d[n],none:e.none,submitCaption:"submit",arrNewCaption:void 0,arrEditCaption:void 0,arrTitleNewButton:void 0,mode:c},c===$.readonly?void 0:this.onSubmit):this.onEditRow=i,this.list=u[n]}reset(){this.vForm.reset(),this.list.clear()}setAddRow(e){this.addRow=e}}var B=i(15);const j={textAlign:"left",paddingLeft:"0.75rem",paddingRight:"0.75rem",overflow:"hidden"};class _ extends x{constructor(e,t,i,n){super(e,t,i,n),this.onClick=(()=>s.a(this,void 0,void 0,function*(){if(!0===this.readonly){if(!this.value)return;return void(yield this.tuid.showInfo(this.value.id))}let e;void 0!==this.input?e=yield this.input.select(this.vForm,this.field,this.vForm.getValues()):(alert("call undefined"),e=0),this.setValue(this.tuid.boxId(e))})),this.view=Object(a.a)(()=>{let e,t,{placeHolder:i}=this.fieldRes,s=!1,{_ownerField:n}=this.field;if(void 0!==n){let{name:e,arr:t}=n;s=null===this.vForm.getValue(e)}if(null===this.value)e=r.createElement(r.Fragment,null,i||this.input&&this.input.placeHolder);else if("object"===typeof this.value)e=Object(B.b)(this.value);else{let t=this.tuid.boxId(this.value);e=Object(B.b)(t)}if(!0===this.readonly)return r.createElement("div",{className:"form-control form-control-plaintext border border-info rounded bg-light cursor-pointer",onClick:this.onClick},e);let{required:a}=this.fieldUI;return!0!==a&&!1!==this.field.null||(t=r.createElement(N,null)),r.createElement(r.Fragment,null,t,r.createElement("button",{className:"form-control btn btn-outline-info",type:"button",disabled:s,style:j,onClick:this.onClick},e))}),this.tuid=t._tuid,this.vForm=e,this.input=e.inputs[t.name]}}class H{constructor(e,t,i){this.vForm=e,this.onSubmit=i;let{fields:s,arrs:r,ui:n,res:a}=t;if(this.fields=s,this.arrs=r,void 0!==n){let{items:e,layout:t}=n;this.formItems=e,this.layout=t}this.res=a}build(){return void 0===this.layout?this.bandsOnFly():this.bandsFromLayout()}resFromName(e,t){if(void 0===t)return;let{fields:i}=t;return void 0!==i?i[e]||e:void 0}bandsOnFly(){let e=[];if(this.bandsFromFields(e,this.fields,this.res),void 0!==this.arrs)for(let t of this.arrs)e.push(this.bandFromArr(t));return void 0!==this.onSubmit&&e.push(new d(new m(this.vForm))),e}bandsFromFields(e,t,i){if(void 0!==t)for(let s of t)e.push(this.bandFromField(s,i))}bandsFromLayout(){return[]}bandFromField(e,t){let i,s,r,n,{name:a}=e,o=this.resFromName(a,t);return"object"===typeof o?(s=o.label,i=o):(s=o,i=void 0),void 0!==this.formItems&&(n=this.formItems[a]),void 0===(r="function"===typeof n?new R(this.vForm,e,i):function(e,t,i,s){let r;switch(t.type){default:return;case"tinyint":case"smallint":case"int":r=V;break;case"bigint":let{_tuid:e}=t;if(void 0!==e)return;r=V;break;case"dec":r=I;break;case"char":r=S;break;case"text":r=L;break;case"datetime":r=A;break;case"date":r=q}return new r(e,t,i,s)}(this.vForm,e,n,i))&&(r=new _(this.vForm,e,n,i)),new l(s||a,r)}bandFromArr(e){let{name:t,fields:i}=e,s=new U(this.vForm,e);return new c(t,s)}}var $;!function(e){e[e.new=0]="new",e[e.edit=1]="edit",e[e.readonly=2]="readonly"}($||($={}));class W{constructor(e,t){this.vFields={},this.vArrs={},this.onFormSubmit=(e=>(e.preventDefault(),!1)),this.view=Object(a.a)(({className:e})=>r.createElement("form",{className:e,onSubmit:this.onFormSubmit},this.bands.map(e=>e.render())));let{fields:i,arrs:s,ui:n,res:o,inputs:l,none:c,submitCaption:d,arrNewCaption:h,arrEditCaption:u,arrTitleNewButton:m,mode:p}=e;this.fields=i,this.arrs=s,this.ui=n,void 0!==this.ui&&(this.formItems=this.ui.items),this.res=o,this.inputs=l,this.none=c,this.submitCaption=d,this.arrNewCaption=h,this.arrEditCaption=u,this.arrTitleNewButton=m||r.createElement("small",null,r.createElement(f.FA,{name:"plus"})," \u65b0\u589e"),this.mode=void 0===t?$.readonly:p,this.buildFormValues(),this.buildBands(e,t),this.onSubmit=t}buildBands(e,t){this.bandColl={};let i=new H(this,e,t);this.bands=i.build();for(let s of this.bands){this.bandColl[s.key]=s;let e=s.getVFields();if(void 0!==e)for(let s of e)this.vFields[s.name]=s;let t=s.getVArr();void 0!==t&&(this.vArrs[t.name]=t);let i=s.getVSubmit();void 0!==i&&(this.vSubmit=i)}}getBand(e){return this.bandColl[e]}computeFields(){if(void 0===this.formItems)return;let e=this.values;for(let t in this.formItems){let i=this.formItems[t];"function"===typeof i&&(e[t]=i.call(this,e))}}submit(){return s.a(this,void 0,void 0,function*(){void 0!==this.onSubmit&&(yield this.onSubmit())})}getValues(){let e={},t=this.values;for(let i of this.fields){let{name:s}=i,r=t[s];e[s]=null!==r&&"object"===typeof r?r.id:r}if(void 0!==this.arrs)for(let i of this.arrs){let{name:t,fields:s,id:r,order:n}=i,a=e[t]=[],o=this.vArrs[t].list;for(let e of o){let t={};void 0!==r&&(t[r]=e[r]),void 0!==n&&(t[n]=e[n]);for(let i of s){let{name:s}=i,r=e[s];t[s]=null!==r&&"object"===typeof r?r.id:r}a.push(t)}}return e}get valueBoxs(){let e={},t=this.values;for(let i of this.fields){let{name:s,_tuid:r}=i,n=t[s];e[s]=void 0===r||"object"===typeof n?n:r.boxId(n)}if(void 0===this.arrs)return e;for(let i of this.arrs){let{name:t,fields:s,id:r,order:n}=i,a=e[t]=this.vArrs[t].list.slice();for(let e of a)for(let t of s){let{name:i,_tuid:s}=t,r=e[i];e[i]=void 0===s||"object"===typeof r?r:s.boxId(r)}}return e}setValues(e){if(void 0===e)return void this.reset();let t=this.values,i=this.errors;for(let s of this.fields){let r=s.name;i[r]=void 0;let n=e[r];t[r]=n}for(let s in this.vArrs){let i=e[s];if(void 0===i)continue;let r=t[s];r.clear(),r.push(...i)}}get isOk(){for(let e in this.vFields)if(!1===this.vFields[e].isOk)return!1;return!0}reset(){let e=this.values,t=this.errors;for(let i of this.fields){let s=i.name;e[s]=null,t[s]=void 0}for(let i in this.vFields){let e=this.vFields[i];void 0!==e.name&&e.setValue(null)}for(let i in this.vArrs){this.vArrs[i].reset()}}getValue(e){return this.values[e]}setValue(e,t){this.values[e]=t}setError(e,t){this.errors[e]=t}buildFieldValues(e){let t={valueFromFieldName:function(e){return this[e]}};for(let i of e){t[i.name]=null}return t}buildObservableValues(){let e=this.buildFieldValues(this.fields);if(void 0!==this.arrs)for(let t of this.arrs)e[t.name]=u.l.array([],{deep:!0});return Object(u.l)(e)}buildFormValues(){this.values=this.buildObservableValues(),this.errors=Object(u.l)(this.buildFieldValues(this.fields))}render(e="py-3"){return r.createElement(this.view,{className:e})}}s.b([u.e],W.prototype,"isOk",null),i.d(t,"a",function(){return $}),i.d(t,"b",function(){return W})},function(e,t,i){"use strict";i.d(t,"a",function(){return o});var s=i(1),r=i(17),n=i(11),a=i(26);class o{constructor(e,t,i,r){this.startWait=(()=>{void 0!==this.ui&&this.ui.startWait()}),this.endWait=((e,t)=>{void 0!==this.ui&&this.ui.endWait(),void 0!==t&&t("\u8bbf\u95eewebapi\u8d85\u65f6 "+e)}),this.showError=(e=>s.a(this,void 0,void 0,function*(){void 0!==this.ui&&(yield this.ui.showError(e))})),this.isCenter=e,this.hostUrl=t,this.apiToken=i,this.ui=r,this.timeout=!0===a.b?5e5:5e3}used(){this.post("",{})}get(e,t){return s.a(this,void 0,void 0,function*(){if(t){let i=Object.keys(t);if(i.length>0){let s="?";for(let r of i){void 0!==t[r]&&(e+=s+r+"="+t[r],s="&")}}}let i=this.buildOptions();return i.method="GET",yield this.innerFetch(e,i)})}post(e,t){return s.a(this,void 0,void 0,function*(){let i=this.buildOptions();return i.method="POST",i.body=JSON.stringify(t),yield this.innerFetch(e,i)})}put(e,t){return s.a(this,void 0,void 0,function*(){let i=this.buildOptions();return i.method="PUT",i.body=JSON.stringify(t),yield this.innerFetch(e,i)})}delete(e,t){return s.a(this,void 0,void 0,function*(){let i=this.buildOptions();return i.method="DELETE",i.body=JSON.stringify(t),yield this.innerFetch(e,i)})}fetch(e,t,i,r){return s.a(this,void 0,void 0,function*(){let a=this;this.startWait();let o=e;function l(e){return{channel:a,url:o,options:t,resolve:i,reject:r,error:e}}try{console.log("%s %s",t.method,o);let d=setTimeout(()=>a.endWait(e,r),this.timeout),h=yield fetch(encodeURI(o),t);if(!1===h.ok)throw clearTimeout(d),a.endWait(),console.log("call error %s",h.statusText),h.statusText;let u=h.headers.get("content-type");if(u&&u.indexOf("json")>=0)return h.json().then(e=>s.a(this,void 0,void 0,function*(){if(clearTimeout(d),a.endWait(),!0===e.ok)return i(e.res);void 0===e.error?yield a.showError(l("not valid tonva json")):(yield a.showError(l(e.error)),r(e.error))})).catch(e=>s.a(this,void 0,void 0,function*(){yield a.showError(l(e.message))}));{let e=yield h.text();clearTimeout(d),a.endWait(),i(e)}}catch(c){if("string"===typeof c&&!0===c.toLowerCase().startsWith("unauthorized"))return void n.c.logout();yield this.showError(l(c.message))}})}innerFetch(e,t){return s.a(this,void 0,void 0,function*(){let i=this.hostUrl+e;return!0===this.isCenter&&void 0===this.apiToken&&Object(r.g)()?yield Object(r.d)(i,t.method,t.body):yield new Promise((e,r)=>s.a(this,void 0,void 0,function*(){yield this.fetch(i,t,e,r)}))})}callFetch(e,t,i){return s.a(this,void 0,void 0,function*(){let r=this.buildOptions();return r.method=t,r.body=i,yield new Promise((t,i)=>s.a(this,void 0,void 0,function*(){yield this.fetch(e,r,t,i)}))})}buildOptions(){let{language:e,culture:t}=n.c,i=new Headers;i.append("Content-Type","application/json;charset=UTF-8");let s=e;return t&&(s+="-"+t),i.append("Accept-Language",s),this.apiToken&&i.append("Authorization",this.apiToken),{headers:i}}}},,function(e,t,i){"use strict";i.d(t,"b",function(){return n}),i.d(t,"a",function(){return a});var s=i(9),r=i.n(s);const n={lang:void 0,district:void 0};function a(e){let{lang:t,district:i}=n,s={};if(void 0===e)return s;r.a.merge(s,e._);let a=e[t];if(void 0===a)return s;r.a.merge(s,a._);let o=a[i];if(void 0===o)return s;r.a.merge(s,o);let{entity:l}=s;if(void 0!==l)for(let r in l)l[r.toLowerCase()]=l[r];return s}!function(){let e,t,i=navigator.languages&&navigator.languages[0]||navigator.language;if(i){let s=i.split("-");e=s[0],s.length>1&&(t=s[1])}else e="zh",t="CN";!function(e,t){n.lang=e,n.district=t}(e,t)}()},function(e,t,i){"use strict";var s=i(45);i.d(t,"CApp",function(){return s.a});i(81),i(52),i(54);var r=i(29);i.d(t,"CTuidEdit",function(){return r.a}),i.d(t,"CTuidList",function(){return r.c}),i.d(t,"CTuidMain",function(){return r.d}),i.d(t,"CTuidSelect",function(){return r.e}),i.d(t,"VTuidEdit",function(){return r.f}),i.d(t,"VTuidMain",function(){return r.g}),i.d(t,"VTuidMainList",function(){return r.h}),i.d(t,"VTuidSelect",function(){return r.i});var n=i(51);i.d(t,"CSheet",function(){return n.a});i(41),i(53),i(56),i(55);var a=i(10);i.d(t,"PureJSONContent",function(){return a.b});i(30);var o=i(82);i.o(o,"VEntity")&&i.d(t,"VEntity",function(){return o.VEntity}),i.o(o,"tv")&&i.d(t,"tv",function(){return o.tv});i(49);var l=i(8);i.d(t,"VEntity",function(){return l.b});i(20),i(48)},function(e,t,i){"use strict";var s=i(1),r=i(0),n=i(4);class a{constructor(e){this.formView=e}render(){return r.createElement("div",{className:"col-sm-10"},this.renderControl())}get hasError(){return!1}get filled(){return!1}clear(){}clearErrors(){}readValues(e){}setError(e,t){}setInitValues(e){}isOk(){return this.validate(),!this.hasError}validate(){}}s.b([n.e],a.prototype,"hasError",null),s.b([n.e],a.prototype,"filled",null);class o extends a{constructor(e,t,i){super(e),this.field=t,this.face=i,this.init(),this.setProps()}ref(e){this.element=e}init(){this.rules=[];let e=this.field.rules;void 0!==e&&(!0===Array.isArray(e)?this.rules.push(...e):this.rules.push(e))}setProps(){return this.props={ref:this.ref.bind(this),name:this.field.name}}get hasError(){return void 0!==this.error}get filled(){return void 0!==this.value&&this.value!==this.field.defaultValue}clearValue(){this.value=void 0}clear(){this.clearErrors(),this.clearValue()}clearErrors(){this.isOK=void 0,this.error=void 0}readValues(e){e[this.field.name]=this.value}setError(e,t){}setInitValues(e){}getValueFromElement(){return this.value}validate(){try{let t=this.getValueFromElement();if(this.rules.length>0){let e;for(let i of this.rules){console.log("validate: %s",t);let s=i(t);if(console.log("validate: %s err: %s",t,s),!0===s)this.error=void 0,e=!0;else if(void 0!==s)return this.error=s,void(this.isOK=!1)}this.isOK=e}this.value=t}catch(e){this.error=e.message}}render(){let e;if(void 0!==this.face){let{notes:t}=this.face;void 0!==t&&(e=r.createElement("small",{className:"text-muted"},t))}return r.createElement("div",{className:"col-sm-10"},this.renderControl(),e)}}s.b([n.l],o.prototype,"isOK",void 0),s.b([n.l],o.prototype,"error",void 0),s.b([n.l],o.prototype,"value",void 0),s.b([n.e],o.prototype,"hasError",null),s.b([n.e],o.prototype,"filled",null);class l extends a{constructor(e){super(e),this.otherClick=this.otherClick.bind(this)}otherClick(){let e=this.formView.props.onOther;void 0!==e&&e(this.formView.readValues())}renderControl(){console.log("buttons.renderControl");let e=this.formView.nothing,t=this.formView.hasError,i=this.formView.props;console.log("buttons.renderControl nothing:%s hasError:%s",e,t);let s,{submitButton:n,otherButton:a,onOther:o}=i;return void 0!==a&&(s=r.createElement("button",{className:"btn btn-outline-info ml-auto",onClick:this.otherClick},a)),r.createElement("div",{className:"d-flex justify-content-start"},r.createElement("button",{className:"btn btn-primary",type:"submit",disabled:e||t},n||"\u63d0\u4ea4"),s)}}var c=i(9),d=i(5);const h="\u5fc5\u987b\u586b\u5165\u8981\u6c42\u5185\u5bb9";class u extends o{init(){super.init(),!0===this.field.required&&this.rules.push(e=>null!==e&&void 0!==e&&0!==e.trim().length||h)}getValueFromElement(){return this.parseValue(this.element.value)}setProps(){super.setProps(),c.assign(this.props,{onBlur:this.onBlur.bind(this),onFocus:this.onFocus.bind(this),onChange:this.onChange.bind(this)});let e=this.face;return void 0!==e&&c.assign(this.props,{placeholder:e.placeholder}),this.props}parseValue(e){return e}onBlur(){this.validate()}onChange(){console.log("onChange"),this.validate()}onFocus(){this.clearErrors()}className(){return d({"form-control":!0,"has-success":!0===this.isOK,"is-invalid":void 0!==this.error,"is-valid":void 0===this.error&&!0===this.isOK})}renderInput(){return r.createElement("input",Object.assign({className:this.className()},this.props))}ref(e){super.ref(e),e&&(e.value=void 0===this.value?"":this.value)}renderError(){return void 0===this.error?null:r.createElement("div",{className:"invalid-feedback"},this.error)}clearValue(){super.clearValue(),this.element.value=""}setError(e,t){this.field.name===e&&(this.error=t)}setInitValues(e){let t=e[this.field.name];void 0!==t&&(this.value=t)}renderControl(){return r.createElement(r.Fragment,null,this.renderInput(),this.renderError())}}class m extends u{setProps(){let e=super.setProps();return c.assign(e,{type:"text",maxLength:this.field.maxLength}),e}parseValue(e){if(void 0!==e&&0!==e.trim().length)return e}}const p="\u65e0\u6548\u7684\u6570\u5b57",v="\u6700\u5c0f\u503c\u4e3a",f="\u6700\u5927\u503c\u4e3a",g=45,b=46;class y extends o{renderControl(){return r.createElement("div",{className:"form-control-plaintext"},r.createElement("div",{className:"alert alert-primary",role:"alert"},"don't know how to create control",r.createElement("br",null),"field: ",JSON.stringify(this.field)," must be object ",r.createElement("br",null),"face: ",JSON.stringify(this.face)," must be object ",r.createElement("br",null)))}}class w extends a{constructor(e,t){super(e),this.element=t}renderControl(){return r.createElement("div",{className:"form-control-plaintext"},this.element)}}class E extends o{constructor(){super(...arguments),this.onClick=(()=>s.a(this,void 0,void 0,function*(){let{pick:e,fromPicked:t}=this.face,i=yield e(this.face,this.formView.props,this.formView.readValues());if(void 0===i)return void(this.value=void 0);if(void 0===t)return void(this.value=i.id);let{id:s,caption:r}=t(i);this.value=s,this.caption=r})),this.onPicked=(e=>{this.value=e.id})}setInitValues(e){let t=e[this.field.name];this.value=t}controlContent(){let{itemFromId:e,fromPicked:t,initCaption:i}=this.face;if(void 0===this.value)return i||"\u8bf7\u9009\u62e9Id";if(void 0!==this.caption)return this.caption;if(void 0!==e&&void 0!==t){let i=e(this.value);if(i){let e=t(i);if(void 0!==e)return e.caption}}return String(this.value)}renderControl(){let{tuid:e,input:t}=this.face;return void 0===t?r.createElement("div",{className:"form-control-plaintext px-2 border text-primary rounded cursor-pointer",onClick:this.onClick},this.controlContent()):r.createElement("div",{className:"form-control-static "},r.createElement(t.component,{id:this.value,ui:e}))}}s.b([n.l],E.prototype,"caption",void 0);class C extends o{constructor(e,t,i){super(e,t,i),this.onIdChanged=this.onIdChanged.bind(this)}onIdChanged(e){this.value=e.id}setInitValues(e){let t=e[this.field.name];this.value=t}buildContent(){return r.createElement(this.face.input.component,Object.assign({},this.face,{id:this.value,onFormValues:()=>this.formView.readValues(),onIdChanged:this.onIdChanged}))}renderControl(){return r.createElement("div",{className:"form-control-static "},this.buildContent())}}s.b([n.l],C.prototype,"caption",void 0);var x=i(6);class k extends o{constructor(){super(...arguments),this.onClick=(()=>s.a(this,void 0,void 0,function*(){let{pick:e,fromPicked:t}=this.face,i=yield e(this.face,this.formView.props,this.formView.readValues());if(void 0===i)return void(this.value=void 0);let{id:s,caption:r}=t(i);this.value=s,this.caption=r})),this.view=Object(x.a)(()=>{let e,{content:t}=this.face;return e=void 0===this.value||null===this.value?"\u8bf7\u9009\u62e9":r.createElement(t,{id:this.value}),r.createElement("div",{className:"form-control-plaintext px-2 border text-primary rounded cursor-pointer bg-light",onClick:this.onClick},e)})}setInitValues(e){let t=e[this.field.name];this.value=t}renderControl(){return r.createElement(this.view,null)}}s.b([n.l],k.prototype,"caption",void 0),i.d(t,"b",function(){return N}),i.d(t,"a",function(){return l});const N=(e,t)=>{t.label;return void 0!==t.group?function(e,t,i){return new y(e,i,void 0)}(e,0,t):void 0!==t.field?function(e,t,i){let{field:s,face:r}=i;switch(typeof s){case"string":s={name:s,type:"string"};break;case"object":break;default:return new y(e,s,r)}let n=s.type||"string";if(void 0===r){if(void 0===(r=F[n]))return new y(e,s,r)}else if(void 0===r.type){let e=F[n];r.type=void 0===e?"string":e.type}return new(S[r.type||n]||y)(e,s,r)}(e,0,t):new w(e,t.help)},S={string:m,password:class extends m{setProps(){let e=super.setProps();return c.assign(e,{type:"password",maxLength:this.field.maxLength}),e}},number:class extends u{init(){super.init(),this.extraChars=[];let{min:e,max:t}=this.field;switch(void 0!==e?(this.rules.push(t=>{if(void 0!==t)return!(t<e)||v+e}),e<0&&this.extraChars.push(g)):this.extraChars.push(g),void 0!==t&&this.rules.push(e=>{if(void 0!==e)return!(e>t)||f+t}),this.field.type){case"dec":case"number":this.extraChars.push(b)}}parseValue(e){if(void 0===e)return;if(0===e.trim().length)return;let t=Number.parseFloat(e);if(isNaN(t))throw new Error(p);return t}setProps(){super.setProps(),c.assign(this.props,{type:"number",step:this.field.step,onKeyPress:this.onKeyPress.bind(this)})}onKeyPress(e){let t=e.charCode;if(!(8===t||0===t||13===t||t>=48&&t<=57))if(void 0!==this.extraChars&&this.extraChars.indexOf(t)>=0)switch(t){case b:this.onKeyDot();break;case g:this.onKeyNeg(),e.preventDefault()}else e.preventDefault()}onKeyDot(){let e=this.element.value;e.indexOf(".")>=0&&(this.element.value=e.replace(".",""))}onKeyNeg(){let e=this.element.value,t=e.indexOf("-");e=t>=0?e.replace("-",""):"-"+e,this.element.value=e}},checkbox:class extends o{init(){super.init();let{trueValue:e,falseValue:t}=this.field;void 0===e&&(this.trueValue=1),void 0===t&&(this.falseValue=0)}setProps(){super.setProps(),c.assign(this.props,{onChange:this.onChange.bind(this)})}clearValue(){this.element.checked=this.field.defaultValue===this.trueValue,this.value=this.getValueFromElement()}setInitValues(e){let t=e[this.field.name];void 0===t&&(t=this.field.defaultValue)}getValueFromElement(){return this.element.checked?this.trueValue:this.falseValue}onChange(){this.value=this.getValueFromElement()}renderControl(){return r.createElement("div",{className:"form-control-static"},r.createElement("label",{className:"form-control"},r.createElement("label",{className:"custom-control custom-checkbox mb-0"},r.createElement("input",{type:"checkbox",name:this.field.name,ref:this.props.ref,onChange:this.props.onChange,className:"custom-control-input"}),r.createElement("span",{className:"custom-control-indicator"}),r.createElement("span",{className:"custom-control-description"},this.face.label))))}},radiobox:class extends o{renderControl(){return r.createElement("div",{className:"form-control-static"},r.createElement("div",{className:"form-control"},this.face.list.map((e,t)=>{let i,s;return"object"!==typeof e?i=s=e:(i=e.text,s=e.value),r.createElement("label",{key:t,className:"custom-control custom-radio w-25"},r.createElement("input",{type:"radio",name:this.field.name,className:"custom-control-input"}),r.createElement("span",{className:"custom-control-indicator"}),r.createElement("span",{className:"custom-control-description"},i))})))}},select:class extends o{constructor(e,t,i){super(e,t,i),this.ref=this.ref.bind(this)}getValueFromElement(){let{selectedIndex:e,selectedOptions:t}=this.element,i=t[0].value;switch(this.field.type){case"number":i=Number(i);break;case"date":i=new Date(i);break;case"bool":"string"===typeof i&&(i="true"===i.toLowerCase())}return i}renderControl(){let{list:e}=this.face,t=[];return void 0===this.face.default&&t.push(r.createElement("option",{key:-1,value:void 0},"\u8bf7\u9009\u62e9")),t.push(...e.map((e,t)=>{let i,s;return"object"!==typeof e?i=s=e:(i=e.text,s=e.value),r.createElement("option",{key:t,value:s},i)})),r.createElement("div",{className:"form-control-static"},r.createElement("select",{name:this.field.name,className:"form-control",ref:this.ref},t))}},"pick-id":E,"pick-tuid":C,textarea:class extends u{setProps(){let e=super.setProps(),{maxLength:t}=this.field,{rows:i}=this.face;return c.assign(e,{maxLength:t,rows:i}),e}renderInput(){return r.createElement("textarea",Object.assign({ref:e=>{this.el=e,void 0!==e&&(e.value="")},className:this.className()},this.props))}},pick:k},F={string:{type:"string"},number:{type:"number"},int:{type:"number"},dec:{type:"number"},bool:{type:"checkbox"}}},function(e,t,i){"use strict";var s=i(1),r=i(4),n=i(9),a=i.n(n);const o="\t",l="\n";class c{constructor(e,t,i){this.fieldMaps={},this.entities=e,this.name=t,this.typeId=i,this.sys=this.name.indexOf("$")>=0}get sName(){return this.jName||this.name}get tvApi(){return this.entities.uqApi}getApiFrom(){return this.entities.uqApi}fieldMap(e){void 0===e&&(e="$");let t=this.fieldMaps[e];if(void 0===t){let i;if("$"===e)i=this.fields;else if(void 0!==this.arrFields){let t=this.arrFields.find(t=>t.name===e);void 0!==t&&(i=t.fields)}else if(void 0!==this.returns){let t=this.returns.find(t=>t.name===e);void 0!==t&&(i=t.fields)}if(void 0===i)return{};t={};for(let e of i)t[e.name]=e;this.fieldMaps[e]=t}return t}loadSchema(){return s.a(this,void 0,void 0,function*(){if(void 0!==this.schema)return;let e=yield this.entities.uqApi.schema(this.name);this.setSchema(e),this.buildFieldsTuid()})}setSchema(e){if(void 0===e)return;if(void 0!==this.schema)return;this.schema=e;let{name:t}=e;t!==this.name&&(this.jName=t),this.buildFieldsTuid()}buildFieldsTuid(){let{fields:e,arrs:t,returns:i}=this.schema;this.entities.buildFieldTuid(this.fields=e),this.entities.buildArrFieldsTuid(this.arrFields=t,e),this.entities.buildArrFieldsTuid(this.returns=i,e)}schemaStringify(){return JSON.stringify(this.schema,(e,t)=>{if("_tuid"!==e)return t},4)}tuidFromField(e){let{_tuid:t,tuid:i}=e;if(void 0!==i)return void 0!==t?t:e._tuid=this.entities.getTuid(i,void 0)}tuidFromName(e,t){if(void 0===this.schema)return;let{fields:i,arrs:s}=this.schema,r=this.entities;function n(e,t){if(void 0===t)return;let i=t.find(t=>t.name===e);return void 0!==i?r.getTuid(i.tuid,void 0):void 0}let a=e.toLowerCase();if(void 0===t)return n(a,i);if(void 0===s)return;let o=t.toLowerCase(),l=s.find(e=>e.name===o);return void 0!==l?n(a,l.fields):void 0}buildParams(e){let t={},i=this.fields;void 0!==i&&this.buildFieldsParams(t,i,e);let s=this.arrFields;if(void 0!==s)for(let r of s){let{name:i,fields:s}=r;if(void 0===e[i])continue;let n=[];t[i]=n;for(let t of e){let e={};this.buildFieldsParams(e,s,t),n.push(e)}}return t}buildFieldsParams(e,t,i){for(let s of t){let t,{name:r}=s,n=i[r];switch(typeof n){default:t=n;break;case"object":let e=s._tuid;t=void 0===e?n.id:e.getIdFromObj(n)}e[r]=t}}pack(e){let t=[],i=this.fields;void 0!==i&&this.packRow(t,i,e);let s=this.arrFields;if(void 0!==s)for(let r of s)this.packArr(t,r.fields,e[r.name]);return t.join("")}escape(e,t){let i=e[t.name];switch(typeof i){default:return i;case"object":let e=t._tuid;return void 0===e?i&&i.id:e.getIdFromObj(i);case"string":let s=i.length,r="",n=0;for(let t=0;t<s;t++){switch(i.charCodeAt(t)){case 9:r+=i.substring(n,t)+"\\t",n=t+1;break;case 10:r+=i.substring(n,t)+"\\n",n=t+1}}return r+i.substring(n);case"undefined":return""}}packRow(e,t,i){let s=t.length;if(0===s)return;let r="";r+=this.escape(i,t[0]);for(let n=1;n<s;n++){let e=t[n];r+=o+this.escape(i,e)}e.push(r+l)}packArr(e,t,i){if(void 0!==i)for(let s of i)this.packRow(e,t,s);e.push(l)}unpackSheet(e){let t={},i=this.fields,s=0;void 0!==i&&(s=this.unpackRow(t,i,e,s));let r=this.arrFields;if(void 0!==r)for(let n of r)s=this.unpackArr(t,n,e,s);return t}unpackReturns(e){let t={},i=0,s=this.returns;if(void 0!==s)for(let r of s)i=this.unpackArr(t,r,e,i);return t}unpackRow(e,t,i,s){let r=0,n=0,a=s,o=0,l=i.length,c=t.length;for(;s<l;s++)if(r=n,9===(n=i.charCodeAt(s))){let n=t[o],{name:d}=n;if(8!==r){if(s>a){let t=i.substring(a,s);e[d]=this.to(e,t,n)}}else e[d]=null;if(a=s+1,++o>=c){(s=i.indexOf("\n",a))>=0?++s:s=l;break}}else if(10===n){let n=t[o],{name:l}=n;if(8!==r){if(s>a){let t=i.substring(a,s);e[l]=this.to(e,t,n)}}else e[l]=null;++s,++o;break}return s}to(e,t,i){switch(i.type){default:return t;case"datetime":case"date":case"time":return new Date(Number(t));case"id":case"tinyint":case"smallint":case"int":case"dec":return Number(t);case"bigint":let e=Number(t),{_tuid:s}=i;return void 0===s?e:(s.useId(e,!0),s.boxId(e))}}unpackArr(e,t,i,s){let r=[],n=i.length,{name:a,fields:o}=t;for(;s<n;){if(10===i.charCodeAt(s)){++s;break}let e={};r.push(e),s=this.unpackRow(e,o,i,s)}return e[a]=r,s}}var d=i(93);const h=1e3;class u extends c{constructor(e,t,i){super(e,t,i),this.queue=[],this.waitingIds=[],this.cache=r.l.map({},{deep:!1}),this.buildIdBoxer()}get typeName(){return"tuid"}buildIdBoxer(){this.BoxId=function(){};let e=this.BoxId.prototype;Object.defineProperty(e,"_$tuid",{value:this.from(),writable:!1,enumerable:!1}),Object.defineProperty(e,"obj",{enumerable:!1,get:function(){if(!(void 0===this.id||this.id<=0))return this._$tuid.valueFromId(this.id)}}),e.valueFromFieldName=function(e){return this._$tuid.valueFromFieldName(e,this.obj)},e.getObj=function(){if(void 0!==this._$tuid)return this._$tuid.getCacheValue(this.id)},e.toJSON=function(){return this.id}}boxId(e){if("object"===typeof e)return e;this.useId(e);let t=new this.BoxId;return t.id=e,t}getTuidContent(){return this.entities.cUq.getTuidContent(this)}getIdFromObj(e){return e[this.idName]}setSchema(e){super.setSchema(e);let{id:t,unique:i}=e;this.idName=t,this.unique=i,this.schemaFrom=this.schema.from}buildFieldsTuid(){super.buildFieldsTuid();let{mainFields:e}=this.schema;if(void 0!==e)for(let t of e){let e=this.fields.find(e=>e.name===t.name);void 0!==e&&(t._tuid=e._tuid)}}moveToHead(e){let t=this.queue.findIndex(t=>t===e);this.queue.splice(t,1),this.queue.push(e)}valueFromId(e){let t;switch(typeof e){case"object":t=e.id;break;case"number":t=e;break;default:return}return this.getCacheValue(t)}getCacheValue(e){let t=this.cache.get(e);return void 0!==this.owner&&"object"===typeof t&&(t.$owner=this.owner.boxId(t.owner)),t}valueFromFieldName(e,t){if(void 0===t)return;if(void 0===this.fields)return;let i=this.fields.find(t=>t.name===e);if(void 0===i)return;let s=t[e],{_tuid:r}=i;return void 0===r?s:r.valueFromId(s)}resetCache(e){this.cache.delete(e);let t=this.queue.findIndex(t=>t===e);this.queue.splice(t,1),this.useId(e)}useId(e,t){if(void 0!==e&&0!==e&&!1!==Object(d.isNumber)(e))if(!0!==this.cache.has(e))if(this.entities.cacheTuids(!0===t?70:20),this.cache.set(e,e),this.waitingIds.findIndex(t=>t===e)>=0)this.moveToHead(e);else{if(this.queue.length>=h){let t=this.queue.shift();if(t===e)return void this.queue.push(t);if(!0===this.cache.has(t))this.cache.delete(t);else{let e=this.waitingIds.findIndex(e=>e===t);this.waitingIds.splice(e,1)}}this.waitingIds.push(e),this.queue.push(e)}else this.moveToHead(e)}proxied(e,t){return s.a(this,void 0,void 0,function*(){this.entities.getTuid(e,void 0).useId(t);let i=yield this.tvApi.proxied(this.name,e,t);return this.cacheValue(i),i})}cacheValue(e){if(void 0===e)return!1;let t=this.getIdFromObj(e);if(void 0===t)return!1;let i=this.waitingIds.findIndex(e=>e===t);return i>=0&&this.waitingIds.splice(i,1),this.cache.set(t,e),!0}afterCacheId(e){if(void 0!==this.fields)for(let t of this.fields){let{_tuid:i}=t;void 0!==i&&i.useId(e[t.name])}}from(){}unpackTuidIds(e){if(void 0===this.schemaFrom){let{mainFields:t}=this.schema;if(void 0===t)return e;let i=[],s=e.length,r=0;for(;r<s;){if(10===e.charCodeAt(r)){++r;break}let s={};r=this.unpackRow(s,t,e,r),i.push(s)}return i}return this.from().unpackTuidIds(e)}cacheIds(){return s.a(this,void 0,void 0,function*(){if(0===this.waitingIds.length)return;let e,t;void 0===this.owner?e=this.name:(e=this.owner.name,t=this.name);let i=this.getApiFrom(),s=yield i.tuidIds(e,t,this.waitingIds);s=this.unpackTuidIds(s);for(let r of s)!1!==this.cacheValue(r)&&(this.cacheTuidFieldValues(r),this.afterCacheId(r));yield this.cacheDivIds()})}cacheDivIds(){return s.a(this,void 0,void 0,function*(){})}load(e){return s.a(this,void 0,void 0,function*(){if(void 0===e||0===e)return;let t=this.getApiFrom(),i=yield t.tuidGet(this.name,e);return void 0!==i?(i._$tuid=this,this.cacheValue(i),this.cacheTuidFieldValues(i),i):void 0})}getDiv(e){}cacheTuidFieldValues(e){let{fields:t,arrs:i}=this.schema;if(this.cacheFieldsInValue(e,t),void 0!==i)for(let s of i){let{name:t,fields:i}=s,r=e[t];if(void 0===r)continue;let n=this.getDiv(t);for(let e of r)e._$tuid=n,e.$owner=this.boxId(e.owner),n.cacheValue(e),this.cacheFieldsInValue(e,i)}}cacheFieldsInValue(e,t){for(let i of t){let{name:t,_tuid:s}=i;if(void 0===s)continue;let r=e[t];e[t]=s.boxId(r)}}save(e,t){return s.a(this,void 0,void 0,function*(){let i=a.a.clone(t);return i.$id=e,yield this.tvApi.tuidSave(this.name,i)})}search(e,t,i){return s.a(this,void 0,void 0,function*(){return yield this.searchArr(void 0,e,t,i)})}searchArr(e,t,i,r){return s.a(this,void 0,void 0,function*(){let s,n,{fields:a}=this.schema;void 0!==this.owner?(s=this.owner.name,n=this.name):(s=this.name,n=void 0);let o=this.getApiFrom(),l=yield o.tuidSearch(s,n,e,t,i,r);for(let e of l)this.cacheFieldsInValue(e,a),void 0!==this.owner&&(e.$owner=this.owner.boxId(e.owner));return l})}loadArr(e,t,i){return s.a(this,void 0,void 0,function*(){if(void 0===i||0===i)return;let s=this.getApiFrom();return yield s.tuidArrGet(this.name,e,t,i)})}saveArr(e,t,i,r){return s.a(this,void 0,void 0,function*(){let s=a.a.clone(r);return s.$id=i,yield this.tvApi.tuidArrSave(this.name,e,t,s)})}posArr(e,t,i,r){return s.a(this,void 0,void 0,function*(){return yield this.tvApi.tuidArrPos(this.name,e,t,i,r)})}showInfo(e){return s.a(this,void 0,void 0,function*(){yield this.entities.cUq.showTuid(this,e)})}}class m extends u{get Main(){return this}get uqApi(){return this.entities.uqApi}setSchema(e){super.setSchema(e);let{arrs:t}=e;if(void 0!==t){this.divs={};for(let e of t){let{name:t}=e,i=new p(this.entities,t,this.typeId);i.owner=this,this.divs[t]=i,i.setSchema(e)}}}getDiv(e){return this.divs[e]}cacheDivIds(){return s.a(this,void 0,void 0,function*(){if(void 0!==this.divs)for(let e in this.divs)yield this.divs[e].cacheIds()})}cUqFrom(){if(void 0===this.schemaFrom)return this.entities.cUq;let{owner:e,uq:t}=this.schemaFrom,i=this.entities.cUq,s=i.cApp;if(void 0===s)return i;let r=s.getImportUq(e,t);return void 0===r?(console.error(`${e}/${t} \u4e0d\u5b58\u5728`),i):r}getApiFrom(){let e=this.from();return void 0!==e?e.entities.uqApi:this.entities.uqApi}from(){if(void 0===this.schemaFrom)return this;return this.cUqFrom().tuid(this.name)}cFrom(){return this.cUqFrom().cTuidMainFromName(this.name)}cEditFrom(){return this.cUqFrom().cTuidEditFromName(this.name)}cInfoFrom(){return this.cUqFrom().cTuidInfoFromName(this.name)}cSelectFrom(){let e=this.cUqFrom();if(void 0!==e)return e.cTuidSelectFromName(this.name)}}class p extends u{get Main(){return this.owner}getApiFrom(){return this.owner.getApiFrom()}}class v extends c{get typeName(){return"action"}submit(e){return s.a(this,void 0,void 0,function*(){yield this.loadSchema();let t=this.pack(e);return yield this.tvApi.action(this.name,{data:t})})}}var f=i(2);class g extends c{get typeName(){return"sheet"}setSchema(e){super.setSchema(e),this.states=e.states}build(e){this.states=[];for(let t of e.ops)this.states.push({name:t,actions:void 0})}createSheetState(e,t){let i={name:e,actions:[]},s=i.actions;for(let r in t){let e={name:r};s.push(e)}return i}save(e,t){return s.a(this,void 0,void 0,function*(){yield this.loadSchema();let{appId:i}=this.entities,s=this.pack(t);return yield this.tvApi.sheetSave(this.name,{app:i,discription:e,data:s})})}action(e,t,i,r){return s.a(this,void 0,void 0,function*(){return yield this.loadSchema(),yield this.tvApi.sheetAction(this.name,{id:e,flow:t,state:i,action:r})})}unpack(e){return s.a(this,void 0,void 0,function*(){let t=e[0][0];return{brief:t,data:this.unpackSheet(t.data),flows:e[1]}})}getSheet(e){return s.a(this,void 0,void 0,function*(){yield this.loadSchema();let t=yield this.tvApi.getSheet(this.name,e);return 0===t[0].length?yield this.getArchive(e):yield this.unpack(t)})}getArchive(e){return s.a(this,void 0,void 0,function*(){yield this.loadSchema();let t=yield this.tvApi.sheetArchive(this.name,e);return yield this.unpack(t)})}getArchives(e,t){return s.a(this,void 0,void 0,function*(){return yield this.loadSchema(),yield this.tvApi.sheetArchives(this.name,{pageStart:e,pageSize:t})})}getStateSheets(e,t,i){return s.a(this,void 0,void 0,function*(){return yield this.loadSchema(),yield this.tvApi.stateSheets(this.name,{state:e,pageStart:t,pageSize:i})})}createPageStateItems(){return new b(this)}stateSheetCount(){return s.a(this,void 0,void 0,function*(){yield this.loadSchema();let e=yield this.tvApi.stateSheetCount(this.name);return this.states.map(t=>{let i=t.name,s=0,r=e.find(e=>e.state===i);return void 0!==r&&(s=r.count),{state:i,count:s}})})}}class b extends f.PageItems{constructor(e){super(!0),this.sheet=e,this.pageSize=10}load(e,t,i){return s.a(this,void 0,void 0,function*(){return yield this.sheet.getStateSheets(e,t,i)})}setPageStart(e){this.pageStart=void 0===e?0:e.id}}class y extends c{get typeName(){return"query"}setSchema(e){super.setSchema(e);let{returns:t}=e;this.returns=t,this.isPaged=void 0!==t.find(e=>"$page"===e.name)}resetPage(e,t){this.pageStart=void 0,this.pageSize=e,this.params=t,this.more=!1,this.list=void 0}get hasMore(){return this.more}loadPage(){return s.a(this,void 0,void 0,function*(){if(void 0===this.pageSize)throw"call resetPage(size:number, params:any) first";let e;if(void 0!==this.pageStart)switch(this.startField.type){default:e=this.pageStart;break;case"date":case"time":case"datetime":e=this.pageStart.getTime()}let t=yield this.page(this.params,e,this.pageSize+1);if(this.list=r.l.array([],{deep:!1}),void 0!==t){if(t.length>this.pageSize){this.more=!0,t.pop();let e=this.returns.find(e=>"$page"===e.name);this.startField=e.fields[0],this.pageStart=t[t.length-1][this.startField.name]}else this.more=!1;this.list.push(...t)}})}page(e,t,i){return s.a(this,void 0,void 0,function*(){yield this.loadSchema();let s=yield this.tvApi.page(this.name,t,i+1,this.buildParams(e));return(yield this.unpackReturns(s)).$page})}query(e){return s.a(this,void 0,void 0,function*(){yield this.loadSchema();let t=yield this.tvApi.query(this.name,this.buildParams(e));return yield this.unpackReturns(t)})}table(e){return s.a(this,void 0,void 0,function*(){let t=yield this.query(e);for(let e in t)return t[e]})}obj(e){return s.a(this,void 0,void 0,function*(){let t=yield this.table(e);if(t.length>0)return t[0]})}scalar(e){return s.a(this,void 0,void 0,function*(){let t=yield this.obj(e);for(let e in t)return t[e]})}}s.b([r.l],y.prototype,"list",void 0);class w extends y{constructor(){super(...arguments),this.queryApiName="book"}get typeName(){return"book"}}class E extends y{constructor(){super(...arguments),this.queryApiName="history"}get typeName(){return"history"}}class C extends c{constructor(){super(...arguments),this.actions={},this.queries={}}get typeName(){return"map"}setSchema(e){super.setSchema(e),this.schemaFrom=this.schema.from;let{actions:t,queries:i,keys:s}=e;this.entities.buildFieldTuid(this.keys=s);for(let r in t){let e=t[r],{name:i}=e,s=this.entities.newAction(i,void 0);s.setSchema(e),this.actions[r]=s}for(let r in i){let e=i[r],{name:t}=e,s=this.entities.newQuery(t,void 0);s.setSchema(e),this.queries[r]=s}}add(e){return s.a(this,void 0,void 0,function*(){return yield this.loadSchema(),yield this.actions.add.submit(e)})}del(e){return s.a(this,void 0,void 0,function*(){return yield this.loadSchema(),yield this.actions.del.submit(e)})}all(){return s.a(this,void 0,void 0,function*(){return yield this.loadSchema(),yield this.queries.all.query({})})}page(e,t,i){return s.a(this,void 0,void 0,function*(){return yield this.loadSchema(),yield this.queries.page.page(e,t,i)})}query(e){return s.a(this,void 0,void 0,function*(){return yield this.loadSchema(),yield this.queries.query.query(e)})}table(e){return s.a(this,void 0,void 0,function*(){let t=yield this.query(e);for(let e in t)return t[e]})}obj(e){return s.a(this,void 0,void 0,function*(){let t=yield this.table(e);if(t.length>0)return t[0]})}scalar(e){return s.a(this,void 0,void 0,function*(){let t=yield this.obj(e);for(let e in t)return t[e]})}}class x extends y{constructor(){super(...arguments),this.queryApiName="pending"}get typeName(){return"pending"}}function k(e){switch(e){case"tinyint":case"smallint":case"int":case"bigint":case"dec":return 0;case"char":case"text":return"";case"datetime":case"date":return"2000-1-1";case"time":return"0:00"}}class N{constructor(e,t,i){this.tuids={},this.actions={},this.sheets={},this.queries={},this.books={},this.maps={},this.histories={},this.pendings={},this.tuidArr=[],this.actionArr=[],this.sheetArr=[],this.queryArr=[],this.bookArr=[],this.mapArr=[],this.historyArr=[],this.pendingArr=[],this.loadIds=(()=>{this.clearCacheTimer();for(let e in this.tuids){this.tuids[e].cacheIds()}}),this.cUq=e,this.uqApi=t,this.appId=i}tuid(e){return this.tuids[e.toLowerCase()]}action(e){return this.actions[e.toLowerCase()]}sheet(e){return this.sheets[e.toLowerCase()]}query(e){return this.queries[e.toLowerCase()]}book(e){return this.books[e.toLowerCase()]}map(e){return this.maps[e.toLowerCase()]}history(e){return this.histories[e.toLowerCase()]}pending(e){return this.pendings[e.toLowerCase()]}sheetFromTypeId(e){for(let t in this.sheets){let i=this.sheets[t];if(i.typeId===e)return i}}loadAccess(){return s.a(this,void 0,void 0,function*(){let e=yield this.uqApi.loadAccess();void 0!==e&&this.buildEntities(e)})}loadEntities(){return s.a(this,void 0,void 0,function*(){let e=yield this.uqApi.loadEntities();this.buildEntities(e)})}buildEntities(e){let{access:t,tuids:i}=e;this.buildTuids(i),this.buildAccess(t)}getTuid(e,t,i){let s=this.tuids[e];if(void 0!==s)return void 0===t?s:s.divs[t]}cacheTuids(e){this.clearCacheTimer(),this.cacheTimer=setTimeout(this.loadIds,e)}clearCacheTimer(){void 0!==this.cacheTimer&&(clearTimeout(this.cacheTimer),this.cacheTimer=void 0)}buildTuids(e){for(let t in e){let i=e[t],{name:s,typeId:r}=i;this.newTuid(t,r).sys=!0}for(let t in e){let i=e[t],{name:s}=i;this.getTuid(t).setSchema(i)}for(let t in this.tuids){this.tuids[t].buildFieldsTuid()}}buildAccess(e){for(let t in e){let i=e[t];switch(typeof i){case"string":this.fromType(t,i);break;case"object":this.fromObj(t,i)}}}newAction(e,t){let i=this.actions[e];return void 0!==i?i:(i=this.actions[e]=new v(this,e,t),this.actionArr.push(i),i)}newTuid(e,t){let i=this.tuids[e];return void 0!==i?i:(i=this.tuids[e]=new m(this,e,t),this.tuidArr.push(i),i)}newQuery(e,t){let i=this.queries[e];return void 0!==i?i:(i=this.queries[e]=new y(this,e,t),this.queryArr.push(i),i)}newBook(e,t){let i=this.books[e];return void 0!==i?i:(i=this.books[e]=new w(this,e,t),this.bookArr.push(i),i)}newMap(e,t){let i=this.maps[e];return void 0!==i?i:(i=this.maps[e]=new C(this,e,t),this.mapArr.push(i),i)}newHistory(e,t){let i=this.histories[e];if(void 0===i)return i=this.histories[e]=new E(this,e,t),this.historyArr.push(i),i}newPending(e,t){let i=this.pendings[e];if(void 0===i)return i=this.pendings[e]=new x(this,e,t),this.pendingArr.push(i),i}newSheet(e,t){let i=this.sheets[e];return void 0!==i?i:(i=this.sheets[e]=new g(this,e,t),this.sheetArr.push(i),i)}fromType(e,t){let i=t.split("|");t=i[0];let s=Number(i[1]);switch(t){case"uq":this.uqId=s;break;case"tuid":this.newTuid(e,s).sys=!1;break;case"action":this.newAction(e,s);break;case"query":this.newQuery(e,s);break;case"book":this.newBook(e,s);break;case"map":this.newMap(e,s);break;case"history":this.newHistory(e,s);break;case"sheet":this.newSheet(e,s);break;case"pending":this.newPending(e,s)}}fromObj(e,t){switch(t.$){case"sheet":this.buildSheet(e,t)}}buildSheet(e,t){let i=this.sheets[e];void 0===i&&(i=this.newSheet(e,t.id)),i.build(t)}buildFieldTuid(e,t){if(void 0!==e){for(let t of e){let{tuid:e,arr:i,url:s}=t;void 0!==e&&(t._tuid=this.getTuid(e,i,s))}for(let i of e){let{owner:s}=i;if(void 0===s)continue;let r=e.find(e=>e.name===s);if(void 0===r&&(void 0!==t&&(r=t.find(e=>e.name===s)),void 0===r))throw`owner field ${s} is undefined`;i._ownerField=r;let{arr:n,url:a}=i;if(i._tuid=this.getTuid(r._tuid.name,n,a),void 0===i._tuid)throw"owner field ${owner} is not tuid"}}}buildArrFieldsTuid(e,t){if(void 0!==e)for(let i of e){let{fields:e}=i;void 0!==e&&this.buildFieldTuid(e,t)}}}i.d(t,"b",function(){return k}),i.d(t,"a",function(){return N})},function(e,t,i){"use strict";i.d(t,"a",function(){return l}),i.d(t,"b",function(){return c});var s=i(0),r=i(35);class n{constructor(e,t){if(this.form=e,this.row=t,void 0===t.type){let i=t.createControl;void 0===i&&(i=e.createControl),void 0===i&&(i=r.b),this.control=i(e,t)}}isOk(){return void 0===this.control||this.control.isOk()}contains(e){let t=this.row.field;if(void 0!==t)return e===t.name;let i=this.row.group;return void 0!==i&&void 0!==i.find(t=>t.field.name===e)}get hasError(){return this.control.hasError}get filled(){return this.control.filled}clear(){void 0!==this.control&&this.control.clear()}clearErrors(){void 0!==this.control&&this.control.clearErrors()}readValues(e){void 0!==this.control&&this.control.readValues(e)}setError(e,t){void 0!==this.control&&this.control.setError(e,t)}setInitValues(e){void 0!==this.control&&this.control.setInitValues(e)}}class a extends n{render(e){return s.createElement("div",{key:e,className:"form-group"},this.row)}get hasError(){return!1}get filled(){return!1}}class o extends n{render(e){return s.createElement("div",{key:e,className:"form-group row"},s.createElement("label",{className:"col-sm-2 col-form-label"},this.row.label),this.control.render())}}function l(e,t){return new o(e,t)}function c(e,t){return new a(e,t)}},,function(e,t,i){"use strict";i.d(t,"b",function(){return r}),i.d(t,"a",function(){return n});var s=i(1);function r(e,t,i,r,n){return s.a(this,void 0,void 0,function*(){yield e.fetch(t,i,r,n)})}class n{constructor(e,t){this.path=e||"",this.showWaiting=t}call(e,t,i){return s.a(this,void 0,void 0,function*(){let s=yield this.getHttpChannel();return yield s.callFetch(e,t,i)})}get(e,t){return s.a(this,void 0,void 0,function*(){let i=yield this.getHttpChannel();return yield i.get(this.path+e,t)})}post(e,t){return s.a(this,void 0,void 0,function*(){let i=yield this.getHttpChannel();return yield i.post(this.path+e,t)})}put(e,t){return s.a(this,void 0,void 0,function*(){let i=yield this.getHttpChannel();return yield i.put(this.path+e,t)})}delete(e,t){return s.a(this,void 0,void 0,function*(){let i=yield this.getHttpChannel();return yield i.delete(this.path+e,t)})}}},function(e,t,i){"use strict";i.d(t,"a",function(){return a});var s=i(1),r=i(0),n=i(11);class a extends r.Component{constructor(e){super(e),this.logoutClick=(()=>{n.c.showLogout(this.logout)}),this.logout=(()=>s.a(this,void 0,void 0,function*(){let{logout:e}=this.props;"function"===typeof e&&(yield e()),yield n.c.logout(void 0)})),this.navChange=this.navChange.bind(this),this.state={hasBack:!1}}navChange(){this.setState({hasBack:n.c.level>1})}componentWillMount(){this.navChange()}componentWillUnmount(){}back(){return s.a(this,void 0,void 0,function*(){yield n.c.back()})}openWindow(){window.open(document.location.href)}render(){let e,t,i,s,a=this.state.hasBack||self!=top,{right:o,center:l,logout:c}=this.props;if(void 0!==c&&self===top&&("boolean"===typeof c&&!0===c||"function"===typeof c)){let{user:e}=n.c;if(void 0!==e){let{nick:t,name:s}=e;i=r.createElement("div",{className:"d-flex align-items-center"},r.createElement("small",{className:"text-light"},t||s),r.createElement("a",{className:"dropdown-toggle btn btn-secondary btn-sm ml-2",role:"button",onClick:this.logoutClick},r.createElement("i",{className:"fa fa-sign-out"})))}}if(a)switch(this.props.back){case"none":e=void 0;break;default:case"back":e=r.createElement("nav",{onClick:this.back},r.createElement("i",{className:"fa fa-arrow-left"}));break;case"close":e=r.createElement("nav",{onClick:this.back},r.createElement("i",{className:"fa fa-close"}))}return self!=top&&(console.log(document.location.href),t=r.createElement("header",{onClick:this.openWindow})),(o||i)&&(s=r.createElement("aside",null,o," ",i)),r.createElement("header",{style:n.b},t,e,r.createElement("div",null,l),s)}}},function(e,t,i){"use strict";var s=i(1),r=i(8),n=i(0),a=i.n(n),o=i(6),l=i(3),c=i(2),d=i(15);const h=e=>a.a.createElement("div",{className:"px-3 py-2"},Object(d.a)(e));class u extends r.b{constructor(){super(...arguments),this.onSubmit=(()=>s.a(this,void 0,void 0,function*(){let e=this.vForm.getValues();if(!0===this.entity.isPaged)yield this.entity.resetPage(30,e),yield this.entity.loadPage(),this.replacePage(this.pageResult);else{let t=yield this.entity.query(e);this.replacePage(this.queryResult,t)}})),this.again=(()=>{this.vForm.reset(),this.replacePage(this.view)}),this.renderRow=((e,t)=>n.createElement(this.row,Object.assign({},e))),this.view=(()=>n.createElement(c.Page,{header:this.label},this.vForm.render("mx-3 my-2"),this.renderExtra())),this.pageResult=(()=>{let{name:e,list:t}=this.entity,i=n.createElement("button",{className:"btn btn-outline-success",onClick:this.again},n.createElement(l.FA,{name:"search"})," \u518d\u67e5\u8be2");return n.createElement(c.Page,{header:this.label,right:i},n.createElement(l.List,{items:t,item:{render:this.renderRow}}))}),this.queryResult=Object(o.a)(e=>{let t=n.createElement("button",{className:"btn btn-outline-success",onClick:this.again},n.createElement(l.FA,{name:"search"})," \u518d\u67e5\u8be2");return n.createElement(c.Page,{header:this.label,right:t},n.createElement("pre",null,JSON.stringify(e,void 0,"\t")))})}open(e){return s.a(this,void 0,void 0,function*(){this.vForm=this.createForm(this.onSubmit,e);let{row:t,queryRow:i}=this.ui;this.row=i||t||h,this.openPage(this.view)})}renderExtra(){}}class m extends r.b{constructor(){super(...arguments),this.onSearch=(e=>s.a(this,void 0,void 0,function*(){yield this.PageItems.first(e)})),this.renderRow=((e,t)=>n.createElement(this.row,Object.assign({},e))),this.clickRow=(e=>{this.callOnSelected(e)}),this.view=(()=>{let e=n.createElement(l.SearchBox,{className:"mx-1 w-100",initKey:"",onSearch:this.onSearch,placeholder:"\u641c\u7d22"+this.label});return n.createElement(c.Page,{header:e},n.createElement(l.List,{items:this.PageItems.items,item:{render:this.renderRow,onClick:this.clickRow},before:"\u641c\u7d22"+this.label+"\u8d44\u6599"}))})}open(e){return s.a(this,void 0,void 0,function*(){let{row:t,selectRow:i}=this.ui;this.row=i||t||h,this.PageItems=new p(this.entity),yield this.onSearch(e),this.openPage(this.view)})}callOnSelected(e){this.closePage(),this.returnCall(e)}}class p extends c.PageItems{constructor(e){super(),this.query=e}load(){return s.a(this,void 0,void 0,function*(){let e;if(yield this.query.loadSchema(),!0===this.query.isPaged)e=yield this.query.page(this.param,this.pageStart,this.pageSize);else{e=(yield this.query.query(this.param))[this.query.returns[0].name]}return e})}setPageStart(e){void 0===e&&(this.pageStart=0)}}class v extends r.a{}class f extends v{internalStart(){return s.a(this,void 0,void 0,function*(){yield this.openVPage(this.VQueryMain)})}get VQueryMain(){return this.ui&&this.ui.main||u}}class g extends v{internalStart(e){return s.a(this,void 0,void 0,function*(){yield this.openVPage(this.VQuerySelect,e)})}get VQuerySelect(){return m}}i.d(t,"a",function(){return f}),i.d(t,"b",function(){return g})},function(e,t,i){"use strict";i.d(t,"a",function(){return u});var s=i(1),r=i(0),n=i(6),a=i(4),o=i(44),l=i(25),c=i(11),d=i(22),h=i(57);class u extends h.a{constructor(){super(...arguments),this.overSize=!1,this.upload=(()=>s.a(this,void 0,void 0,function*(){if(!this.resUploader)return;let e=yield this.resUploader.upload();if(null===e)return this.overSize=!0,void setTimeout(()=>this.overSize=!1,3e3);this.resId=e,this.isChanged=this.resId!=this.value})),this.page=Object(n.a)(e=>{let t,{resolve:i}=e,s=r.createElement("button",{className:"btn btn-sm btn-success",disabled:!this.isChanged,onClick:()=>i(this.resId)},"\u4fdd\u5b58");return!0===this.overSize&&(t=r.createElement("div",{className:"text-danger"},r.createElement("i",{className:"fa fa-times-circle"})," \u56fe\u7247\u6587\u4ef6\u5927\u5c0f\u8d85\u8fc72M\uff0c\u65e0\u6cd5\u4e0a\u4f20")),r.createElement(d.a,{header:"\u66f4\u6539"+this.label,right:s},r.createElement("div",{className:"my-3 px-3 py-3 bg-white"},r.createElement("div",null,r.createElement("div",null,"\u4e0a\u4f20\u56fe\u7247\uff1a"),r.createElement("div",{className:"my-3"},r.createElement(o.a,{ref:e=>this.resUploader=e,multiple:!1,maxSize:2048})),r.createElement("div",null,r.createElement("button",{className:"btn btn-primary",onClick:this.upload},"\u4e0a\u4f20"))),t,r.createElement("div",{className:"small muted my-4"},"\u652f\u6301JPG\u3001GIF\u3001PNG\u683c\u5f0f\u56fe\u7247\uff0c\u4e0d\u8d85\u8fc72M\u3002"),r.createElement("div",{className:"d-flex"},r.createElement("div",{className:"w-12c h-12c mr-4",style:{border:"1px dotted gray",padding:"8px"}},r.createElement(l.a,{className:"w-100 h-100",src:this.resId})),r.createElement("div",null,r.createElement("div",{className:"small"},"\u56fe\u7247\u9884\u89c8"),r.createElement(l.a,{className:"w-4c h-4c mt-3",src:this.resId})))))})}internalStart(){return s.a(this,void 0,void 0,function*(){return this.resId=this.value,new Promise((e,t)=>{c.c.push(r.createElement(this.page,{resolve:e,reject:t}),()=>t())})})}}s.b([a.l],u.prototype,"resId",void 0),s.b([a.l],u.prototype,"overSize",void 0)},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var s=i(0);function r(){return s.createElement("div",{className:"d-flex h-100 align-items-center justify-content-center"},s.createElement("i",{className:"fa fa-spinner fa-spin fa-2x fa-fw text-info"}))}},function(e,t,i){"use strict";i.d(t,"a",function(){return a});var s=i(1),r=i(0),n=i(11);class a extends r.Component{constructor(){super(...arguments),this.upload=(()=>s.a(this,void 0,void 0,function*(){let{maxSize:e}=this.props;void 0===e||e<=0?e=1e11:e*=1024;let t=n.c.resUrl+"upload";var i=this.fileInput.files,s=new FormData;let r=i.length;for(let n=0;n<r;n++){let t=i[n];if(t.size>e)return null;s.append("files[]",t,t.name)}try{let e=new AbortController,i=yield fetch(t,{method:"POST",body:s,signal:e.signal});return":"+(yield i.json()).res.id}catch(a){console.error("%s %s",t,a)}}))}render(){let{className:e,multiple:t,onFilesChange:i}=this.props;return r.createElement("input",{className:e,ref:e=>this.fileInput=e,onChange:i,type:"file",name:"file",multiple:t})}}},function(e,t,i){"use strict";i.d(t,"a",function(){return h});var s=i(1),r=i(0),n=i(9),a=i.n(n),o=i(2),l=i(3),c=i(52),d=i(50);class h extends o.Controller{constructor(e){super(Object(o.resLang)(e&&e.res)),this.cImportUqs={},this.cUqCollection={},this.renderRow=((e,t)=>{let{id:i,nick:s,name:n}=e;return r.createElement(l.LMR,{className:"px-3 py-2",right:"id: "+i},r.createElement("div",null,s||n))}),this.onRowClick=(e=>s.a(this,void 0,void 0,function*(){o.appInFrame.unit=e.id,yield this.start()})),this.selectUnitPage=(()=>r.createElement(o.Page,{header:"\u9009\u62e9\u5c0f\u53f7",logout:!0},r.createElement(l.List,{items:this.appUnits,item:{render:this.renderRow,onClick:this.onRowClick}}))),o.nav.setSettings(e);let t=e.appName;if(void 0===t)throw'appName like "owner/app" must be defined in UI';let i=t.split("/");if(2!==i.length)throw"tonvaApp name must be / separated, owner/app";this.appOwner=i[0],this.appName=i[1],void 0===e.uqs&&(e.uqs={}),this.ui=e,this.caption=this.res.caption||"Tonva"}startDebug(){return s.a(this,void 0,void 0,function*(){let e=this.appOwner+"/"+this.appName,t=new h({appName:e,uqs:{}});yield t.start(!0)})}loadUqs(e){return s.a(this,void 0,void 0,function*(){let t=[],{id:i,uqs:s}=(o.appInFrame.unit,e);this.id=i;let r=[],n=[],a=yield this.buildRoleAppUI();this.ui=a;for(let e of s){let{id:t,uqOwner:i,uqName:s,access:o}=e,l=i+"/"+s,c=a&&a.uqs&&a.uqs[l],d=this.newCUq(l,t,o,c||{});this.cUqCollection[l]=d,r.push(d.loadSchema()),n.push(d.entities.uqApi.checkAccess())}let l=yield Promise.all(r);Promise.all(n).then(e=>{for(let t of e);});for(let e of l){let i=e;void 0===i||t.push(i)}if(0!==t.length)return t})}buildRoleAppUI(){return s.a(this,void 0,void 0,function*(){if(!this.ui)return;let{hashParam:e}=o.nav;if(!e)return this.ui;let{roles:t}=this.ui,i=t&&t[e];if(!i)return this.ui;let s={};for(let r in this.ui)"roles"!==r&&(s[r]=this.ui[r]);return"function"===typeof i&&(i=yield i()),a.a.merge(s,i),s})}getImportUq(e,t){let i=e+"/"+t,s=this.cImportUqs[i];if(void 0!==s)return s;this.ui&&this.ui.uqs&&this.ui.uqs[i];return this.cImportUqs[i]=s=this.getCUq(i),s}newCUq(e,t,i,s){let r=new(this.ui.CUq||c.a)(this,e,this.id,t,i,s);return Object.setPrototypeOf(r.x,this.x),r}get cUqArr(){let e=[];for(let t in this.cUqCollection)e.push(this.cUqCollection[t]);return e}getCUq(e){return this.cUqCollection[e]}get VAppMain(){return this.ui&&this.ui.main||u}beforeStart(){return s.a(this,void 0,void 0,function*(){try{let t=yield Object(o.loadAppUqs)(this.appOwner,this.appName),{predefinedUnit:i}=o.appInFrame,{id:s}=t;this.id=s;let{user:n}=o.nav;if(void 0!==n&&n.id>0)switch(this.appUnits=yield d.a.userAppUnits(this.id),this.appUnits.length){case 0:return this.showUnsupport(i),!1;case 1:let e=this.appUnits[0].id;if(void 0===e||e<0||void 0!==i&&e!=i)return this.showUnsupport(i),!1;o.appInFrame.unit=e;break;default:if(i>0&&void 0!==this.appUnits.find(e=>e.id===i)){o.appInFrame.unit=i;break}return o.nav.push(r.createElement(this.selectUnitPage,null)),!1}let a=yield this.loadUqs(t);return void 0===a||(this.openPage(r.createElement(o.Page,{header:"ERROR"},r.createElement("div",{className:"m-3"},r.createElement("div",null,"Load Uqs \u53d1\u751f\u9519\u8bef\uff1a"),a.map((e,t)=>r.createElement("div",{key:t},e))))),!1)}catch(e){return o.nav.push(r.createElement(o.Page,{header:"App start error!"},r.createElement("pre",null,"string"===typeof e?e:e.message))),!1}})}internalStart(e){return s.a(this,void 0,void 0,function*(){!0!==e&&this.clearPrevPages(),yield this.showMainPage()})}render(){return this.renderView(this.VAppMain)}clearPrevPages(){o.nav.clear()}showUnsupport(e){this.clearPrevPages();let{user:t}=o.nav,i=t?t.name:"[\u672a\u767b\u5f55]";this.openPage(r.createElement(o.Page,{header:"APP\u65e0\u6cd5\u8fd0\u884c",logout:!0},r.createElement("div",{className:"m-3 text-danger container"},r.createElement("div",{className:"form-group row"},r.createElement("div",{className:"col-2"},"\u767b\u5f55\u7528\u6237: "),r.createElement("div",{className:"col"},i)),r.createElement("div",{className:"form-group row"},r.createElement("div",{className:"col-2"},"App:"),r.createElement("div",{className:"col"},`${this.appOwner}/${this.appName}`)),r.createElement("div",{className:"form-group row"},r.createElement("div",{className:"col-2"},"\u9884\u8bbe\u5c0f\u53f7:"),r.createElement("div",{className:"col"},e||r.createElement("small",{className:"text-muted"},"[\u65e0\u9884\u8bbe\u5c0f\u53f7]"))),r.createElement("div",{className:"form-group row"},r.createElement("div",{className:"col-2"},r.createElement(l.FA,{name:"exclamation-triangle"})),r.createElement("div",{className:"col"},r.createElement("div",{className:"text-muted"},"\u65e0\u6cd5\u8fd0\u884c\u53ef\u80fd\u539f\u56e0\uff1a"),r.createElement("ul",{className:"p-0"},r.createElement("li",null,"\u6ca1\u6709\u5c0f\u53f7\u8fd0\u884c ",this.ui.appName),r.createElement("li",null,"\u7528\u6237 ",r.createElement("b",null,i)," \u6ca1\u6709\u52a0\u5165\u4efb\u4f55\u4e00\u4e2a\u8fd0\u884c",this.ui.appName,"\u7684\u5c0f\u53f7"),e&&r.createElement("li",null,"\u9884\u8bbe\u5c0f\u53f7 ",r.createElement("b",null,e)," \u6ca1\u6709\u8fd0\u884cApp ",this.ui.appName)))),e||r.createElement("div",{className:"form-group row"},r.createElement("div",{className:"col-2"}),r.createElement("div",{className:"col"},"\u9884\u8bbe\u5c0f\u53f7\u5b9a\u4e49\u5728 public/unit.json \u6587\u4ef6\u4e2d\u3002 \u5b9a\u4e49\u4e86\u8fd9\u4e2a\u6587\u4ef6\u7684\u7a0b\u5e8f\uff0c\u53ea\u80fd\u7531url\u76f4\u63a5\u542f\u52a8\u3002 \u7528\u6237\u7b2c\u4e00\u6b21\u8bbf\u95eeapp\u4e4b\u540e\uff0c\u4f1a\u7f13\u5b58\u5728localStorage\u91cc\u3002",r.createElement("br",null),"\u5982\u679c\u8981\u5220\u53bb\u7f13\u5b58\u7684\u9884\u5b9a\u4e49Unit\uff0clogout\u7136\u540e\u518dlogin\u3002")))))}showMainPage(){return s.a(this,void 0,void 0,function*(){let e=Object(o.getExHash)();if(void 0!==e){let t=e.split("-");if(t.length>3){let e=t[3];if("sheet"===e||"sheet_debug"===e){let e=Number(t[4]),i=Number(t[5]),s=Number(t[6]),r=this.getCUqFromId(e);return void 0===r?void alert("unknown uqId: "+e):(this.clearPrevPages(),void(yield r.navSheet(i,s)))}}}this.openVPage(this.VAppMain)})}getCUqFromId(e){for(let t in this.cUqCollection){let i=this.cUqCollection[t];if(i.id===e)return i}}}class u extends o.VPage{constructor(){super(...arguments),this.appContent=(()=>{let e,{cUqArr:t}=this.controller;return e=0===t.length?r.createElement("div",{className:"text-danger"},r.createElement(l.FA,{name:""})," \u6b64APP\u6ca1\u6709\u7ed1\u5b9a\u4efb\u4f55\u7684UQ"):t.map((e,t)=>r.createElement("div",{key:t},e.render())),r.createElement(r.Fragment,null,e)})}open(e){return s.a(this,void 0,void 0,function*(){this.openPage(this.appPage)})}render(e){return this.appContent()}appPage(){let{caption:e}=this.controller;return r.createElement(o.Page,{header:e,logout:()=>s.a(this,void 0,void 0,function*(){o.appInFrame.unit=void 0})},this.appContent())}}},function(e,t,i){"use strict";var s=i(72);i.o(s,"EasyDate")&&i.d(t,"EasyDate",function(){return s.EasyDate}),i.o(s,"FA")&&i.d(t,"FA",function(){return s.FA}),i.o(s,"IconText")&&i.d(t,"IconText",function(){return s.IconText}),i.o(s,"LMR")&&i.d(t,"LMR",function(){return s.LMR}),i.o(s,"List")&&i.d(t,"List",function(){return s.List}),i.o(s,"Media")&&i.d(t,"Media",function(){return s.Media}),i.o(s,"Muted")&&i.d(t,"Muted",function(){return s.Muted}),i.o(s,"PropGrid")&&i.d(t,"PropGrid",function(){return s.PropGrid}),i.o(s,"SearchBox")&&i.d(t,"SearchBox",function(){return s.SearchBox}),i.o(s,"TonvaForm")&&i.d(t,"TonvaForm",function(){return s.TonvaForm});var r=i(73);i.o(r,"EasyDate")&&i.d(t,"EasyDate",function(){return r.EasyDate}),i.o(r,"FA")&&i.d(t,"FA",function(){return r.FA}),i.o(r,"IconText")&&i.d(t,"IconText",function(){return r.IconText}),i.o(r,"LMR")&&i.d(t,"LMR",function(){return r.LMR}),i.o(r,"List")&&i.d(t,"List",function(){return r.List}),i.o(r,"Media")&&i.d(t,"Media",function(){return r.Media}),i.o(r,"Muted")&&i.d(t,"Muted",function(){return r.Muted}),i.o(r,"PropGrid")&&i.d(t,"PropGrid",function(){return r.PropGrid}),i.o(r,"SearchBox")&&i.d(t,"SearchBox",function(){return r.SearchBox}),i.o(r,"TonvaForm")&&i.d(t,"TonvaForm",function(){return r.TonvaForm});var n=i(74);i.o(n,"EasyDate")&&i.d(t,"EasyDate",function(){return n.EasyDate}),i.o(n,"FA")&&i.d(t,"FA",function(){return n.FA}),i.o(n,"IconText")&&i.d(t,"IconText",function(){return n.IconText}),i.o(n,"LMR")&&i.d(t,"LMR",function(){return n.LMR}),i.o(n,"List")&&i.d(t,"List",function(){return n.List}),i.o(n,"Media")&&i.d(t,"Media",function(){return n.Media}),i.o(n,"Muted")&&i.d(t,"Muted",function(){return n.Muted}),i.o(n,"PropGrid")&&i.d(t,"PropGrid",function(){return n.PropGrid}),i.o(n,"SearchBox")&&i.d(t,"SearchBox",function(){return n.SearchBox}),i.o(n,"TonvaForm")&&i.d(t,"TonvaForm",function(){return n.TonvaForm});i(37),i(47);var a=i(75);i.d(t,"TonvaForm",function(){return a.a});i(35)},function(e,t,i){"use strict";i.d(t,"a",function(){return c});var s=i(1),r=i(0),n=i(4),a=i(23),o=i(35),l=i(37);class c{constructor(e){this.rows=[],this.uid=Object(a.a)(),this.props=e,this.buildRows(e),this.createControl=e.createControl,this.onSubmit=this.onSubmit.bind(this)}get hasError(){let e=this.rows.map((e,t)=>t+": "+e.hasError+"\n");return console.log(e),this.rows.some(e=>e.hasError)}get nothing(){return this.rows.every(e=>!e.filled)}readValues(){let e={};for(let t of this.rows)t.readValues(e);return e}clear(){for(let e of this.rows)e.clear()}clearErrors(){for(let e of this.rows)e.clearErrors()}setError(e,t){for(let i of this.rows)i.setError(e,t)}setInitValues(e){if(void 0!==e)for(let t of this.rows)t.setInitValues(e)}buildRows(e){let{formRows:t,createRow:i}=e;if(void 0!==t){for(let e of t)this.rows.push(this.buildRow(e,i));!0!==this.props.readOnly&&(this.buttonsRow=this.buildRow({createControl:this.createButtons.bind(this)},void 0))}else this.rows.push(Object(l.b)(this,r.createElement("div",{className:"text-warning"},"TonvaForm need formRows defined")))}buildRow(e,t){let i;return void 0!==e.type?i=l.b:void 0===(i=e.createRow)&&void 0===(i=t)&&(i=l.a),i(this,e)}createButtons(e,t){return new o.a(e)}isOk(){let e=!0;for(let t of this.rows)t.isOk()||(e=!1);return e}render(){return r.createElement("form",{onSubmit:this.onSubmit},this.rows.map((e,t)=>e.render(this.uid+t)),this.buttons())}buttons(){if(void 0!==this.buttonsRow)return this.buttonsRow.render(this.uid+this.rows.length)}onSubmit(e){return s.a(this,void 0,void 0,function*(){if(e.preventDefault(),!this.isOk())return;let t=this.readValues();yield this.props.onSubmit(t)})}}s.b([n.e],c.prototype,"hasError",null),s.b([n.e],c.prototype,"nothing",null)},function(e,t,i){"use strict";i.d(t,"a",function(){return o});var s=i(0),r=i.n(s),n=i(3);function a(e,t){return r.a.createElement(n.FA,{className:e,name:t,fixWidth:!0})}const o={tuid:a("text-info","list-alt"),action:a("text-info","hand-o-right"),map:a("text-muted","list-ul"),book:a("text-muted","book"),query:a("text-warning","search"),history:a("text-info","hand-o-right"),pending:a("text-info","forward"),sheet:a("text-primary","wpforms")}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var s=i(2);class r extends s.Controller{constructor(e,t){super(t),this.cUq=e}}},function(e,t,i){"use strict";i.d(t,"a",function(){return n});var s=i(1),r=i(2);const n=new class extends r.CenterApi{userAppUnits(e){return s.a(this,void 0,void 0,function*(){return yield this.get("tie/user-app-units",{app:e})})}}("tv/",void 0)},function(e,t,i){"use strict";var s=i(1),r=i(4),n=i(2),a=i(8),o=i(0),l=i.n(o),c=i(6),d=i(3);class h extends a.b{constructor(){super(...arguments),this.newClick=(()=>this.event("new")),this.schemaClick=(()=>this.event("schema")),this.archivesClick=(()=>this.event("archives")),this.sheetStateClick=(e=>this.event("state",e)),this.renderState=((e,t)=>{let{state:i,count:s}=e;if(0===s)return null;let r=o.createElement("span",{className:"badge badge-success ml-5 align-self-end"},s);return o.createElement(d.LMR,{className:"px-3 py-2",left:this.controller.getStateLabel(i),right:r})}),this.view=Object(c.a)(()=>{let e,t=this.controller.statesCount.filter(e=>e.count),i=o.createElement("button",{className:"btn btn-outline-primary",onClick:this.archivesClick},"\u5df2\u5f52\u6863");return!0===this.isDev&&(e=o.createElement("button",{className:"btn btn-primary mr-2",color:"primary",onClick:this.schemaClick},"\u6a21\u677f")),o.createElement(n.Page,{header:this.label},o.createElement(d.LMR,{className:"mx-3 my-2",right:i},o.createElement("button",{className:"btn btn-primary mr-2",color:"primary",onClick:this.newClick},"\u65b0\u5efa"),e),o.createElement(d.List,{className:"my-2",header:o.createElement(d.Muted,{className:"mx-3 my-1"},"\u5f85\u5904\u7406",this.label),none:"[ \u65e0 ]",items:t,item:{render:this.renderState,onClick:this.sheetStateClick}}))})}open(){return s.a(this,void 0,void 0,function*(){this.openPage(this.view)})}}class u extends a.b{constructor(){super(...arguments),this.onSubmit=(()=>s.a(this,void 0,void 0,function*(){let e=this.vForm.getValues(),t=this.vForm.values;yield this.controller.onSave(e,t)})),this.view=(()=>o.createElement(n.Page,{header:this.label},this.vForm.render()))}open(e){return s.a(this,void 0,void 0,function*(){this.vForm=this.createForm(this.onSubmit,e),this.openPage(this.view)})}}var m=i(30);const p={width:"8rem"};class v extends a.b{constructor(){super(...arguments),this.flowRow=((e,t)=>{let i,{date:s,user:r,preState:n,state:a,action:l}=e;switch(void 0===l&&(l=o.createElement(o.Fragment,null,o.createElement(d.FA,{className:"text-primary",name:"pencil-square-o"})," \u5236\u5355")),a){case"$":break;case"#":i=o.createElement(o.Fragment,null,o.createElement(d.FA,{className:"text-success",name:"file-archive-o"}));break;default:i=o.createElement(o.Fragment,null,o.createElement(d.FA,{className:"text-muted",name:"arrow-right"})," \xa0 ",a)}return o.createElement(d.LMR,{left:o.createElement("div",{className:"pl-3 py-2",style:p},l),right:o.createElement("div",{className:"p-2"},o.createElement(d.Muted,null,o.createElement(d.EasyDate,{date:s})))},o.createElement("div",{className:"p-2"},i))}),this.sheetView=(()=>{let e,{brief:t,flows:i}=this.sheetData;return"-"===t.state&&(e=o.createElement("div",{className:"mx-3 my-2",style:{color:"red"}},"\u672c\u5355\u636e\u4f5c\u5e9f")),o.createElement("div",null,e,this.vForm.render(),o.createElement(d.List,{header:o.createElement(d.Muted,{className:"mx-3 my-1"},"\u6d41\u7a0b"),items:i,item:{render:this.flowRow}}))})}}class f extends v{constructor(){super(...arguments),this.onSubmit=(()=>s.a(this,void 0,void 0,function*(){let e=this.vForm.getValues();yield this.controller.saveSheet(e,this.vForm.values),this.closePage(),this.returnCall(this.vForm.values)})),this.view=(()=>o.createElement(n.Page,{header:this.label},this.vForm.render()))}open(e){return s.a(this,void 0,void 0,function*(){this.sheetData=e,this.vForm=this.createForm(this.onSubmit,e.data,m.a.edit),this.openPage(this.view)})}}var g=i(5),b=i.n(g);class y extends v{constructor(){super(...arguments),this.actionClick=(e=>s.a(this,void 0,void 0,function*(){let{id:t,flow:i,state:s}=this.sheetData.brief;yield this.controller.action(t,i,s,e.name);this.ceasePage(),this.openPage(this.acted)})),this.deleteClick=(()=>s.a(this,void 0,void 0,function*(){alert("\u5355\u636e\u4f5c\u5e9f\uff1a\u7a0b\u5e8f\u6b63\u5728\u8bbe\u8ba1\u4e2d")})),this.editClick=(()=>s.a(this,void 0,void 0,function*(){let e=yield this.controller.editSheet(this.sheetData);this.vForm.setValues(e)})),this.page=(()=>{let e,t,{brief:i}=this.sheetData,{state:s,no:r}=i,a=this.controller.getStateLabel(s),{states:o}=this.entity,c=o.find(e=>e.name===s);if(void 0===c){let t,i;switch(s){default:t="\u4e0d\u8ba4\u8bc6\u7684\u5355\u636e\u72b6\u6001'"+s+"'",i="text-info";break;case"-":t="\u5df2\u4f5c\u5e9f",i="text-danger";break;case"#":t="\u5df2\u5f52\u6863",i="text-success"}e=l.a.createElement("div",{className:b()(i)},"[",t,"]")}else e=l.a.createElement("div",{className:"flex-grow-1"},c.actions.map((e,t)=>l.a.createElement("button",{key:t,className:"btn btn-primary mr-2",onClick:()=>this.actionClick(e)},this.controller.getActionLabel(s,e.name)))),"$"===s&&(t=l.a.createElement("div",null,l.a.createElement("button",{className:"btn btn-outline-info ml-2",onClick:this.editClick},"\u4fee\u6539"),l.a.createElement("button",{className:"btn btn-outline-danger ml-2",onClick:this.deleteClick},"\u4f5c\u5e9f")));return l.a.createElement(n.Page,{header:this.label+":"+a+"-"+r},l.a.createElement("div",{className:"mb-2"},l.a.createElement("div",{className:"d-flex px-3 py-2 border-bottom bg-light"},e,t),l.a.createElement(this.sheetView,null)))}),this.acted=(()=>{let{discription:e}=this.sheetData.brief;return l.a.createElement(n.Page,{header:"\u5df2\u5904\u7406",back:"close"},l.a.createElement("div",{className:"p-3 d-flex flex-column align-items-center"},l.a.createElement("div",{className:"p-3"},e),l.a.createElement("div",{className:"text-success"},l.a.createElement(d.FA,{name:"check-circle-o"})," \u5355\u636e\u5df2\u5904\u7406\uff01"),l.a.createElement("div",{className:"p-3"},l.a.createElement("button",{className:"btn btn-outline-info",onClick:()=>this.backPage()},"\u8fd4\u56de"))))})}open(e){return s.a(this,void 0,void 0,function*(){this.sheetData=e,this.vForm=this.createForm(void 0,e.data),this.openPage(this.page)})}}class w extends a.b{constructor(){super(...arguments),this.view=(()=>o.createElement(n.Page,{header:this.label+"\u6a21\u677f"},o.createElement("pre",{className:"mx-3 my-2"},this.entity.schemaStringify())))}open(e){return s.a(this,void 0,void 0,function*(){this.openPage(this.view)})}}class E extends a.b{constructor(){super(...arguments),this.archiveClick=(e=>s.a(this,void 0,void 0,function*(){1!==e.processing&&this.event("archived",e)})),this.archiveRow=((e,t)=>{let{id:i,no:s,discription:r,date:n}=e,a=o.createElement(o.Fragment,null,1===e.processing?"... ":"",e.no," \xa0 ",e.discription),l=o.createElement(d.Muted,null,o.createElement(d.EasyDate,{date:n}));return o.createElement(d.LMR,{className:"px-3 py-2",left:a,right:l})}),this.view=(()=>o.createElement(n.Page,{header:"\u5df2\u5f52\u6863"+this.label},o.createElement(d.List,{items:this.list,item:{render:this.archiveRow,onClick:this.archiveClick}})))}open(){return s.a(this,void 0,void 0,function*(){this.list=yield this.entity.getArchives(void 0,10),this.openPage(this.view)})}}class C extends a.b{constructor(){super(...arguments),this.rowClick=(e=>s.a(this,void 0,void 0,function*(){1!==e.processing?this.event("action",e.id):this.event("processing",e.id)})),this.onScrollBottom=(()=>{console.log("onScrollBottom"),this.controller.pageStateItems.more()}),this.rowContent=(e=>{let{id:t,no:i,discription:s,date:r,processing:n}=e,a=o.createElement(o.Fragment,null,i," \xa0 ",o.createElement(d.Muted,null,s)," ",1===n?"...":""),l=o.createElement(d.Muted,null,o.createElement(d.EasyDate,{date:r}));return o.createElement(d.LMR,{className:"px-3 py-2",left:a,right:l})}),this.renderRow=((e,t)=>o.createElement(this.row,Object.assign({},e))),this.view=(()=>{let{pageStateItems:e}=this.controller;return o.createElement(n.Page,{header:this.label+" - "+this.stateLabel,onScrollBottom:this.onScrollBottom},o.createElement(d.List,{items:e,item:{render:this.renderRow,onClick:this.rowClick}}))})}open(e){return s.a(this,void 0,void 0,function*(){this.row=this.ui.listRow||this.rowContent,this.stateName=e.state,this.stateLabel=this.controller.getStateLabel(this.stateName),yield this.controller.pageStateItems.first(this.stateName),this.openPage(this.view)})}}class x extends v{constructor(){super(...arguments),this.view=(()=>{let{brief:e}=this.sheetData;return o.createElement(n.Page,{header:this.label+":-"+e.no},o.createElement(this.sheetView,null))})}open(e){return s.a(this,void 0,void 0,function*(){this.sheetData=e,this.vForm=this.createForm(void 0,this.sheetData.data),this.openPage(this.view)})}}class k extends a.b{}class N extends k{constructor(){super(...arguments),this.restart=(()=>s.a(this,void 0,void 0,function*(){this.ceasePage(),yield this.event("new")})),this.actionClick=(e=>s.a(this,void 0,void 0,function*(){this.ceasePage();let{id:t,flow:i,state:s}=this.brief;yield this.controller.action(t,i,s,e.name);this.openPage(this.acted)})),this.buttons=o.createElement(o.Fragment,null,o.createElement("button",{className:"btn btn-outline-primary mr-3",onClick:this.restart},"\u7ee7\u7eed\u5f00\u5355"),o.createElement("button",{className:"btn btn-outline-info",onClick:()=>this.backPage()},"\u8fd4\u56de")),this.view=(()=>{let{states:e}=this.entity;let t=e.find(e=>"$"===e.name),i=o.createElement(o.Fragment,null,t.actions.map((e,t)=>o.createElement("button",{key:t,className:"btn btn-primary mr-3",onClick:()=>this.actionClick(e)},this.controller.getActionLabel("$",e.name))));return o.createElement(n.Page,{header:"\u5df2\u4fdd\u5b58",back:"close"},o.createElement("div",{className:"p-3 d-flex flex-column align-items-center"},o.createElement("div",{className:"text-success"},o.createElement(d.FA,{name:"check-circle-o"})," \u5355\u636e\u5df2\u4fdd\u5b58\uff01\u7cfb\u7edf\u5c1a\u672a\u5904\u7406"),o.createElement("div",{className:"p-3"},i,this.buttons)))}),this.acted=(()=>o.createElement(n.Page,null,o.createElement("div",{className:"p-3 d-flex flex-column align-items-center"},o.createElement("div",{className:"text-success"},o.createElement(d.FA,{name:"check-circle-o"})," \u5355\u636e\u5df2\u5904\u7406\uff01"),o.createElement("div",{className:"p-3"},this.buttons))))}open(e){return s.a(this,void 0,void 0,function*(){this.brief=e,this.openPage(this.view)})}}class S extends v{constructor(){super(...arguments),this.page=(()=>{let{brief:e}=this.sheetData,{state:t,no:i}=e,s=this.controller.getStateLabel(t);return l.a.createElement(n.Page,{header:this.label+":"+s+"-"+i},l.a.createElement("div",{className:"mb-2"},l.a.createElement("div",{className:"d-flex px-3 py-2 border-bottom bg-light"},"\u6b63\u5728\u5904\u7406\u4e2d..."),l.a.createElement(this.sheetView,null)))})}open(e){return s.a(this,void 0,void 0,function*(){this.sheetData=e,this.vForm=this.createForm(void 0,e.data),this.openPage(this.page)})}}class F extends a.a{constructor(){super(...arguments),this.statesCount=r.l.array([],{deep:!0}),this.onSave=((e,t)=>s.a(this,void 0,void 0,function*(){let i=yield this.saveSheet(e,t);this.ceasePage(),yield this.showSaved(i)}))}internalStart(){return s.a(this,void 0,void 0,function*(){yield this.loadStateSheetCount(),this.pageStateItems=this.entity.createPageStateItems(),yield this.openVPage(this.VSheetMain)})}onMessage(e){return s.a(this,void 0,void 0,function*(){let{type:t,body:i,from:s,to:r,push:n}=e;"sheet"===t&&this.onSheet(s,r,i)})}onSheet(e,t,i){let s=this.user.id,{id:r,preState:n,state:a}=i;console.log({$:"onMessage sheet",from:e,to:t.join(","),id:r,preState:n,state:a,me:s,sheetData:i}),e===s&&this.sheetActPreState(r,n),void 0!==t.find(e=>e===s)&&this.sheetActState(r,a,i)}sheetActPreState(e,t){if(this.changeStateCount(t,-1),void 0===this.curState||this.curState!==t)return;let i=this.pageStateItems.items.findIndex(t=>t.id===e);i>=0&&this.pageStateItems.items.splice(i,1)}sheetActState(e,t,i){this.changeStateCount(t,1),void 0!==this.curState&&this.curState===t&&this.pageStateItems.items.findIndex(t=>t.id===e)<0&&this.pageStateItems.items.push(i)}changeStateCount(e,t){if(void 0===e)return;let i=this.statesCount.findIndex(t=>t.state===e);if(console.log({$:"changeState",state:e,delta:t,index:i}),i<0)return;let s=this.statesCount[i];s.count+=t,s.count<0&&(s.count=0)}get VSheetMain(){return this.ui&&this.ui.main||h}get VSheetNew(){return this.ui.sheetNew||u}get VSheetSaved(){return this.ui.sheetSaved||N}get VSheetEdit(){return this.ui.sheetEdit||f}get VSheetSchema(){return w}get VArchives(){return E}get VArchived(){return x}get VSheetList(){return C}get VSheetAction(){return this.ui.sheetAction||y}get VSheetProcessing(){return S}onEvent(e,t){return s.a(this,void 0,void 0,function*(){let i;switch(e){default:return;case"new":i=this.VSheetNew;break;case"schema":i=this.VSheetSchema;break;case"archives":i=this.VArchives;break;case"state":this.curState=t.state,i=this.VSheetList;break;case"archived":return void(yield this.showArchived(t));case"action":return void(yield this.showAction(t));case"processing":return void(yield this.showProcessing(t))}yield this.openVPage(i,t)})}startSheet(e){return s.a(this,void 0,void 0,function*(){!1!==(yield this.beforeStart())&&(yield this.onEvent("action",e))})}showAction(e){return s.a(this,void 0,void 0,function*(){let t=yield this.getSheetData(e);Object(n.postWsToTop)({body:{$type:"msg",action:"$sheet",msg:{id:e,uq:this.cUq.id,state:t.brief.state}}}),yield this.openVPage(this.VSheetAction,t)})}showProcessing(e){return s.a(this,void 0,void 0,function*(){let t=yield this.getSheetData(e);yield this.openVPage(this.VSheetProcessing,t)})}editSheet(e){return s.a(this,void 0,void 0,function*(){return yield this.vCall(this.VSheetEdit,e)})}showArchived(e){return s.a(this,void 0,void 0,function*(){let t=yield this.getArchived(e.id);yield this.openVPage(this.VArchived,t)})}showSaved(e){return s.a(this,void 0,void 0,function*(){yield this.openVPage(this.VSheetSaved,e)})}getStateUI(e){let{states:t}=this.res;if(void 0!==t)return t[e]}getStateLabel(e){let t=this.getStateUI(e),i=t&&t.label||e;switch(i){default:return i;case"$":return"\u65b0\u5355"}}getActionLabel(e,t){let i=this.getStateUI(e);if(void 0===i)return t;let s=i.actions;if(void 0===s)return t;let r=s[t];return r&&r.label||t}loadStateSheetCount(){return s.a(this,void 0,void 0,function*(){this.statesCount.clear();let e=yield this.entity.stateSheetCount();this.statesCount.splice(0,0,...e)})}getSheetData(e){return s.a(this,void 0,void 0,function*(){return yield this.entity.getSheet(e)})}getArchived(e){return s.a(this,void 0,void 0,function*(){return yield this.entity.getArchive(e)})}saveSheet(e,t){return s.a(this,void 0,void 0,function*(){let{sheetTitle:i}=this.ui,s=void 0===i?this.label:i(t,this.x);return yield this.entity.save(s,e)})}action(e,t,i,r){return s.a(this,void 0,void 0,function*(){return yield this.entity.action(e,t,i,r)})}}i.d(t,"a",function(){return F})},function(e,t,i){"use strict";var s=i(1),r=i(2),n=i(36),a=i(20),o=i(8),l=i(0),c=i.n(l);class d extends o.b{constructor(){super(...arguments),this.view=(()=>l.createElement(r.Page,{header:this.label},"Book"))}open(e){return s.a(this,void 0,void 0,function*(){this.openPage(this.view)})}}class h extends o.a{internalStart(){return s.a(this,void 0,void 0,function*(){yield this.openVPage(this.VBookMain)})}get VBookMain(){return d}}var u=i(51),m=i(54),p=i(41),v=i(29),f=i(53),g=i(10),b=i(3);class y extends r.View{constructor(e){super(e),this.isSysVisible=!1,this.view=(()=>{let e,{res:t,uq:i,error:s}=this.controller,r={render:(e,t)=>e.render(),onClick:void 0},n=[{header:t.tuid||"TUID",items:this.tuidLinks},{cn:"my-2",header:t.map||"MAP",items:this.mapLinks},{cn:"my-2",header:t.sheet||"SHEET",items:this.sheetLinks},{cn:"my-2",header:t.action||"ACTION",items:this.actionLinks},{cn:"my-2",header:t.query||"QUERY",items:this.queryLinks},{cn:"mt-2 mb-4",header:t.book||"BOOK",items:this.bookLinks},{cn:"mt-2 mb-4",header:t.history||"HISTORY",items:this.historyLinks},{cn:"mt-2 mb-4",header:t.pending||"PENDING",items:this.pendingLinks}];return e=void 0!==s?c.a.createElement("div",{className:"p-3 text-danger"},"\u8fde\u63a5\u9519\u8bef: ",s):n.map(({cn:e,header:t,items:i},s)=>i.length>0&&c.a.createElement(b.List,{key:s,className:e,header:c.a.createElement("div",{className:"px-3 py-1 bg-light"},c.a.createElement(b.Muted,null,t)),items:i,item:r})),c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"px-3 py-1 small"},t.uq||i),e)});let{tuidArr:t,mapArr:i,sheetArr:s,actionArr:r,queryArr:n,bookArr:o,historyArr:l,pendingArr:d}=e.entities;this.tuidLinks=t.filter(e=>this.isVisible(e)).map(e=>new a.a(this.controller.cTuidMain(e))),this.mapLinks=i.filter(e=>this.isVisible(e)).map(e=>new a.a(this.controller.cMap(e))),this.sheetLinks=s.filter(e=>this.isVisible(e)).map(e=>new a.a(this.controller.cSheet(e))),this.actionLinks=r.filter(e=>this.isVisible(e)).map(e=>new a.a(this.controller.cAction(e))),this.queryLinks=n.filter(e=>this.isVisible(e)).map(e=>new a.a(this.controller.cQuery(e))),this.bookLinks=o.filter(e=>this.isVisible(e)).map(e=>new a.a(this.controller.cBook(e))),this.historyLinks=l.filter(e=>this.isVisible(e)).map(e=>new a.a(this.controller.cHistory(e))),this.pendingLinks=d.filter(e=>this.isVisible(e)).map(e=>new a.a(this.controller.cPending(e)))}isVisible(e){return!0!==e.sys||this.isSysVisible}render(e){return void 0===this.view?c.a.createElement("div",null,"??? viewModel \u5fc5\u987b\u5b9a\u4e49 view ???"):c.a.createElement(this.view)}}var w=i(56),E=i(55);function C(e){if(void 0!==e)for(let t in e)e[t.toLowerCase()]=e[t]}class x extends r.Controller{constructor(e,t,i,s,a,o){super(Object(r.resLang)(o.res)),this.schemaLoaded=!1,this.isSysVisible=!1,this.cApp=e,this.uq=t,this.id=s,C(o.tuid),C(o.sheet),C(o.map),C(o.query),C(o.action),C(o.book),C(o.history),C(o.pending),this.ui=o,this.CTuidMain=o.CTuidMain||v.d,this.CTuidEdit=o.CTuidEdit||v.a,this.CTuidList=o.CTuidList||v.c,this.CTuidSelect=o.CTuidSelect||v.e,this.CTuidInfo=o.CTuidInfo||v.b,this.CQuery=o.CQuery||p.a,this.CQuerySelect=o.CQuerySelect||p.b,this.CMap=o.CMap||f.a,this.CAction=o.CAction||m.a,this.CSheet=o.CSheet||u.a,this.CBook=o.CBook||h,this.CHistory=o.CHistory||w.a,this.CPending=o.CPending||E.a;let l,c,d=t.split("/");switch(d.length){case 1:l="$$$",c=d[0];break;case 2:l=d[0],c=d[1];break;default:return void console.log("uq must be uqOwner/uqName format")}let g,b,y=document.location.hash,x=void 0===y||""===y?"debug/":"tv/";g=null===a||void 0===a||"*"===a?[]:a.split(";").map(e=>e.trim()).filter(e=>e.length>0),b="$$$/$unitx"===t?new r.UnitxApi(r.appInFrame.unit):new r.UqApi(x,l,c,g,!0),this.entities=new n.a(this,b,i)}internalStart(){return s.a(this,void 0,void 0,function*(){})}loadEntites(){return s.a(this,void 0,void 0,function*(){yield this.entities.loadAccess()})}loadSchema(){return s.a(this,void 0,void 0,function*(){try{if(!0===this.schemaLoaded)return;yield this.loadEntites(),void 0===this.id&&(this.id=this.entities.uqId);for(let e in this.ui){let t=this.ui[e];if(void 0===t)continue;let{caption:i,collection:s}=t;if(void 0!==s)for(let r in s)void 0===this.entities[e](r)&&console.warn(e+":'"+r+"' is not uq entity")}return void(this.schemaLoaded=!0)}catch(e){return console.error(e),this.error=e}})}getQuerySearch(e){return s.a(this,void 0,void 0,function*(){let t=this.entities.query(e);if(void 0===t)alert(`QUERY ${e} \u6ca1\u6709\u5b9a\u4e49!`);else{yield t.loadSchema();let{returns:i}=t;i.length>1&&alert(`QUERY ${e} \u8fd4\u56de\u591a\u5f20\u8868, \u65e0\u6cd5\u505aQuerySearch`)}return t})}getTuidPlaceHolder(e){let t,{tuidPlaceHolder:i,entity:s}=this.res,{name:r}=e;if(void 0!==s){let e=s[r];void 0!==e&&(t=e.label)}return i||"Select"}getNone(){let{none:e}=this.res;return e||"none"}isVisible(e){return!0!==e.sys||this.isSysVisible}navSheet(e,t){return s.a(this,void 0,void 0,function*(){let i=this.entities.sheetFromTypeId(e);if(void 0===i)return void alert("sheetTypeId "+e+" is not exists!");let s=this.cSheet(i);yield s.startSheet(t)})}sheet(e){return this.entities.sheet(e)}action(e){return this.entities.action(e)}query(e){return this.entities.query(e)}book(e){return this.entities.book(e)}map(e){return this.entities.map(e)}history(e){return this.entities.history(e)}pending(e){return this.entities.pending(e)}tuid(e){return this.entities.tuid(e)}tuidDiv(e,t){let i=this.entities.tuid(e);if(void 0===i)return;let{divs:s}=i;return void 0!==s?s[t]:void 0}cSheetFromName(e){let t=this.entities.sheet(e);if(void 0!==t)return this.cSheet(t)}cActionFromName(e){let t=this.entities.action(e);if(void 0!==t)return this.cAction(t)}cQueryFromName(e){let t=this.entities.query(e);if(void 0!==t)return this.cQuery(t)}cBookFromName(e){let t=this.entities.book(e);if(void 0!==t)return this.cBook(t)}cMapFromName(e){let t=this.entities.map(e);if(void 0!==t)return this.cMap(t)}cHistoryFromName(e){let t=this.entities.history(e);if(void 0!==t)return this.cHistory(t)}cPendingFromName(e){let t=this.entities.pending(e);if(void 0!==t)return this.cPending(t)}cTuidMainFromName(e){let t=this.entities.tuid(e);if(void 0!==t)return this.cTuidMain(t)}cTuidEditFromName(e){let t=this.entities.tuid(e);if(void 0!==t)return this.cTuidEdit(t)}cTuidInfoFromName(e){let t=this.entities.tuid(e);if(void 0!==t)return this.cTuidInfo(t)}cTuidSelectFromName(e){let t=this.entities.tuid(e);if(void 0!==t)return this.cTuidSelect(t)}cFromName(e,t){switch(e){case"sheet":let i=this.entities.sheet(t);if(void 0===i)return;return this.cSheet(i);case"action":let s=this.entities.action(t);if(void 0===s)return;return this.cAction(s);case"tuid":let r=this.entities.tuid(t);if(void 0===r)return;return this.cTuidMain(r);case"query":let n=this.entities.query(t);if(void 0===n)return;return this.cQuery(n);case"book":let a=this.entities.book(t);if(void 0===a)return;return this.cBook(a);case"map":let o=this.entities.map(t);if(void 0===o)return;return this.cMap(o);case"history":let l=this.entities.history(t);if(void 0===l)return;return this.cHistory(l);case"pending":let c=this.entities.pending(t);if(void 0===c)return;return this.cPending(c)}}linkFromName(e,t){return this.link(this.cFromName(e,t))}getUI(e){let t,i,{name:s,typeName:r}=e;if(void 0!==this.ui){let e=this.ui[r];void 0!==e&&(t=e[s])}let{entity:n}=this.res;return void 0!==n&&(i=n[s]),{ui:t||{},res:i||{}}}link(e){return new a.a(e)}get tuidLinks(){return this.entities.tuidArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cTuidMain(e)))}cTuidMain(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CTuidMain||this.CTuidMain)(this,e,t,i)}cTuidEdit(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CTuidEdit||this.CTuidEdit)(this,e,t,i)}cTuidList(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CTuidList||this.CTuidList)(this,e,t,i)}cTuidSelect(e){let{ui:t,res:i}=this.getUI(e.owner||e);return new(t&&t.CTuidSelect||this.CTuidSelect)(this,e,t,i)}cTuidInfo(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CTuidInfo||this.CTuidInfo)(this,e,t,i)}cSheet(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CSheet||this.CSheet)(this,e,t,i)}get sheetLinks(){return this.entities.sheetArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cSheet(e)))}cAction(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CAction||this.CAction)(this,e,t,i)}get actionLinks(){return this.entities.actionArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cAction(e)))}cQuery(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CQuery||this.CQuery)(this,e,t,i)}cQuerySelect(e){let t=this.entities.query(e);if(void 0===t)return;let{ui:i,res:s}=this.getUI(t);return new(i&&i.CQuerySelect||this.CQuerySelect)(this,t,i,s)}get queryLinks(){return this.entities.queryArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cQuery(e)))}cBook(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CBook||this.CBook)(this,e,t,i)}get bookLinks(){return this.entities.bookArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cBook(e)))}cHistory(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CHistory||this.CHistory)(this,e,t,i)}get historyLinks(){return this.entities.historyArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cHistory(e)))}cPending(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CPending||this.CPending)(this,e,t,i)}get pendingLinks(){return this.entities.pendingArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cPending(e)))}cMap(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CMap||this.CMap)(this,e,t,i)}get mapLinks(){return this.entities.mapArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cMap(e)))}getTuidContent(e){let{owner:t}=e;if(void 0===t){let{ui:t}=this.getUI(e);return t&&t.content||g.b}{let{ui:i}=this.getUI(t);return i&&i.divs&&i.divs[e.name].content||g.b}}showTuid(e,t){return s.a(this,void 0,void 0,function*(){let{owner:i}=e,s=this.cTuidInfo(i||e);yield s.start(t)})}get VUq(){return y}render(){return new this.VUq(this).render()}}i.d(t,"a",function(){return x})},function(e,t,i){"use strict";var s=i(1),r=i(9),n=i.n(r),a=i(8),o=i(36),l=i(0),c=i(6),d=i(5),h=i.n(d),u=i(3),m=i(2),p=i(15),v=i(10);class f extends a.b{constructor(){super(...arguments),this.itemRender=((e,t)=>l.createElement(this.ItemRow,{item:e})),this.ItemRow=Object(c.a)(({item:e})=>{let t,i,s,r,n,a,{tuid:o,box:c,children:d,isLeaf:m,keyIndex:f,values:g}=e,b=this.controller.keyUIs[f],{content:y,valuesContent:w,none:E}=b;if(!1===this.isFrom&&(t=l.createElement("button",{className:"btn btn-link btn-sm",onClick:()=>this.controller.addClick(e)},l.createElement(u.FA,{name:"plus"})),i=l.createElement("button",{className:"btn btn-link btn-sm",onClick:()=>this.controller.removeClick(e)},l.createElement(u.FA,{className:"text-info",name:"trash"}))),!1===m?s=0===f?t:l.createElement(l.Fragment,null,i," \xa0 ",t):f>0&&(s=i),!0===m)r=void 0,g&&(a=(w||v.b)(g,this.x));else{n="border-bottom";let e=E&&E(this.x);r=l.createElement(u.List,{className:"ml-4",items:d,item:{onClick:void 0,render:this.itemRender},none:e})}let C=l.createElement("div",{className:"py-1 pr-3"},Object(p.b)(c,y,this.x));return l.createElement("div",{className:"d-flex flex-column"},l.createElement(u.LMR,{className:h()("px-3","py-2",n),left:C,right:s},l.createElement("div",{className:"py-1"},a)),r)})}open(e){return s.a(this,void 0,void 0,function*(){this.isFrom=this.controller.isFrom,this.openPage(this.view)})}get view(){return()=>l.createElement(m.Page,{header:this.label},l.createElement(u.List,{items:this.controller.items,item:{className:"my-2",onClick:void 0,render:this.itemRender}}))}}var g=i(4);class b extends a.b{constructor(){super(...arguments),this.onValuesSubmit=(()=>s.a(this,void 0,void 0,function*(){this.ceasePage();let e=this.vForm.getValues();this.returnCall(e)})),this.view=(()=>l.createElement(m.Page,null,this.vForm.render()))}open(e){return s.a(this,void 0,void 0,function*(){this.vForm=this.createForm(this.onValuesSubmit),this.openPageElement(l.createElement(this.view,null))})}}class y{constructor(e,t,i,s){this.children=g.l.array([],{deep:!0}),this.parent=e,this.tuid=t,this.box=i,this.keyIndex=s,this.isLeaf=!1}}class w extends a.a{constructor(){super(...arguments),this.addClick=(e=>s.a(this,void 0,void 0,function*(){let{keyIndex:t,children:i}=e,s=this.keyFields.length,r=s-1,n=t+1;if(n>=s)return;let a=this.keyFields[n],l=a.name,c=a._tuid,d={},h={};for(let o=e;void 0!==o;o=o.parent){let{keyIndex:e,box:t}=o,i=this.keyFields[e].name;d[i]=h[i]=t.id}let u=yield this.searchOnKey(a,d);if(void 0===u||u<=0)return;c.useId(u);let m=c.boxId(u),p={},v={};if(t+1===r){if(c.useId(u),v[l]=p[l]=m,this.entity.fields.length>0){let e=yield this.vCall(b,h);for(let t in e)v[t]=p[t]=e[t]}}else{v[l]=h[l]=m;for(let t=n+1;t<r;t++)h[this.keyFields[t].name]=0;p[this.keyFields[r].name]=0;let{fields:e}=this.entity;for(let t of e){let{name:e,type:i,null:s}=t;!0!==s&&(p[t.name]=Object(o.b)(i))}}h.arr1=[p],yield this.entity.actions.add.submit(h);let f=i.findIndex(e=>e.box.id===u);if(f<0)i.push(this.createItem(e,c,m,n,v));else{let{fields:e}=this.entity;if(void 0!==e&&e.length>0){let e=i[f];i.splice(f,1),e.values=v,i.splice(f,0,e)}}this.removeCeased()})),this.removeClick=(e=>s.a(this,void 0,void 0,function*(){let t=this.keyFields[e.keyIndex]._tuid,i=this.cUq.cTuidMain(t.Main).getLable(t),s=this.res.confirmDelete||n.a.template("do you really want to remove ${label}?");if(!1===confirm(s({label:i})))return;let r=this.entity,a={},o={};(a.arr1=[]).push(o);for(let n=e;void 0!==n;n=n.parent){let e=n.keyIndex;o[this.keyFields[e].name]=n.box.id}let l=this.keyFields.length;for(let n=e.keyIndex+1;n<l;n++){o[this.keyFields[n].name]=-1}yield r.actions.del.submit(a);let c=e.parent.children,d=c.findIndex(t=>t===e);d>=0&&c.splice(d,1)}))}internalStart(){return s.a(this,void 0,void 0,function*(){let{keys:e,schemaFrom:t}=this.entity;this.isFrom=void 0!==t;let i=this.entity.queries.all,s=(yield i.query({})).ret,r=e.length;this.keyUIs=n.a.clone(this.ui.keys||[]),this.keyFields=[];let a=i.returns[0].fields;for(let n=0;n<r;n++)this.keyFields.push(a[n]),n>=this.keyUIs.length&&this.keyUIs.push({content:v.b});this.items=Object(g.l)([]);let o=void 0;for(let n of s){let e=this.addItem(o,n);void 0!==e&&(this.items.push(e),o=e)}yield this.openVPage(this.VMapMain)})}createItem(e,t,i,s,r){let n=new y(e,t,i,s);return s===this.keyFields.length-1&&(n.isLeaf=!0,n.values=r),n}addItem(e,t){let i=void 0,s=this.keyFields.length,r=e;for(let n=0;n<s;n++){let e=this.keyFields[n],{name:s}=e,a=e._tuid,o=t[s];if(void 0===o)break;let{id:l}=o;if(0===n){if(0===l)continue;void 0!==r&&r.box.id===l||(i=r=this.createItem(void 0,a,o,n,t));continue}let{children:c,box:d}=r,h=c.length;if(h>0){let e=c[h-1];if(e.box.id===l){r=e;continue}}l>0&&c.push(r=this.createItem(r,a,o,n,t))}return i}searchOnKey(e,t){return s.a(this,void 0,void 0,function*(){let{_tuid:i,_ownerField:s}=e,r=this.cUq.cTuidSelect(i),n=t;void 0!==s&&"object"===typeof(n=t[s.name])&&(n=n.id);let a=yield r.call(n);return i.getIdFromObj(a)})}get VMapMain(){return f}}i.d(t,"a",function(){return w})},function(e,t,i){"use strict";var s=i(1),r=i(8),n=i(0),a=i(2),o=i(15);class l extends r.b{constructor(){super(...arguments),this.onSubmit=(()=>s.a(this,void 0,void 0,function*(){let e=this.vForm.getValues();this.returns=yield this.controller.submit(e),this.closePage(),this.openPage(this.resultPage)})),this.mainPage=(()=>{let{label:e}=this.controller;return n.createElement(a.Page,{header:e},this.vForm.render("mx-3 my-2"))}),this.resultPage=(()=>{let{label:e}=this.controller;return n.createElement(a.Page,{header:e,back:"close"},"\u5b8c\u6210\uff01",n.createElement("pre",null,Object(o.a)(this.returns)))})}open(e){return s.a(this,void 0,void 0,function*(){this.vForm=this.createForm(this.onSubmit,e),this.openPage(this.mainPage)})}}class c extends r.a{internalStart(){return s.a(this,void 0,void 0,function*(){yield this.openVPage(this.VActionMain)})}get VActionMain(){return l}submit(e){return s.a(this,void 0,void 0,function*(){return this.entity.submit(e)})}}i.d(t,"a",function(){return c})},function(e,t,i){"use strict";var s=i(1),r=i(8),n=i(0),a=i(2);class o extends r.b{constructor(){super(...arguments),this.view=(()=>n.createElement(a.Page,{header:this.label},"pending"))}open(e){return s.a(this,void 0,void 0,function*(){this.openPage(this.view)})}}class l extends r.a{internalStart(){return s.a(this,void 0,void 0,function*(){yield this.openVPage(this.VPendingMain)})}get VPendingMain(){return o}}i.d(t,"a",function(){return l})},function(e,t,i){"use strict";var s=i(1),r=i(8),n=i(0),a=i(2);class o extends r.b{constructor(){super(...arguments),this.view=(()=>n.createElement(a.Page,{header:this.label},"History"))}open(e){return s.a(this,void 0,void 0,function*(){this.openPage(this.view)})}}class l extends r.a{internalStart(){return s.a(this,void 0,void 0,function*(){yield this.openVPage(this.VHistoryMain)})}get VHistoryMain(){return o}}i.d(t,"a",function(){return l})},function(e,t,i){"use strict";i.d(t,"a",function(){return a});var s=i(1),r=i(11),n=i(4);class a{constructor(e,t,i,s){this.isChanged=!1,this.itemSchema=e,this.uiItem=t,this.value=s;let{name:r}=e;this.name=r,this.label=i}start(){return s.a(this,void 0,void 0,function*(){return yield this.internalStart()})}end(){return s.a(this,void 0,void 0,function*(){yield this.internalEnd()})}internalEnd(){return s.a(this,void 0,void 0,function*(){r.c.pop()})}}s.b([n.l],a.prototype,"isChanged",void 0)},function(e,t,i){"use strict";i.d(t,"a",function(){return s});const s={uqBasedata:"bruce/scmbasedata",appIcon:"http://101.200.46.56/imgs/Bear-icon.png"}},,function(e,t,i){"use strict";i.d(t,"a",function(){return n});var s=i(19),r=i(21);const n={set(e,t){Object(s.i)(e,t),r.a.setCenterToken(t)},clear(){Object(s.i)(0,void 0),r.a.setCenterToken(void 0)}}},function(e,t,i){"use strict";var s=i(1),r=i(14),n=i(27);const a=new class extends r.a{login(e){return s.a(this,void 0,void 0,function*(){let t=yield this.get("login",e);switch(typeof t){default:return;case"string":return Object(n.b)(t);case"object":let e=t.token,i=Object(n.b)(e),{nick:s,icon:r}=t;return s&&(i.nick=s),r&&(i.icon=r),i}})}register(e){return s.a(this,void 0,void 0,function*(){return yield this.post("register",e)})}setVerify(e,t){return s.a(this,void 0,void 0,function*(){return yield this.post("set-verify",{account:e,type:t})})}checkVerify(e,t){return s.a(this,void 0,void 0,function*(){return yield this.post("check-verify",{account:e,verify:t})})}isExists(e){return s.a(this,void 0,void 0,function*(){return yield this.get("is-exists",{account:e})})}resetPassword(e,t,i,r){return s.a(this,void 0,void 0,function*(){return yield this.post("reset-password",{account:e,password:t,verify:i,type:r})})}userSetProp(e,t){return s.a(this,void 0,void 0,function*(){yield this.post("tie/user-set-prop",{prop:e,value:t})})}}("tv/user/",void 0);t.a=a},,function(e,t,i){"use strict"},,,function(e,t,i){"use strict";i.d(t,"a",function(){return l}),i.d(t,"c",function(){return c}),i.d(t,"b",function(){return d});var s=i(1),r=i(0),n=i(11),a=i(22),o=i(14);class l{constructor(e){this.isDev=o.j,this.onMessageReceive=(e=>s.a(this,void 0,void 0,function*(){yield this.onMessage(e)})),this.res=e||{},this.x=this.res.x||{}}get user(){return n.c.user}get isLogined(){let{user:e}=n.c;return void 0!==e&&e.id>0}dispose(){n.c.unregisterReceiveHandler(this.receiveHandlerId),this.onDispose()}onDispose(){}openVPage(e,t){return s.a(this,void 0,void 0,function*(){yield new e(this).open(t)})}renderView(e,t){return new e(this).render(t)}event(e,t){return s.a(this,void 0,void 0,function*(){yield this.onEvent(e,t)})}onEvent(e,t){return s.a(this,void 0,void 0,function*(){})}msg(e){alert(e)}errorPage(e,t){this.openPage(r.createElement(a.a,{header:"App error!"},r.createElement("pre",null,"string"===typeof t?t:t.message)))}onMessage(e){}beforeStart(){return s.a(this,void 0,void 0,function*(){return!0})}registerReceiveHandler(){this.receiveHandlerId=n.c.registerReceiveHandler(this.onMessageReceive)}start(e){return s.a(this,void 0,void 0,function*(){this.disposer=this.dispose.bind(this),this.registerReceiveHandler(),!1!==(yield this.beforeStart())&&(yield this.internalStart(e))})}get isCalling(){return void 0!==this._resolve_$}call(e){return s.a(this,void 0,void 0,function*(){return void 0===this._resolve_$&&(this._resolve_$=[]),new Promise((t,i)=>s.a(this,void 0,void 0,function*(){this._resolve_$.push(t),yield this.start(e)}))})}vCall(e,t){return s.a(this,void 0,void 0,function*(){return void 0===this._resolve_$&&(this._resolve_$=[]),new Promise((i,r)=>s.a(this,void 0,void 0,function*(){this._resolve_$.push(i),yield new e(this).open(t)}))})}returnCall(e){if(void 0===this._resolve_$)return;let t=this._resolve_$.pop();void 0!==t?t(e):alert("the Controller call already returned, or not called")}openPage(e){n.c.push(e,this.disposer),this.disposer=void 0}replacePage(e){n.c.replace(e,this.disposer),this.disposer=void 0}backPage(){n.c.back()}closePage(e){n.c.pop(e)}ceasePage(e){n.c.ceaseTop(e)}removeCeased(){n.c.removeCeased()}regConfirmClose(e){n.c.regConfirmClose(e)}}class c{constructor(e){this.controller=e,this.res=e.res,this.x=e.x}get isDev(){return o.j}renderVm(e,t){return new e(this.controller).render(t)}openVPage(e,t){return s.a(this,void 0,void 0,function*(){yield new e(this.controller).open(t)})}event(e,t){return s.a(this,void 0,void 0,function*(){yield this.controller.event(e,t)})}returnCall(e){this.controller.returnCall(e)}openPage(e,t){this.controller.openPage(r.createElement(e,t))}replacePage(e,t){this.controller.replacePage(r.createElement(e,t))}openPageElement(e){this.controller.openPage(e)}replacePageElement(e){this.controller.replacePage(e)}backPage(){this.controller.backPage()}closePage(e){this.controller.closePage(e)}ceasePage(e){this.controller.ceasePage(e)}removeCeased(){this.controller.removeCeased()}regConfirmClose(e){this.controller.regConfirmClose(e)}}class d extends c{render(e){return null}}},function(e,t,i){"use strict";var s=i(68);i.o(s,"Edit")&&i.d(t,"Edit",function(){return s.Edit}),i.o(s,"Field")&&i.d(t,"Field",function(){return s.Field}),i.o(s,"Form")&&i.d(t,"Form",function(){return s.Form}),i.o(s,"Image")&&i.d(t,"Image",function(){return s.Image}),i.o(s,"Loading")&&i.d(t,"Loading",function(){return s.Loading}),i.o(s,"TabCaptionComponent")&&i.d(t,"TabCaptionComponent",function(){return s.TabCaptionComponent}),i.o(s,"Tabs")&&i.d(t,"Tabs",function(){return s.Tabs}),i.o(s,"resLang")&&i.d(t,"resLang",function(){return s.resLang});var r=i(69);i.o(r,"Edit")&&i.d(t,"Edit",function(){return r.Edit}),i.o(r,"Field")&&i.d(t,"Field",function(){return r.Field}),i.o(r,"Form")&&i.d(t,"Form",function(){return r.Form}),i.o(r,"Image")&&i.d(t,"Image",function(){return r.Image}),i.o(r,"Loading")&&i.d(t,"Loading",function(){return r.Loading}),i.o(r,"TabCaptionComponent")&&i.d(t,"TabCaptionComponent",function(){return r.TabCaptionComponent}),i.o(r,"Tabs")&&i.d(t,"Tabs",function(){return r.Tabs}),i.o(r,"resLang")&&i.d(t,"resLang",function(){return r.resLang})},function(e,t){},function(e,t){},function(e,t,i){"use strict";i.d(t,"a",function(){return a});var s=i(1),r=i(4),n=i(28);class a{constructor(e=!1){this.isFirst=!0,this.loading=!1,this.beforeLoad=!0,this.loaded=!1,this.allLoaded=!1,this.firstSize=100,this.pageStart=void 0,this.pageSize=30,this.appendPosition="tail",this._items=r.l.array([],{deep:e})}get items(){return!0===this.beforeLoad?null:!1!==this.loaded?this._items:void 0}scrollToTop(){this.topDiv="$$"+Object(n.a)()}scrollToBottom(){this.bottomDiv="$$"+Object(n.a)()}reset(){this.isFirst=!0,this.beforeLoad=!0,this.loaded=!1,this.param=void 0,this.allLoaded=!1,this._items.clear(),this.setPageStart(void 0)}append(e){"tail"===this.appendPosition?this._items.unshift(e):this._items.push(e)}first(e){return s.a(this,void 0,void 0,function*(){this.reset(),this.beforeLoad=!1,this.param=e,yield this.more()})}more(){return s.a(this,void 0,void 0,function*(){if(!0===this.allLoaded)return;if(!0===this.loading)return;this.loading=!0;let e=this.pageSize+1;!0===this.isFirst&&this.firstSize>this.pageSize&&(e=this.firstSize+1);let t=yield this.load(this.param,this.pageStart,e);this.loading=!1,this.loaded=!0;let i=t.length;!0===this.isFirst&&i>this.firstSize||!1===this.isFirst&&i>this.pageSize?(this.allLoaded=!1,--i,t.splice(i,1)):this.allLoaded=!0,0!==i?(this.setPageStart(t[i-1]),"tail"===this.appendPosition?this._items.push(...t):this._items.unshift(...t.reverse()),this.isFirst=!1):this._items.clear()})}}s.b([r.l],a.prototype,"loading",void 0),s.b([r.l],a.prototype,"beforeLoad",void 0),s.b([r.l],a.prototype,"loaded",void 0),s.b([r.l],a.prototype,"allLoaded",void 0),s.b([r.e],a.prototype,"items",null),s.b([r.l],a.prototype,"topDiv",void 0),s.b([r.l],a.prototype,"bottomDiv",void 0)},function(e,t,i){"use strict";var s=i(1),r=i(4);s.b([r.l],class{constructor(e=100){this.arr=[],this.dict=new Map,this.maxCount=e}loadIds(e){let t=[];for(let i of e){if(null===i)continue;let e=this.dict.get(i);void 0===e&&(t.push(i),e={id:i},this.dict.set(i,e))}this.loadId(t)}get(e){if(void 0===e||null===e)return null;let t=this.dict.get(e);return void 0===t&&(this.dict.set(e,{id:e}),this.loadId([e]),t=this.dict.get(e)),t}setItem(e,t){void 0===t?(this.dict.set(e,null),this.arr.push({id:e})):(this.dict.set(e,t),this.arr.push(t)),this.arr.length>this.maxCount&&(t=this.arr.shift(),this.dict.delete(t.id))}loadId(e){return s.a(this,void 0,void 0,function*(){let t=yield this._loadIds(e);if(void 0===t)for(let i of e){if(null===i)continue;let e=yield this._loadId(i);this.setItem(i,e)}else for(let i of e){let e=t.find(e=>e.id===i);this.setItem(i,e)}})}}.prototype,"dict",void 0)},function(e,t){},function(e,t){},function(e,t){},function(e,t,i){"use strict";i.d(t,"a",function(){return o});var s=i(1),r=i(0),n=i(6),a=i(47);let o=class extends r.Component{constructor(e){super(e),this.formView=new a.a(this.props)}componentWillMount(){this.formView.setInitValues(this.props.initValues)}debug(){}render(){let{className:e,children:t,initValues:i}=this.props;return r.createElement("div",{className:e},void 0===t?this.formView.render():r.createElement("form",{onSubmit:this.formView.onSubmit},t))}};o=s.b([n.a],o)},function(e,t,i){"use strict";i(0),i(5)},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var s=i(0);class r extends s.Component{render(){let{date:e}=this.props;if(!e)return null;let t="string"===typeof e?new Date(Date.parse(e)):e,i=new Date,s=i.getTime()-t.getTime(),r=i.getDate(),n=t.getDate(),a=t.getHours(),o=t.getMinutes(),l=t.getMonth()+1,c=a+(o<10?":0":":")+o;return s<-864e5?t.getFullYear()+"\u5e74"+l+"\u6708"+n+"\u65e5 "+c:s<864e5?n!==r?(s<0?"\u660e\u5929 ":"\u6628\u5929 ")+c:c:s<31536e6?l+"\u6708"+n+"\u65e5 ":t.getFullYear()+"\u5e74"+l+"\u6708"+n+"\u65e5"}}},function(e,t,i){"use strict";i.d(t,"a",function(){return o});var s=i(0),r=i(5),n=i.n(r),a=i(2);class o extends s.Component{render(){let e,{icon:t,main:i,discription:r,px:o,py:l}=this.props;e="string"===typeof r?s.createElement("div",null,r):r;let c=n()("media",void 0===o?"px-0":"px-"+o,void 0===l?"py-2":"py-"+l);return s.createElement("div",{className:c},s.createElement(a.Image,{className:"mr-3 w-4c h-4c",src:t}),s.createElement("div",{className:"media-body"},s.createElement("h5",{className:"mt-0"},i),e))}}},function(e,t,i){"use strict";i.d(t,"a",function(){return l});var s=i(1),r=i(0),n=i(5),a=i.n(n),o=i(4);class l extends r.Component{constructor(){super(...arguments),this.key=null,this.onChange=(e=>{this.key=e.target.value,void 0!==this.key&&(this.key=this.key.trim(),""===this.key&&(this.key=void 0)),!0!==this.props.allowEmptySearch&&(this.disabled=!this.key)}),this.onSubmit=(e=>s.a(this,void 0,void 0,function*(){if(e.preventDefault(),null===this.key&&(this.key=this.props.initKey||""),!0!==this.props.allowEmptySearch){if(!this.key)return;this.input&&(this.input.disabled=!0)}yield this.props.onSearch(this.key),this.input&&(this.input.disabled=!1)}))}clear(){this.input&&(this.input.value="")}render(){let e,t,{className:i,inputClassName:s,onFocus:n,label:o,placeholder:l,buttonText:c,maxLength:d,size:h}=this.props;switch(h){default:case"sm":e="input-group-sm";break;case"md":e="input-group-md";break;case"lg":e="input-group-lg"}return void 0!==o&&(t=r.createElement("label",{className:"input-group-addon"},o)),r.createElement("form",{className:i,onSubmit:this.onSubmit},r.createElement("div",{className:a()("input-group",e)},t,r.createElement("input",{ref:e=>this.input=e,onChange:this.onChange,type:"text",name:"key",onFocus:n,className:a()("form-control",s||"border-primary"),placeholder:l,defaultValue:this.props.initKey,maxLength:d}),r.createElement("div",{className:"input-group-append"},r.createElement("button",{className:"btn btn-primary",type:"submit",disabled:this.disabled},r.createElement("i",{className:"fa fa-search"}),r.createElement("i",{className:"fa"}),c))))}}s.b([o.l],l.prototype,"disabled",void 0)},function(e,t,i){"use strict";i(0),i(9),i(5),i(46)},function(e,t,i){"use strict";i(1),i(0),i(45)},function(e,t){},function(e,t,i){"use strict";var s=i(1),r=i(0),n=i(6),a=i(5),o=i.n(a);i(119);let l=class extends r.Component{render(){let e,{className:t,badge:i,size:s,color:n,badgeAlign:a,badgeVertical:l,children:c}=this.props,d=o()(t,"va-badge",s&&"va-badge-"+s,"va-badge-"+(n||"secondary"),a&&"va-badg-"+a,l&&"va-badg-"+l);return i&&(e=r.createElement("b",null,i)),r.createElement("div",{className:d},c,e)}};l=s.b([n.a],l);i(121);let c=class extends r.Component{render(){let e,t,i,{className:s,left:n,children:o,right:l,onClick:c}=this.props;return void 0!==n&&(e=r.createElement("header",null,n)),void 0!==l&&(t=r.createElement("footer",null,l)),void 0!==c&&(i="cursor-pointer"),r.createElement("div",{className:a("va-lmr",s,i),onClick:c},e,r.createElement("div",null,o),t)}};c=s.b([n.a],c);class d extends r.Component{render(){let{name:e,className:t,size:i,spin:s,fixWidth:n,border:o,pull:l,pulse:c,rotate:d,flip:h,inverse:u}=this.props,m=a(t,"fa",e&&"fa-"+e,i&&"fa-"+i,n&&"fa-fw",o&&"fa-border",l&&"fa-pull-"+l,s&&"fa-spin",c&&"fa-pulse",d&&"fa-rotate-"+d,h&&"fa-flip-"+h,u&&"fa-inverse");return r.createElement("i",{className:m})}}class h extends r.Component{render(){let{icon:e,iconClass:t,text:i,textClass:s}=this.props;return r.createElement("div",{className:"py-2"},r.createElement(d,{className:t,name:e,fixWidth:!0}),r.createElement("span",{className:s},i))}}const u=e=>r.createElement("small",{className:a("text-muted",e.className),style:e.style},e.children);i.d(t,"c",function(){return c}),i.d(t,"a",function(){return d}),i.d(t,"b",function(){return h}),i.d(t,"d",function(){return u})},function(e,t,i){"use strict";var s=i(1),r=i(0),n=i(5),a=i.n(n),o=i(6),l=i(4);class c{constructor(e){this.list=e}get isPaged(){let e=this.list.props.items;return null!==e&&void 0!==e&&!1===Array.isArray(e)}get items(){let e=this.list.props.items;return null===e?null:void 0!==e?!0===Array.isArray(e)?e:e.items:void 0}get loading(){let e=this.list.props.items;if(null===e)return!1;if(void 0===e)return!0;let t=e;return void 0!==t.items&&t.loading}get selectedItems(){}updateProps(e){}renderContent(e,t){let{render:i}=this.list.props.item;return void 0===i?r.createElement("div",{className:"px-3 py-2"},JSON.stringify(e)):i(e,t)}}s.b([l.e],c.prototype,"loading",null);class d extends c{render(e,t){let{className:i,key:s,onClick:a}=this.list.props.item;return r.createElement("li",{key:void 0===s?t:s(e),className:n("va-row-clickable",i),onClick:()=>a(e)},this.renderContent(e,t))}}var h=i(23);class u extends c{render(e,t){let{className:i,key:s,render:a}=this.list.props.item;if("string"===typeof e){let t=n("va-list-gap","px-3","pt-1");return r.createElement("li",{key:Object(h.a)(),className:t},e)}return r.createElement("li",{key:void 0===s?t:s(e),className:n(i)},this.renderContent(e,t))}}class m extends c{buildItems(){console.log("buildItems in selectable.tsx");let e,{items:t,selectedItems:i,compare:s}=this.list.props;return void 0===t?this._items=void 0:null===t?this._items=null:(e=!0===Array.isArray(t)?t:t.items,this._selectedItems=i,this._items=void 0===i?e.map(e=>({selected:!1,item:e,labelId:Object(h.a)()})):void 0===s?e.map(e=>({selected:void 0!==i.find(t=>t===e),item:e,labelId:Object(h.a)()})):e.map(e=>({selected:void 0!==i.find(t=>s(e,t)),item:e,labelId:Object(h.a)()})))}get items(){return this.buildItems(),this._items}updateProps(e){e.selectedItems!==this._selectedItems&&this.buildItems()}onSelect(e,t){e.selected=t;let i=this._items.some(e=>e.selected);this.list.props.item.onSelect(e.item,t,i)}get selectedItems(){return this._items.filter(e=>!0===e.selected).map(e=>e.item)}render(e,t){let{className:i,key:s,render:a,onSelect:o}=this.list.props.item,{labelId:l,selected:c}=e;return r.createElement("li",{key:void 0===s?t:s(e),className:n(i)},r.createElement("div",{className:"d-flex align-items-center px-3"},r.createElement("input",{ref:e=>{e&&(this.input=e,e.checked=c)},className:"",type:"checkbox",value:"",id:l,defaultChecked:c,onChange:t=>{this.onSelect(e,t.target.checked)}}),r.createElement("label",{className:"",style:{flex:1,marginBottom:0},htmlFor:l},this.renderContent(e.item,t))))}}s.b([l.e],m.prototype,"items",null);i(117);i.d(t,"a",function(){return p});let p=class extends r.Component{constructor(e){super(e),this._$scroll=(e=>{console.log("############### items scroll to "+e)});let{item:t}=this.props,{onClick:i,onSelect:s}=t;this.listBase=void 0!==s?new m(this):void 0!==i?new d(this):new u(this)}componentWillUpdate(e,t,i){this.listBase.updateProps(e)}get selectedItems(){return this.listBase.selectedItems}render(){let{className:e,header:t,footer:i,before:s,loading:n,none:o,item:l,selectedItems:c}=this.props;void 0===s&&(s="before"),void 0===n&&(n="loading"),void 0===o&&(o="none");let d,{isPaged:h,items:u,loading:m}=this.listBase;function p(e,t){if(e)switch(typeof e){default:case"string":return r.createElement("li",{className:"va-list-"+t},e);case"function":return r.createElement("li",{className:"va-list-"+t},e());case"object":return r.createElement("li",null,e)}}return d=null===u?p(s,"before"):void 0===u?p(n,"loading"):0===u.length?p(o,"none"):u.map((e,t)=>this.listBase.render(e,t)),r.createElement("ul",{className:a()("va-list",e)},p(t,"header"),d,p(i,"footer"))}};p=s.b([o.a],p)},function(e,t,i){"use strict";var s=i(0),r=i(5);class n{setValues(e){}}class a extends n{render(e){return s.createElement("div",{key:"_b_"+e,className:""},s.createElement("div",{className:"col-sm-12"},s.createElement("div",{style:{borderTop:"1px solid #f0f0f0"}})))}}class o extends n{constructor(e){super(),this.param=e}render(e){let t;switch(this.param){default:t="py-2";break;case"=":t="py-1";break;case"-":t="pb-1"}let i=r(t);return s.createElement("div",{key:"_g_"+e,className:i,style:{backgroundColor:"#f0f0f0"}})}}const l="justify-content-start",c="justify-content-center",d="justify-content-end";class h extends n{constructor(e,t){super(),this.gridProps=e,this.prop=t}render(e){let{onClick:t,bk:i}=this.prop,n=r({"cursor-pointer":void 0!==t,"bg-white":void 0===i,row:!0});return s.createElement("div",{key:e,className:n,onClick:t},this.renderLabel(),this.renderProp())}renderLabel(){let{label:e}=this.prop;return void 0===e?null:s.createElement("label",{className:"col-sm-2 col-form-label"},e)}renderProp(){let e,t,i,{label:n,full:a}=this.prop;switch(this.gridProps.alignValue){case"left":e=l;break;case"center":e=c;break;case"right":e=d}switch(this.prop.vAlign){case"top":t="align-items-start";break;default:case"center":t="align-items-center";break;case"bottom":t="align-items-end";break;case"stretch":t="align-items-stretch"}let o=r(e,t,i=!0!==a?void 0===n?"col-sm-12":"col-sm-10":"w-100","d-flex");return s.createElement("div",{className:o},this.renderPropBody())}renderPropBody(){return s.createElement("div",{className:"form-control-plaintext"},this.renderPropContent())}renderPropContent(){return this.content}}class u extends h{setValues(e){this.content=void 0===e?void 0:e[this.prop.name]}}class m extends h{setValues(e){this.content=void 0===e?void 0:e[this.prop.name]}}class p extends h{setValues(e){if(void 0===e)this.content=void 0;else{let t=this.prop.list;this.content="string"===typeof t?e[t]:void 0}}renderPropBody(){let{list:e,row:t}=this.prop,i="string"===typeof e?this.content:e;return void 0===i?s.createElement("div",null):s.createElement("div",{className:"w-100"},i.map((e,i)=>s.createElement(s.Fragment,{key:i},0===i?null:s.createElement("div",{style:{width:"100%",borderBottom:"1px solid #f0f0f0"}}),s.createElement(t,e))))}}class v extends h{renderPropBody(){let{component:e}=this.prop;return e}}class f{constructor(e,t){this.gridProps=e,this.props=t,this.buildRows()}buildRows(){this.rows=[];let e=!0;for(let t of this.props)if("string"===typeof t)this.rows.push(new o(t)),e=!0;else{let i;switch(e||this.rows.push(new a),t.type){default:continue;case"string":i=new u(this.gridProps,t);break;case"number":i=new m(this.gridProps,t);break;case"list":i=new p(this.gridProps,t);break;case"component":i=new v(this.gridProps,t)}this.rows.push(i),e=!1}}setValues(e){for(let t of this.rows)t.setValues(e)}render(){return this.rows.map((e,t)=>e.render(String(t)))}}var g=i(1),b=i(6);let y=class extends s.Component{render(){let{className:e,rows:t,values:i}=this.props,n=new f(this.props,t);n.setValues(i);let a=r("container-fluid",e);return s.createElement("div",{className:a},n.render())}};y=g.b([b.a],y),i.d(t,"a",function(){return y})},function(e,t,i){"use strict";var s=i(1),r=i(0),n=i(4),a=i(5),o=i.n(a),l=i(18),c=(i(65),i(13));const d={_:{required:"required",number:"not valid number",integer:"not valid integer",min:"min value is ${min}",max:"max value is ${max}"},zh:{_:{required:"\u5fc5\u987b\u586b",number:"\u9700\u8981\u6570\u5b57",integer:"\u9700\u8981\u6574\u6570",min:"\u4e0d\u80fd\u5c0f\u4e8e${min}",max:"\u4e0d\u80fd\u5927\u4e8e${max}"}}};var h=i(33);class u extends r.Component{constructor(e){super(e),this.watch=(()=>{let{formData:e}=this.props;void 0!==e&&this.calcSelectOrDelete()}),this.DefaultContainer=(e=>r.createElement("form",{className:o()(this.props.className)},e)),this.DefaultFieldContainer=((e,t)=>{let{fieldLabelSize:i}=this.props;if(i>0){let s;null===e?i=0:s=r.createElement("label",{className:o()("col-sm-"+i,"col-form-label")},e);let n="col-sm-"+(12-i);return r.createElement("div",{className:"form-group row"},s,r.createElement("div",{className:n},t))}return r.createElement("div",{className:"form-group"},null===e?null:r.createElement("label",{className:"col-form-label"},e),t)}),this.DefaultFieldClass=void 0,this.DefaultButtonClass="text-center py-2",this.DefaultRes=Object(h.a)(d),this.ArrContainer=((e,t)=>r.createElement("div",null,r.createElement("div",{className:o()("small text-muted text-center bg-light py-1 px-3 mt-4 mb-1")},e),t)),this.RowContainer=(e=>{let t=o()({"py-3":!0});return r.createElement("div",{className:t},e)}),this.RowSeperator=r.createElement("div",{className:"border border-gray border-top"});let{schema:t,uiSchema:i,formData:s,Container:a,FieldContainer:l,FieldClass:c,ButtonClass:u,res:m}=e;this.Container=a||this.DefaultContainer,this.FieldContainer=l||this.DefaultFieldContainer,this.FieldClass=void 0!==c&&""!==c&&null!==c?c:this.DefaultFieldClass,this.res=m||this.DefaultRes,this.ButtonClass=u||this.DefaultButtonClass,this.schema=t,this.itemSchemas={};for(let r of this.schema)this.itemSchemas[r.name]=r;this.uiSchema=i,this.disposer=Object(n.d)(this.watch),this.data={}}renderContent(){this.initData(this.props.formData);let e,{children:t}=this.props;return void 0!==t?(this.formContext=new c.b(this,!0),r.createElement(r.Fragment,null,t)):(void 0!==this.uiSchema&&(e=this.uiSchema.Templet),void 0!==e?(this.formContext=new c.b(this,!0),"function"===typeof e?e(this.data):e):(this.formContext=new c.b(this,!1),r.createElement(r.Fragment,null,this.schema.map((e,i)=>r.createElement(r.Fragment,{key:i},Object(l.b)(this.formContext,e,t))))))}initData(e){void 0===e&&(e={});for(let t of this.schema)this.initDataItem(t,this.data,e)}initDataItem(e,t,i){let{name:s,type:r}=e;if("button"===r)return;if("arr"!==r)return void(t[s]=i[s]);let n=e,{arr:a}=n;if(void 0===a)return;let o=n.itemSchemas={};for(let d of a)o[d.name]=d;let l=i[s];void 0===l?l=[]:!1===Array.isArray(l)&&(l=[l]);let c=[];for(let d of l){let{$isSelected:e,$isDeleted:t}=d,i={$source:d,$isSelected:e,$isDeleted:t};for(let s of a)this.initDataItem(s,i,d);c.push(i)}t[s]=c}calcSelectOrDelete(){for(let e of this.schema)this.arrItemOperated(e)}arrItemOperated(e){let{name:t,type:i}=e;if("arr"!==i)return;if(void 0===this.data)return;let s=this.data[t];if(void 0===s)return;let{arr:r}=e;for(let n of s){let{$source:e}=n;if(void 0===e)continue;let{$isSelected:t,$isDeleted:i}=e;n.$isSelected=t,n.$isDeleted=i;for(let s of r)this.arrItemOperated(s)}}componentDidMount(){let{beforeShow:e}=this.props;void 0!==e&&e(this.formContext)}componentWillUnmount(){void 0!==this.disposer&&this.disposer()}render(){let e=this.renderContent();return r.createElement(c.a.Provider,{value:this.formContext},r.createElement(this.formContext.renderErrors,null),this.Container(e))}buttonClick(e){return s.a(this,void 0,void 0,function*(){if(this.formContext.checkRules(),!0===this.formContext.hasError)return;let{onButtonClick:t}=this.formContext.form.props;if(void 0===t)return void alert("you should define form onButtonClick");let i=yield t(e,this.formContext);void 0!==i&&this.formContext.setError(e,i)})}}class m extends r.Component{render(){let{name:e,children:t}=this.props,i=this.context;if(void 0===i)return r.createElement("span",{className:"text-danger"},"!only in Form!");let s=i.getItemSchema(e),n=Object(l.b)(i,s,t,this.props);return void 0===n?r.createElement("span",{className:"text-danger"},"!!",e," is not defined!!"):n}}m.contextType=c.a,i.d(t,"b",function(){return u}),i.d(t,"a",function(){return m})},function(e,t,i){"use strict";var s=i(1),r=i(0),n=i(6),a=i(11),o=i(22),l=i(57);class c extends l.a{constructor(){super(...arguments),this.onChange=(e=>{this.newValue=e.target.value;let t=this.value;this.isChanged=this.newValue!=t}),this.page=Object(n.a)(e=>{let{resolve:t,reject:i}=e,s=r.createElement("button",{className:"btn btn-sm btn-success",disabled:!this.isChanged,onClick:()=>t(this.newValue)},"\u4fdd\u5b58");return r.createElement(o.a,{header:"\u66f4\u6539"+this.label,right:s},r.createElement("div",{className:"m-3"},r.createElement("input",{type:"text",onChange:this.onChange,className:"form-control",defaultValue:this.value}),this.uiItem&&r.createElement("div",{className:"small muted m-2"},this.uiItem.placeholder)))})}internalStart(){return s.a(this,void 0,void 0,function*(){return new Promise((e,t)=>{let i=r.createElement(this.page,{resolve:e,reject:t});a.c.push(i,t)})})}}var d=i(42),h=i(25);let u=class extends r.Component{constructor(e){super(e),this.defaultSepClassName="border-top edit-sep-light-gray",this.defaultRowContainerClassName="d-flex px-3 py-2 cursor-pointer bg-white align-items-center",this.rowClick=((e,t,i,r)=>s.a(this,void 0,void 0,function*(){let s,{onItemChanged:n,onItemClick:a}=this.props;if(void 0!==a)return void(yield a(e,t,r));let o=function(e,t,i,s){let r;if(void 0!==t)switch(t.widget){case"text":r=c;break;case"image":r=d.a}else switch(e.type){case"string":r=c;break;case"image":r=d.a}if(void 0===r)return;return new r(e,t,i,s)}(e,t,i,r);try{(s=yield o.start())!=r&&(void 0===n?alert(`${e.name} value changed, new: ${s}, pre: ${r}`):yield n(e,s,r)),yield o.end()}catch(l){console.log("no value changed")}}));let{topBorderClassName:t,bottomBorderClassName:i,sepClassName:n,rowContainerClassName:a,uiSchema:o}=e;this.topBorder=r.createElement("div",{className:t||this.defaultSepClassName}),this.bottomBorder=r.createElement("div",{className:i||this.defaultSepClassName}),this.rowContainerClassName=a||this.defaultRowContainerClassName,this.sep=r.createElement("div",{className:n||this.defaultSepClassName}),this.uiSchema=o&&o.items||{}}render(){let e=[],{schema:t}=this.props,i=t.length;e.push(this.topBorder);for(let s=0;s<i;s++)s>0&&e.push(this.sep),e.push(this.renderRow(t[s]));return e.push(this.bottomBorder),r.createElement("div",null,e.map((e,t)=>r.createElement(r.Fragment,{key:t},e)))}renderRow(e){let t,{name:i,type:n}=e,a=this.uiSchema[i],o=a&&a.label||i,l=this.props.data[i];switch(n){default:t=l?r.createElement("b",null,l):r.createElement("small",{className:"text-muted"},"(\u65e0)");break;case"image":t=r.createElement(h.a,{className:"w-4c h-4c",src:l})}return r.createElement("div",{className:this.rowContainerClassName,onClick:()=>s.a(this,void 0,void 0,function*(){return yield this.rowClick(e,a,o,l)})},r.createElement("div",{className:"w-6c"},o),r.createElement("div",{className:"flex-fill d-flex justify-content-end"},t),r.createElement("div",{className:"w-2c text-right"},r.createElement("i",{className:"fa fa-chevron-right"})))}};u=s.b([n.a],u),i.d(t,"a",function(){return u})},function(e,t,i){"use strict";var s=i(1),r=i(0),n=i(5),a=i(6);i(123);let o=class extends r.Component{constructor(e){super(e),this.state={pressed:!1}}render(){let e,t,i,s,a,o,{date:l,main:c,vice:d,middle:h,midSize:u,icon:m,unread:p,right:v,onClick:f}=this.props;if(void 0!==p){let e;(e="number"===typeof p?p:p.get())>0?i=r.createElement("b",null,e):e<0&&(i=r.createElement("b",{className:"dot"}))}switch(typeof m){case"object":e=r.createElement("header",null,m,i),t=!1;break;case"string":e=r.createElement("header",{className:"icon"},r.createElement("img",{src:m}),i),t=!0}if(void 0!==h)switch(typeof h){case"string":s=r.createElement("div",{style:{flex:u}},h);break;default:s=h}void 0!==v&&(a="string"===typeof v?r.createElement("footer",null,r.createElement("small",{className:"text-muted"},v)):r.createElement("footer",null,v)),void 0!==d&&(o=r.createElement("span",null,d));let g=n("va-row",{icon:t,pressed:this.state.pressed},{"va-action":void 0!==f});return r.createElement("li",{className:g,onClick:f},e,r.createElement("div",null,r.createElement("div",null,c),o),s,a)}};o=s.b([a.a],o);let l=class extends r.Component{render(){let e,t,{header:i,items:s,beforeLoad:a,none:l,renderRow:c,className:d,footer:h,itemClick:u,converter:m}=this.props,p=n(d,"va-list");return e=void 0===s?null===a?null:r.createElement("li",{className:"empty"},a||"..."):0===s.length?r.createElement("li",{className:"empty"},l||"[none]"):void 0!==c?s.map((e,t)=>c(e,t,this.props.ex)):s.map((e,t)=>{let i,s=e.onClick;if(void 0===s&&void 0!==u&&(s=(()=>u(e))),void 0!==m){if(void 0===(i=m(e)))return null}else i=Object.assign({},e);return void 0===i.key&&(i.key=i.main),r.createElement(o,Object.assign({onClick:s},i))}),void 0!==i&&(t="string"===typeof i?r.createElement("div",{className:"va-list-header"},i):i),r.createElement("div",{className:p},t,r.createElement("ul",null,e),h)}};l=s.b([a.a],l)},function(e,t,i){"use strict";var s=i(1),r=i(0),n=i(4),a=i(6),o=i(5),l=i.n(o);class c{get content(){return!0!==this.selected?this._content:void 0!==this._content?this._content:this._content=this.contentBuilder()}}s.b([n.l],c.prototype,"selected",void 0);const d=(e,t,i)=>r.createElement("div",{className:"d-flex justify-content-center align-items-center flex-column cursor-pointer "+i},r.createElement("div",null,r.createElement("i",{className:"fa fa-lg fa-"+t})),r.createElement("small",null,e));let h=class extends r.Component{constructor(e){super(e),this.tabs=[],this.tabClick=(e=>{this.selectedTab.selected=!1,e.selected=!0,this.selectedTab=e});let{size:t,tabs:i,tabBack:s,contentBack:r,sep:n,selected:a}=this.props;switch(t){default:case"md":this.size="3.2rem";break;case"sm":this.size="4rem";break;case"lg":this.size="2.5rem"}this.tabs.push(...i.map(e=>{let t=new c;return t.name=e.name,t.selected=!1,t.caption=e.caption,t.contentBuilder=e.content,t.notify=e.notify,t})),this.tabBack=s||"bg-light",this.contentBack=r,this.sep=n||"border-top border-gray",void 0!==a&&(this.selectedTab=this.tabs.find(e=>e.name===a)),void 0===this.selectedTab&&(this.selectedTab=this.tabs[0]),this.selectedTab.selected=!0}showTab(e){let t=this.tabs.find(t=>t.name===e);void 0!==t&&(void 0!==this.selectedTab&&(this.selectedTab.selected=!1),t.selected=!0,this.selectedTab=t)}render(){return r.createElement("div",{className:"tab"},r.createElement("div",{className:this.contentBack,style:{height:"calc(100% - "+this.size+")"}},this.tabs.map((e,t)=>{let i={display:!0===e.selected?void 0:"none"};return r.createElement("div",{key:t,style:i},e.content)})),r.createElement("div",{className:l()(this.tabBack,this.sep),style:{height:this.size}},this.tabs.map((e,t)=>{let i,{selected:s,caption:n,notify:a}=e;if(void 0!==a){let e=a.get();void 0!==e&&(e>0?i=r.createElement("u",null,e>99?"99+":e):e<0&&(i=r.createElement("u",{className:"dot"})))}return r.createElement("div",{key:t,className:"",onClick:()=>this.tabClick(e)},r.createElement("div",{className:"align-self-center"},i,n(s)))})))}};s.b([n.l],h.prototype,"selectedTab",void 0),s.b([n.l],h.prototype,"tabs",void 0),h=s.b([a.a],h),i.d(t,"a",function(){return d}),i.d(t,"b",function(){return h})},function(e,t,i){"use strict";var s=i(1),r=i(0),n=i(4),a=i(16),o=i(61);s.b([n.l],class extends r.Component{constructor(e){super(e),this.schema=[{name:"nick",type:"string"},{name:"icon",type:"image"}],this.uiSchema={items:{nick:{widget:"text",label:"\u522b\u540d",placeholder:"\u597d\u7684\u522b\u540d\u66f4\u65b9\u4fbf\u8bb0\u5fc6"},icon:{widget:"image",label:"\u5934\u50cf"}}},this.onItemChanged=((e,t,i)=>s.a(this,void 0,void 0,function*(){let{name:i}=e;yield o.a.userSetProp(i,t),this.data[i]=t,a.nav.user[i]=t,a.nav.saveLocalUser()}));let{nick:t,icon:i}=a.nav.user;this.data={nick:t,icon:i}}render(){return r.createElement(a.Page,{header:"\u4e2a\u4eba\u4fe1\u606f"},r.createElement(a.Edit,{schema:this.schema,uiSchema:this.uiSchema,data:this.data,onItemChanged:this.onItemChanged}))}}.prototype,"data",void 0)},function(e,t,i){"use strict";i.d(t,"a",function(){return a});var s=i(1),r=i(0),n=i(14);class a extends r.Component{constructor(){super(...arguments),this.reApi=(()=>s.a(this,void 0,void 0,function*(){this.props.clearError();const{channel:e,url:t,options:i,resolve:s,reject:r}=this.props;yield Object(n.n)(e,t,i,s,r)})),this.close=(()=>s.a(this,void 0,void 0,function*(){this.props.clearError()}))}render(){let e,{error:t,url:i}=this.props;if("object"===typeof t){let i=[];for(let e in t)i.push(r.createElement("li",{key:e},r.createElement("label",null,e),r.createElement("div",null,t[e])));e=r.createElement("ul",null,i)}else e=r.createElement("div",null,t);return r.createElement("li",null,r.createElement("article",{className:"page-container"},r.createElement("section",null,r.createElement("div",{className:"va-error"},r.createElement("div",null,"\u7f51\u7edc\u51fa\u73b0\u95ee\u9898"),r.createElement("div",null,"\u70b9\u51fb\u91cd\u65b0\u8bbf\u95ee"),r.createElement("div",null,"url: ",i),e,r.createElement("div",{className:"p-3"},r.createElement("button",{type:"button",onClick:this.reApi},"\u91cd\u65b0API"),r.createElement("button",{type:"button",onClick:this.close},"\u5173\u95ed"))))))}}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});class s{constructor(e){this.name=e}get(){if(void 0!==this.value)return this.value;let e=localStorage.getItem(this.name);return this.value=null===e?void 0:JSON.parse(e)}set(e){e?(this.value=e,localStorage.setItem(this.name,JSON.stringify(e))):this.clear()}clear(){this.value=void 0,localStorage.removeItem(this.name)}}class r{constructor(){this.user=new s("user"),this.guest=new s("guest"),this.unit=new s("unit"),this.homeTabCur=new s("homeTabCur")}logoutClear(){[this.user,this.unit,this.homeTabCur].map(e=>e.clear())}}},,,function(e,t,i){e.exports=i.p+"static/media/logo.5d5d9eef.svg"},,function(e,t,i){},function(e,t,i){e.exports=i.p+"static/media/logo.5d5d9eef.svg"},function(e,t,i){e.exports=i(131)},,,,,,,function(e,t,i){},,,,,,,function(e,t,i){},,function(e,t,i){},,function(e,t,i){},,function(e,t,i){},,function(e,t,i){},,function(e,t,i){},,,,,,function(e,t,i){},,function(e,t,i){"use strict";i.r(t);var s=i(0),r=i.n(s),n=i(32),a=(i(104),i(1)),o=(i(106),i(2)),l=i(7),c=i(94),d=i.n(c);const h=()=>{let e=d()({loader:()=>i.e(3).then(i.bind(null,135)),loading:o.Loading});return s.createElement(e,null)},u=e=>!0===e?"text-primary":"text-muted";var m=i(3),p=i(95),v=i.n(p);class f extends o.View{render(){s.createElement(m.FA,{name:"globe"}),s.createElement("div",null,"\u767b\u5f55");let e=s.createElement("img",{className:"m-1",src:v.a,alt:"logo",style:{height:"3rem",width:"3rem"}});return s.createElement(m.LMR,{className:"mb-3 align-items-center bg-white",left:e,right:void 0},s.createElement("div",{className:""},this.controller.renderSearchHeader("md")))}}class g extends o.View{constructor(){super(...arguments),this.onSearch=(e=>a.a(this,void 0,void 0,function*(){}))}render(e){return s.createElement(m.SearchBox,{className:"px-1 w-100",size:e,onSearch:this.onSearch,placeholder:"\u529f\u80fd..."})}}var b=i(6);const y=5;class w extends o.View{constructor(){super(...arguments),this.renderSection=((e,t)=>s.createElement("section",null,s.createElement("h4",null,e.title,s.createElement("small",{className:"text-muted"},e.subtitle)),s.createElement("p",null,e.content))),this.page=Object(b.a)(()=>{let{openMetaView:e}=this.controller,t=s.createElement(s.Fragment,null);return this.controller.isLogined&&this.controller.user.id===y&&(t=s.createElement("button",{type:"button",className:"btn w-100",onClick:e},"view")),s.createElement(o.Page,{header:!1,footer:t},s.createElement(this.content,null))}),this.content=Object(b.a)(()=>{let e=this.controller.renderSiteHeader();return s.createElement(s.Fragment,null,e,this.controller.renderCategoryRootList())})}open(e){return a.a(this,void 0,void 0,function*(){this.openPage(this.page)})}render(e){return s.createElement(this.content,null)}}class E extends o.Controller{constructor(e,t){super(t),this.renderSiteHeader=(()=>this.renderView(f)),this.renderSearchHeader=(e=>this.renderView(g,e)),this.renderCategoryRootList=(()=>{let{cFunctionCategory:e}=this.cApp;return e.renderRootList()}),this.renderHome=(()=>this.renderView(w)),this.openMetaView=(()=>{this.cApp.startDebug()}),this.tab=(()=>s.createElement(this.renderHome,null)),this.cApp=e}internalStart(e){return a.a(this,void 0,void 0,function*(){let{cFunctionCategory:e}=this.cApp;yield e.start(),this.openVPage(w)})}}var C=i(4);const x={overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},k={fontSize:"0.75rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"};class N extends o.View{constructor(){super(...arguments),this.categoryClick=((e,t)=>a.a(this,void 0,void 0,function*(){yield this.controller.openMainPage(e,t)})),this.renderRootCategory=((e,t)=>{let{name:i,children:r}=e;return s.createElement("div",{className:"bg-white mb-3",key:i},s.createElement("div",{className:"py-2 px-3"},s.createElement("b",null,i)),s.createElement("div",{className:"",style:{paddingRight:"1px"}},s.createElement("div",{className:"row no-gutters"},void 0===r?"":r.map(t=>this.renderSubCategory(t,e)))))}),this.renderSubCategory=((e,t)=>{let{name:i,children:r}=e;return s.createElement("div",{key:i,className:"col-6 col-md-4 col-lg-3 cursor-pointer",onClick:()=>this.categoryClick(e,t)},s.createElement("div",{className:"py-2 px-2",style:{border:"1px solid #eeeeee",marginRight:"-1px",marginBottom:"-1px"}},s.createElement("div",{style:x},s.createElement("span",{className:"ml-1 align-middle"},s.createElement(m.FA,{name:"chevron-circle-right",className:"text-info"}),"\xa0 ",i)),void 0===r?"":function(e){return s.createElement("div",{className:"py-1 px-1 text-muted small",style:k},0===e.length?s.createElement(s.Fragment,null,"\xa0"):e.map(e=>e.name).join(" / "))}(r)))})}render(e){let{categories:t}=this.controller;return s.createElement(s.Fragment,null,t.map(e=>this.renderRootCategory(e,void 0)))}}class S extends o.VPage{constructor(){super(...arguments),this.renderChild=(e=>s.createElement("div",{className:"py-2"},s.createElement(m.FA,{name:"hand-o-right mr-2"}),e.name)),this.categoryClick=((e,t)=>a.a(this,void 0,void 0,function*(){yield this.controller.openMainPage(e,t)})),this.renderRootCategory=((e,t)=>{let{name:i,children:r}=e;return s.createElement("div",{className:"bg-white mb-3",key:i},s.createElement("div",{className:"py-2 px-3"},s.createElement("b",null,i)),s.createElement("div",{className:"",style:{paddingRight:"1px"}},s.createElement("div",{className:"row no-gutters"},r.map(t=>this.renderSubCategory(t,e)))))}),this.renderSubCategory=((e,t)=>{let{name:i,children:r}=e;return s.createElement("div",{key:i,className:"col-6 col-md-4 col-lg-3 cursor-pointer",onClick:()=>this.categoryClick(e,t)},s.createElement("div",{className:"pt-1 pb-1 px-2",style:{border:"1px solid #eeeeee",marginRight:"-1px",marginBottom:"-1px"}},s.createElement("div",{style:x},s.createElement("span",{className:"ml-1 align-middle"},s.createElement(m.FA,{name:"chevron-right",className:"text-info small"}),"\xa0 ",i))))}),this.page=(e=>{let{cHome:t}=this.controller.cApp,i=t.renderSearchHeader(),{categoryWaper:r,parent:n}=e;return s.createElement(o.Page,{header:i},this.renderRootCategory(r,n))})}open(e){return a.a(this,void 0,void 0,function*(){this.openPage(this.page,e)})}}const F=[{name:"\u57fa\u7840\u4fe1\u606f",id:1,children:[{name:"\u5546\u54c1\u4fe1\u606f",id:101,pid:1,page:"product"},{name:"\u4f9b\u5e94\u5546\u4fe1\u606f",id:102,pid:1,page:"\u4f9b\u5e94\u5546\u4fe1\u606f"},{name:"\u5ba2\u6237\u4fe1\u606f",id:103,pid:1,page:"\u5ba2\u6237\u4fe1\u606f"},{name:"\u90e8\u95e8\u4fe1\u606f",id:104,pid:1,page:"\u90e8\u95e8\u4fe1\u606f"},{name:"\u804c\u5458\u4fe1\u606f",id:105,pid:1,page:"\u804c\u5458\u4fe1\u606f"},{name:"\u7269\u6d41\u4e2d\u5fc3\uff08\u81ea\u5efa\u3001\u59d4\u6258\uff09",id:106,pid:1,page:"\u7269\u6d41\u4e2d\u5fc3"},{name:"\u5e93\u533a\u4fe1\u606f\uff08\u81ea\u5efa\uff09",id:107,pid:1,page:"\u5e93\u533a\u4fe1\u606f"},{name:"\u8d27\u4f4d\u4fe1\u606f\uff08\u81ea\u5efa\uff09",id:108,pid:1,page:"\u8d27\u4f4d\u4fe1\u606f"}]},{name:"\u91c7\u8d2d\u7ba1\u7406",id:2,children:[{name:"\u91c7\u8d2d\u8ba2\u5355",id:201,pid:2,page:"\u91c7\u8d2d\u8ba2\u5355"},{name:"\u91c7\u8d2d\u6536\u8d27\uff08\u81ea\u5efa\uff09",id:202,pid:2,page:"\u91c7\u8d2d\u6536\u8d27"},{name:"\u91c7\u8d2d\u9a8c\u6536\uff08\u81ea\u5efa\uff09",id:203,pid:2},{name:"\u91c7\u8d2d\u5165\u5e93\uff08\u81ea\u5efa\uff09",id:204,pid:2},{name:"\u91c7\u8d2d\u8bb0\u8d26",id:205,pid:2},{name:"\u91c7\u8d2d\u9000\u8d27",id:206,pid:2},{name:"\u91c7\u9000\u51fa\u5e93\uff08\u81ea\u5efa\uff09",id:207,pid:2},{name:"\u91c7\u9000\u590d\u6838\uff08\u81ea\u5efa\uff09",id:208,pid:2},{name:"\u91c7\u9000\u8bb0\u8d26",id:209,pid:2}]},{name:"\u91c7\u8d2d\u7ed3\u7b97\u7ba1\u7406",id:3,children:[{name:"\u91c7\u8d2d\u53d1\u7968",id:301,pid:3},{name:"\u91c7\u8d2d\u7ec4\u7968",id:302,pid:3},{name:"\u91c7\u8d2d\u7ed3\u7b97",id:303,pid:3},{name:"\u91c7\u4ef7\u8c03\u6574",id:304,pid:3},{name:"\u91c7\u8d2d\u51b2\u5dee",id:305,pid:3}]},{name:"\u9500\u552e\u7ba1\u7406",id:4,children:[{name:"\u9500\u552e\u8ba2\u5355",id:401,pid:4,page:"\u9500\u552e\u8ba2\u5355"},{name:"\u9500\u552e\u51fa\u5e93\uff08\u81ea\u5efa\uff09",id:402,pid:4},{name:"\u51fa\u5e93\u590d\u6838\uff08\u81ea\u5efa\uff09",id:403,pid:4},{name:"\u9500\u552e\u8bb0\u8d26\uff08\u81ea\u5efa\u3001\u59d4\u6258\uff09",id:404,pid:4},{name:"\u9500\u552e\u9000\u8d27",id:405,pid:4},{name:"\u9500\u552e\u9000\u8d27\u9a8c\u6536\uff08\u81ea\u5efa\uff09",id:406,pid:4},{name:"\u9500\u552e\u9000\u8d27\u5165\u5e93\uff08\u81ea\u5efa\uff09",id:407,pid:4},{name:"\u9500\u552e\u9000\u8d27\u8bb0\u8d26\uff08\u81ea\u5efa\u3001\u59d4\u6258\uff09",id:408,pid:4}]},{name:"\u9500\u552e\u7ed3\u7b97\u7ba1\u7406",id:5,children:[{name:"\u9500\u552e\u6362\u7968",id:501,pid:5},{name:"\u9500\u552e\u7ed3\u7b97",id:502,pid:5},{name:"\u9500\u4ef7\u8c03\u6574",id:503,pid:5},{name:"\u9500\u552e\u51b2\u5dee",id:504,pid:5}]},{name:"\u671f\u521d\u7ba1\u7406",id:6,children:[{name:"\u5546\u54c1\u5e93\u5b58\u671f\u521d",id:601,pid:6},{name:"\u4f9b\u5e94\u5546\u671f\u521d",id:602,pid:6},{name:"\u5ba2\u5546\u671f\u521d",id:603,pid:6}]},{name:"\u4ef7\u683c\u7ba1\u7406",id:7,children:[{name:"\u5546\u54c1\u5b9a\u4ef7",id:701,pid:7},{name:"\u5ba2\u5546\u5b9a\u4ef7",id:702,pid:7}]},{name:"\u67e5\u8be2\u62a5\u8868",id:8,children:[{name:"\u5e93\u5b58\u76f8\u5173",id:801,pid:8,children:[{name:"\u5e93\u5b58\u67e5\u8be2",id:80101,pid:801},{name:"\u8fdb\u9500\u5b58\u67e5\u8be2",id:80102,pid:801}]},{name:"\u9500\u552e\u76f8\u5173",id:802,pid:8,children:[{name:"\u5ba2\u5546\u9500\u552e\u6c47\u603b\u67e5\u8be2",id:80201,pid:802},{name:"\u5ba2\u5546\u9500\u552e\u660e\u7ec6\u67e5\u8be2",id:80202,pid:802}]},{name:"\u91c7\u8d2d\u76f8\u5173",id:803,pid:8,children:[]},{name:"\u5e94\u6536\u5e94\u4ed8\u76f8\u5173",id:804,pid:8,children:[{name:"\u5ba2\u5546\u5e94\u6536\u8d26\u6b3e\u6c47\u603b\u67e5\u8be2",id:80401,pid:804},{name:"\u5ba2\u5546\u5e94\u6536\u8d26\u6b3e\u660e\u7ec6\u67e5\u8be2",id:80402,pid:804},{name:"\u4f9b\u5e94\u5546\u5e94\u4ed8\u8d26\u6b3e\u6c47\u603b\u67e5\u8be2",id:80403,pid:804},{name:"\u4f9b\u5e94\u5546\u5e94\u4ed8\u8d26\u6b3e\u660e\u7ec6\u67e5\u8be2",id:80404,pid:804}]}]},{name:"\u6d4b\u8bd5",id:9,children:[{name:"\u5168\u90e8\u6d4b\u8bd5",id:901,pid:9,page:"testAllTab"}]}];var P=i(58);class T extends o.VPage{constructor(){super(...arguments),this.appPage=(()=>{let e,{cUqArr:t}=this.controller;return e=0===t.length?r.a.createElement("div",{className:"p-3 text-info"},r.a.createElement(m.FA,{name:"minus-circle",className:"text-danger",size:"lg"})," \xa0 \u6b64APP\u6ca1\u6709\u7ed1\u5b9a\u4efb\u4f55\u7684USQ"):t.map((e,t)=>r.a.createElement("div",{key:t},e.render())),r.a.createElement(o.Page,{header:"\u5168\u90e8\u529f\u80fd",logout:()=>a.a(this,void 0,void 0,function*(){o.appInFrame.unit=void 0})},r.a.createElement("div",{className:"p-3"},"-------"),e)})}open(e){return a.a(this,void 0,void 0,function*(){this.openPage(this.appPage)})}}const V=["product","packtype","\u4f9b\u5e94\u5546\u4fe1\u606f","\u5ba2\u6237\u4fe1\u606f","\u90e8\u95e8\u4fe1\u606f","\u804c\u5458\u4fe1\u606f","\u5e93\u533a\u4fe1\u606f","\u8d27\u4f4d\u4fe1\u606f","\u7269\u6d41\u4e2d\u5fc3","\u751f\u4ea7\u5382\u5546"],I=["\u91c7\u8d2d\u8ba2\u5355","\u91c7\u8d2d\u6536\u8d27","\u9500\u552e\u8ba2\u5355"];class L extends o.VPage{open(e){return a.a(this,void 0,void 0,function*(){if(void 0!==e){let t=this.controller.getCUq(P.a.uqBasedata),i=t.tuid(e);void 0!==i&&(yield t.cTuidMain(i).start())}})}}class A extends o.VPage{open(e){return a.a(this,void 0,void 0,function*(){if(void 0!==e){let t=this.controller.getCUq(P.a.uqBasedata),i=t.tuid(e);void 0!==i&&(yield t.cTuidEdit(i).start())}})}}class q extends o.VPage{open(e){return a.a(this,void 0,void 0,function*(){if(void 0!==e){let t=this.controller.getCUq(P.a.uqBasedata),i=t.sheet(e);void 0!==i&&(yield t.cSheet(i).start())}})}}const R=(e,t,i)=>a.a(void 0,void 0,void 0,function*(){yield new t(e).open(i)}),M=(e,t)=>{V.includes(e)?R(t,L,e):I.includes(e)?R(t,q,e):"testAllTab"===e&&R(t,T,"testAllTab")},O=(e,t)=>{V.includes(e)&&R(t,A,e)};class D extends o.Controller{constructor(e,t){super(t),this.categories=[],this.renderRootList=(()=>this.renderView(N)),this.cApp=e}internalStart(e){return a.a(this,void 0,void 0,function*(){this.categories=F})}openMainPage(e,t){return a.a(this,void 0,void 0,function*(){if(void 0===e)return;let{children:i,page:s,name:r}=e;void 0===i||0==i.length?void 0!==s&&M(s,this.cApp):this.openVPage(S,{categoryWaper:e,parent:t})})}}a.b([C.l],D.prototype,"categories",void 0);var U=i(134),B=i(10);class j extends l.VTuidMain{constructor(){super(...arguments),this.onPackType=(()=>a.a(this,void 0,void 0,function*(){M("packtype",this.controller.cUq.cApp)}))}get view(){let{label:e,proxyLinks:t}=this.controller;return()=>s.createElement(o.Page,{header:e},void 0===t?s.createElement(s.Fragment,null,s.createElement(m.SearchBox,{className:"w-100",onSearch:this.onSearch,placeholder:"\u641c\u7d22"+e}),s.createElement("div",{className:"my-3"},s.createElement(U.a,{className:"ml-3",color:"primary",onClick:this.onNew},"\u65b0\u589e"),s.createElement(U.a,{className:"ml-3",color:"primary",onClick:this.onList},"\u5217\u8868"))):s.createElement(m.List,{className:"my-2",header:s.createElement(m.Muted,null,e," \u4ee3\u7406\u4e0b\u5217Tuid"),items:t,item:{render:this.entityRender,onClick:this.entityClick}}))}}const _=[{name:"id",type:"id",required:!1},{name:"\u540d\u79f0",type:"string",required:!0,maxLength:100},{name:"\u7f16\u7801",type:"string",required:!1,maxLength:100},{name:"\u67e5\u8be2\u7801",type:"string",required:!1,maxLength:100},{name:"\u901a\u7528\u540d\u79f0",type:"string",maxLength:100},{name:"\u751f\u4ea7\u5382\u5546",type:"id",required:!1,maxLength:100},{name:"\u5546\u54c1\u5206\u7c7b",type:"string",required:!1,maxLength:100},{name:"\u751f\u4ea7\u65e5\u671f",type:"date",required:!1},{name:"\u6709\u6548\u671f",type:"date",required:!1},{name:"submit",type:"submit"}],H=[{name:"product",type:"id",required:!1},{name:"\u56fe\u7247",type:"string",required:!0,maxLength:200},{name:"\u5546\u54c1\u6761\u5f62\u7801",type:"string",required:!0,maxLength:100},{name:"\u89c4\u683c\u578b\u53f7",type:"string",required:!1,maxLength:100},{name:"\u5355\u4f4d",type:"string",required:!1,maxLength:100},{name:"\u8ba1\u91cf\u5355\u4f4d\u7c7b\u578b",type:"string",required:!1,maxLength:100},{name:"\u4e2d\u5305\u88c5",type:"string",maxLength:100},{name:"\u9ed8\u8ba4\u5305\u88c5",type:"string",required:!1,maxLength:100},{name:"\u4ef6\u957f",type:"string",maxLength:100},{name:"\u4ef6\u5bbd",type:"string",required:!1,maxLength:100},{name:"\u4ef6\u9ad8",type:"string",maxLength:100},{name:"\u5806\u7801\u5c42\u6570\u6781\u9650",type:"integer"},{name:"\u5c0f\u5305\u88c5\u957f",type:"string",maxLength:100},{name:"\u5c0f\u5305\u88c5\u5bbd",type:"string",maxLength:100},{name:"\u5c0f\u5305\u88c5\u9ad8",type:"string",maxLength:100},{name:"\u4e0a\u67b6\u62c6\u4e2d\u5305\u88c5",type:"string",maxLength:100},{name:"\u5355\u4f4d\u4f53\u79ef",type:"string",maxLength:100},{name:"submit",type:"submit"}],$=[{name:"product",type:"id",required:!1},{name:"\u96f6\u552e\u4ef7",type:"number",required:!0},{name:"\u6279\u53d1\u4ef7",type:"number",required:!1},{name:"\u7a0e\u7387",type:"number",required:!1},{name:"\u9500\u9879\u7a0e\u7387",type:"number",required:!1},{name:"\u6298\u6263\u5206\u7c7b",type:"number",required:!1},{name:"\u6298\u6263\u7387",type:"number",required:!1},{name:"submit",type:"submit"}];class W extends l.VEntity{constructor(){super(...arguments),this.uiSchema={items:{id:{widget:"id",visible:!1},"\u540d\u79f0":{widget:"text",label:"\u540d\u79f0"},"\u7f16\u7801":{widget:"text"},"\u67e5\u8be2\u7801":{widget:"text"},"\u901a\u7528\u540d\u79f0":{widget:"text"},"\u751f\u4ea7\u5382\u5546":{widget:"id",pickId:(e,t,i)=>a.a(this,void 0,void 0,function*(){return yield this.controller.pickManufactor(e,t,i)})},"\u5546\u54c1\u5206\u7c7b":{widget:"text"},"\u751f\u4ea7\u65e5\u671f":{widget:"date"},"\u6709\u6548\u671f":{widget:"date"},submit:{widget:"button",className:"btn btn-primary",Templet:s.createElement(s.Fragment,null,s.createElement("i",{className:"fa"}),"\xa0\u4e0b\u4e00\u6b65\xa0")}}},this.uiSchema2={items:{product:{widget:"id",visible:!1},"\u5546\u54c1\u6761\u5f62\u7801":{widget:"text"},"\u89c4\u683c\u578b\u53f7":{widget:"text"},"\u5355\u4f4d":{widget:"text"},"\u8ba1\u91cf\u5355\u4f4d\u7c7b\u578b":{widget:"text"},"\u4e2d\u5305\u88c5":{widget:"text"},"\u9ed8\u8ba4\u5305\u88c5":{widget:"text"},"\u4ef6\u957f":{widget:"text"},"\u4ef6\u5bbd":{widget:"text"},"\u4ef6\u9ad8":{widget:"text"},"\u5806\u7801\u5c42\u6570\u6781\u9650":{widget:"updown",min:1,max:100,step:1},"\u5c0f\u5305\u88c5\u957f":{widget:"text"},"\u5c0f\u5305\u88c5\u5bbd":{widget:"text"},"\u5c0f\u5305\u88c5\u9ad8":{widget:"text"},"\u4e0a\u67b6\u62c6\u4e2d\u5305\u88c5":{widget:"text"},"\u5355\u4f4d\u4f53\u79ef":{widget:"text"},submit:{widget:"button",className:"btn btn-primary",Templet:s.createElement(s.Fragment,null,s.createElement("i",{className:"fa"}),"\xa0\u4e0b\u4e00\u6b65\xa0")}}},this.uiSchema3={items:{product:{widget:"id",visible:!1},"\u96f6\u552e\u4ef7":{widget:"text"},"\u6279\u53d1\u4ef7":{widget:"text"},"\u7a0e\u7387":{widget:"text"},"\u9500\u9879\u7a0e\u7387":{widget:"text"},"\u6298\u6263\u5206\u7c7b":{widget:"text"},"\u6298\u6263\u7387":{widget:"text"},submit:{widget:"button",className:"btn btn-primary",Templet:s.createElement(s.Fragment,null,s.createElement("i",{className:"fa"}),"\xa0\u4e0b\u4e00\u6b65\xa0")}}},this.formData={id:void 0},this.formData2={product:void 0},this.formData3={product:void 0},this.onFormButtonNextClick=((e,t)=>a.a(this,void 0,void 0,function*(){"submit"===e&&(this.formData=t.data,this.openPage(this.view2),this.controller.regConfirmClose(()=>a.a(this,void 0,void 0,function*(){return this.formData2=this.form2.data,!0})))})),this.onFormButtonNextClick2=((e,t)=>a.a(this,void 0,void 0,function*(){"submit"===e&&(this.formData2=t.data,this.openPage(this.view3),this.controller.regConfirmClose(()=>a.a(this,void 0,void 0,function*(){return this.formData3=this.form3.data,!0})))})),this.onFormButtonNextClick3=((e,t)=>a.a(this,void 0,void 0,function*(){if("submit"===e){this.formData3=t.data,this.cid=this.formData.id;let e=this.controller.cUq.map("ProductInfo"),i=this.controller.cUq.map("ProductPrice"),r=yield this.controller.entity.save(this.cid,this.formData),{id:n,inId:a}=r;if(a<0&&n<0)return;a>0&&(n=a),this.formData2.product=n,this.formData3.product=n;let l=[];l.push(e.add(this.formData2)),l.push(i.add(this.formData3)),yield Promise.all(l),this.openPageElement(s.createElement(o.Page,{header:this.label+"\u63d0\u4ea4\u6210\u529f",back:"none"},s.createElement("div",{className:"m-3"},s.createElement("span",{className:"text-success"},s.createElement(m.FA,{name:"check-circle",size:"lg"})," \u6210\u529f\u63d0\u4ea4\uff01"),s.createElement("div",{className:"mt-5"},s.createElement("button",{className:"btn btn-primary mr-3",onClick:this.next},"\u7ee7\u7eed\u5f55\u5165"),s.createElement("button",{className:"btn btn-outline-primary",onClick:this.finish},"\u4e0d\u7ee7\u7eed")))))}})),this.next=(()=>a.a(this,void 0,void 0,function*(){this.reset(),this.closePage(4),yield this.open()})),this.finish=(()=>{this.closePage(4)})}loadMap2(){return a.a(this,void 0,void 0,function*(){let e=this.controller.cUq.map("ProductInfo"),t={product:this.cid},i=yield e.query(t);if(void 0!==i){let{ret:e}=i;if(e&&e.length>0){let t=e[0];t.product=this.cid,this.formData2=t}}})}loadMap3(){return a.a(this,void 0,void 0,function*(){let e=this.controller.cUq.map("ProductPrice"),t={product:this.cid},i=yield e.query(t);if(void 0!==i){let{ret:e}=i;if(e&&e.length>0){let t=e[0];t.\u5ba2\u6237=this.cid,this.formData3=t}}})}open(e){return a.a(this,void 0,void 0,function*(){if(void 0!==e){let t=e;t.\u751f\u4ea7\u5382\u5546=e.\u751f\u4ea7\u5382\u5546.id,this.formData=t,this.cid=this.formData.id,this.formData2.product=this.cid,this.formData3.product=this.cid;let i=[];i.push(this.loadMap2()),i.push(this.loadMap3()),yield Promise.all(i)}this.openPage(this.view,e)})}reset(){this.formData={id:void 0},this.formData2={product:void 0},this.formData3={product:void 0}}get view(){let{label:e}=this.controller;return()=>s.createElement(o.Page,{header:e},s.createElement(o.Form,{className:"p-3",schema:_,uiSchema:this.uiSchema,formData:this.formData,fieldLabelSize:2,onButtonClick:this.onFormButtonNextClick}))}get view2(){let{label:e}=this.controller;return()=>s.createElement(o.Page,{header:e},s.createElement(o.Form,{ref:e=>this.form2=e,className:"p-3",schema:H,uiSchema:this.uiSchema2,formData:this.formData2,fieldLabelSize:2,onButtonClick:this.onFormButtonNextClick2}))}get view3(){let{label:e}=this.controller;return()=>s.createElement(o.Page,{header:e},s.createElement(o.Form,{ref:e=>this.form3=e,className:"p-3",schema:$,uiSchema:this.uiSchema3,formData:this.formData3,fieldLabelSize:2,onButtonClick:this.onFormButtonNextClick3}))}}class z extends l.VTuidSelect{constructor(){super(...arguments),this.onNew=(()=>a.a(this,void 0,void 0,function*(){O("\u5546\u54c1\u4fe1\u606f",this.controller.cUq.cApp)})),this.clickRow=(e=>{this.backPage(),this.returnCall(e)}),this.mainView=Object(b.a)(()=>{let e=s.createElement(U.a,{className:"ml-2",color:"primary",onClick:this.onNew},"\u65b0\u589e"),t=s.createElement(m.SearchBox,{className:"mx-1 w-100",initKey:"",onSearch:this.onSearchMain,placeholder:"\u641c\u7d22"+this.label});return s.createElement(o.Page,{header:"\u9009\u62e9\u5546\u54c1",right:e,back:"close"},t,s.createElement(m.List,{items:this.controller.PageItems.items,item:{render:this.renderMainRow,onClick:this.clickRow},before:"\u641c\u7d22"+this.label+"\u8d44\u6599"}))}),this.divView=(e=>{let t=s.createElement(U.a,{className:"ml-2",color:"primary",onClick:this.onNew},"\u65b0\u589e");return s.createElement(o.Page,{header:"\u9009\u62e9\u5546\u54c1",right:t},s.createElement(m.List,{items:e.items,item:{render:this.renderDivRow,onClick:this.clickDivRow}}))})}open(e){return a.a(this,void 0,void 0,function*(){yield this.showM(e)})}showM(e){return a.a(this,void 0,void 0,function*(){this.mainRowContent=this.ui.rowContent||B.c,yield this.controller.searchMain(""),this.openPage(this.mainView)})}}class K extends l.VTuidMainList{}class G extends l.VTuidMain{get view(){let{label:e,proxyLinks:t}=this.controller;return()=>s.createElement(o.Page,{header:e},void 0===t?s.createElement(s.Fragment,null,s.createElement(m.SearchBox,{className:"w-100",onSearch:this.onSearch,placeholder:"\u641c\u7d22"+e}),s.createElement("div",{className:"my-3"},s.createElement(U.a,{className:"ml-3",color:"primary",onClick:this.onNew},"\u65b0\u589e"),s.createElement(U.a,{className:"ml-3",color:"primary",onClick:this.onList},"\u5217\u8868"))):s.createElement(m.List,{className:"my-2",header:s.createElement(m.Muted,null,e," \u4ee3\u7406\u4e0b\u5217Tuid"),items:t,item:{render:this.entityRender,onClick:this.entityClick}}))}}class Q extends l.VTuidSelect{constructor(){super(...arguments),this.onNew=(()=>a.a(this,void 0,void 0,function*(){O("packtype",this.controller.cUq.cApp)})),this.divView=(e=>{let t=s.createElement(U.a,{className:"ml-2",color:"primary",onClick:this.onNew},"\u65b0\u589e");return s.createElement(o.Page,{header:"\u9009\u62e9\u8ba1\u91cf\u5355\u4f4d",right:t},s.createElement(m.List,{items:e.items,item:{render:this.renderDivRow,onClick:this.clickDivRow}}))})}}class J extends l.VTuidMain{get view(){let{label:e,proxyLinks:t}=this.controller;return()=>s.createElement(o.Page,{header:e},void 0===t?s.createElement(s.Fragment,null,s.createElement(m.SearchBox,{className:"w-100",onSearch:this.onSearch,placeholder:"\u641c\u7d22"+e}),s.createElement("div",{className:"my-3"},s.createElement(U.a,{className:"ml-3",color:"primary",onClick:this.onNew},"\u65b0\u589e"),s.createElement(U.a,{className:"ml-3",color:"primary",onClick:this.onList},"\u5217\u8868"))):s.createElement(m.List,{className:"my-2",header:s.createElement(m.Muted,null,e," \u4ee3\u7406\u4e0b\u5217Tuid"),items:t,item:{render:this.entityRender,onClick:this.entityClick}}))}}const Y=[{name:"id",type:"id",required:!1},{name:"\u540d\u79f0",type:"string",required:!0,maxLength:100},{name:"\u7f16\u7801",type:"string",required:!0,maxLength:100},{name:"\u67e5\u8be2\u7801",type:"string",required:!1,maxLength:100},{name:"\u6cd5\u4eba\u4ee3\u8868",type:"string",required:!1,maxLength:100},{name:"\u6536\u8d27\u5730\u5740",type:"string",required:!1,maxLength:100},{name:"\u8c03\u62e8\u7c7b\u578b",type:"string",required:!1,maxLength:100},{name:"\u8fd0\u8f93\u65b9\u5f0f",type:"string",maxLength:100},{name:"\u8054\u7cfb\u4eba",type:"string",maxLength:100},{name:"submit",type:"submit"}],X=[{name:"\u5ba2\u6237",type:"id",required:!1},{name:"\u56fe\u7247",type:"string",required:!0,maxLength:100},{name:"\u4f01\u4e1a\u7c7b\u578b",type:"string",required:!0,maxLength:100},{name:"\u8bb8\u53ef\u8bc1\u53f7",type:"string",required:!1,maxLength:100},{name:"\u53d1\u8bc1\u65e5\u671f",type:"date",required:!1},{name:"\u6709\u6548\u671f\u81f3",type:"date",required:!1},{name:"\u7ecf\u8425\u8303\u56f4",type:"string",required:!1,maxLength:100},{name:"\u8303\u56f4\u663e\u793a",type:"string",maxLength:100},{name:"\u8425\u4e1a\u6267\u7167",type:"string",maxLength:100},{name:"\u8425\u4e1a\u6267\u7167\u53d1\u8bc1\u65e5\u671f",type:"date"},{name:"\u8425\u4e1a\u6267\u7167\u6709\u6548\u671f\u81f3",type:"date"},{name:"\u8425\u4e1a\u6267\u7167\u5e74\u68c0\u8bc1\u660e",type:"string",maxLength:100},{name:"\u7ec4\u7ec7\u673a\u6784\u4ee3\u7801\u8bc1\u53f7",type:"string",maxLength:100},{name:"\u4ee3\u7801\u8bc1\u53d1\u8bc1\u65e5\u671f",type:"date"},{name:"\u4ee3\u7801\u8bc1\u6709\u6548\u671f\u81f3",type:"date"},{name:"\u4ee3\u7801\u8bc1\u5e74\u68c0\u8bc1\u660e",type:"string",maxLength:100},{name:"GMP",type:"string",maxLength:100},{name:"GMP\u53d1\u8bc1\u65e5\u671f",type:"date"},{name:"submit",type:"submit"}],Z=[{name:"\u5ba2\u6237",type:"id",required:!1},{name:"\u7a0e\u53f7",type:"string",required:!0,maxLength:100},{name:"\u5f00\u6237\u884c",type:"string",required:!1,maxLength:100},{name:"\u8d26\u53f7",type:"string",required:!1,maxLength:100},{name:"\u8bb0\u8d26\u65b9\u5f0f",type:"string",required:!1,maxLength:100},{name:"\u6362\u7968\u65b9\u5f0f",type:"string",maxLength:100},{name:"\u6362\u7968\u7c7b\u578b",type:"string",maxLength:100},{name:"submit",type:"submit"}];class ee extends l.VTuidEdit{constructor(){super(...arguments),this.uiSchema={items:{id:{widget:"id",visible:!1},"\u540d\u79f0":{widget:"text"},"\u7f16\u7801":{widget:"text"},"\u67e5\u8be2\u7801":{widget:"text"},"\u6cd5\u4eba\u4ee3\u8868":{widget:"text"},"\u6536\u8d27\u5730\u5740":{widget:"text"},"\u8c03\u62e8\u7c7b\u578b":{widget:"text"},"\u8fd0\u8f93\u65b9\u5f0f":{widget:"text"},"\u8054\u7cfb\u4eba":{widget:"text"},submit:{widget:"button",className:"btn btn-primary",Templet:s.createElement(s.Fragment,null,s.createElement("i",{className:"fa"}),"\xa0\u4e0b\u4e00\u6b65\xa0")}}},this.uiSchema2={items:{"\u5ba2\u6237":{widget:"id",visible:!1},"\u56fe\u7247":{widget:"text"},"\u4f01\u4e1a\u7c7b\u578b":{widget:"text"},"\u8bb8\u53ef\u8bc1\u53f7":{widget:"text"},"\u53d1\u8bc1\u65e5\u671f":{widget:"date"},"\u6709\u6548\u671f\u81f3":{widget:"date"},"\u7ecf\u8425\u8303\u56f4":{widget:"text"},"\u8303\u56f4\u663e\u793a":{widget:"text"},"\u8425\u4e1a\u6267\u7167":{widget:"text"},"\u8425\u4e1a\u6267\u7167\u53d1\u8bc1\u65e5\u671f":{widget:"date",label:"\u53d1\u8bc1\u65e5\u671f"},"\u8425\u4e1a\u6267\u7167\u6709\u6548\u671f\u81f3":{widget:"date",label:"\u6709\u6548\u671f\u81f3"},"\u8425\u4e1a\u6267\u7167\u5e74\u68c0\u8bc1\u660e":{widget:"text"},"\u7ec4\u7ec7\u673a\u6784\u4ee3\u7801\u8bc1\u53f7":{widget:"text"},"\u4ee3\u7801\u8bc1\u53d1\u8bc1\u65e5\u671f":{widget:"date",label:"\u53d1\u8bc1\u65e5\u671f"},"\u4ee3\u7801\u8bc1\u6709\u6548\u671f\u81f3":{widget:"date",label:"\u6709\u6548\u671f\u81f3"},"\u4ee3\u7801\u8bc1\u5e74\u68c0\u8bc1\u660e":{widget:"text"},GMP:{widget:"text"},"GMP\u53d1\u8bc1\u65e5\u671f":{widget:"date",label:"\u53d1\u8bc1\u65e5\u671f"},prev:{widget:"button",className:"btn",Templet:s.createElement(s.Fragment,null,s.createElement("i",{className:"fa"}),"\xa0\u4e0a\u4e00\u6b65\xa0")},submit:{widget:"button",className:"btn btn-primary",Templet:s.createElement(s.Fragment,null,s.createElement("i",{className:"fa"}),"\xa0\u4e0b\u4e00\u6b65\xa0")}}},this.uiSchema3={items:{"\u5ba2\u6237":{widget:"id",visible:!1},"\u7a0e\u53f7":{widget:"text"},"\u5f00\u6237\u884c":{widget:"text"},"\u8d26\u53f7":{widget:"text"},"\u8bb0\u8d26\u65b9\u5f0f":{widget:"text"},"\u6362\u7968\u65b9\u5f0f":{widget:"text"},"\u6362\u7968\u7c7b\u578b":{widget:"text"},prev:{widget:"button",className:"btn",Templet:s.createElement(s.Fragment,null,s.createElement("i",{className:"fa"}),"\xa0\u4e0a\u4e00\u6b65\xa0")},submit:{widget:"button",className:"btn btn-primary",Templet:s.createElement(s.Fragment,null,s.createElement("i",{className:"fa"}),"\xa0\u4e0b\u4e00\u6b65\xa0")}}},this.formData={id:void 0},this.formData2={"\u5ba2\u6237":void 0},this.formData3={"\u5ba2\u6237":void 0},this.onFormButtonNextClick=((e,t)=>a.a(this,void 0,void 0,function*(){"submit"===e&&(this.formData=t.data,this.openPage(this.view2),this.controller.regConfirmClose(()=>a.a(this,void 0,void 0,function*(){return this.formData2=this.form2.data,!0})))})),this.onFormButtonNextClick2=((e,t)=>a.a(this,void 0,void 0,function*(){"submit"===e&&(this.formData2=t.data,this.openPage(this.view3),this.controller.regConfirmClose(()=>a.a(this,void 0,void 0,function*(){return this.formData3=this.form3.data,!0})))})),this.onFormButtonNextClick3=((e,t)=>a.a(this,void 0,void 0,function*(){if("submit"===e){this.formData3=t.data,this.cid=this.formData.id;let e=this.controller.cUq.map("\u5ba2\u6237\u8bc1\u7167\u4fe1\u606f"),i=this.controller.cUq.map("\u5ba2\u6237\u8d22\u52a1\u4fe1\u606f"),r=yield this.controller.entity.save(this.cid,this.formData),{id:n,inId:a}=r;if(a<0&&n<0)return;a>0&&(n=a),this.formData2.\u5ba2\u6237=n,this.formData3.\u5ba2\u6237=n;let l=[];l.push(e.add(this.formData2)),l.push(i.add(this.formData3)),yield Promise.all(l),this.openPageElement(s.createElement(o.Page,{header:this.label+"\u63d0\u4ea4\u6210\u529f",back:"none"},s.createElement("div",{className:"m-3"},s.createElement("span",{className:"text-success"},s.createElement(m.FA,{name:"check-circle",size:"lg"})," \u6210\u529f\u63d0\u4ea4\uff01"),s.createElement("div",{className:"mt-5"},s.createElement("button",{className:"btn btn-primary mr-3",onClick:this.next},"\u7ee7\u7eed\u5f55\u5165"),s.createElement("button",{className:"btn btn-outline-primary",onClick:this.finish},"\u4e0d\u7ee7\u7eed")))))}})),this.next=(()=>a.a(this,void 0,void 0,function*(){this.reset(),this.closePage(4),yield this.open()})),this.finish=(()=>{this.closePage(4)})}loadMap2(){return a.a(this,void 0,void 0,function*(){let e=this.controller.cUq.map("\u5ba2\u6237\u8bc1\u7167\u4fe1\u606f"),t={"\u5ba2\u6237":this.cid},i=yield e.query(t);if(void 0!==i){let{ret:e}=i;if(e&&e.length>0){let t=e[0];t.\u5ba2\u6237=this.cid,this.formData2=t}}})}loadMap3(){return a.a(this,void 0,void 0,function*(){let e=this.controller.cUq.map("\u5ba2\u6237\u8d22\u52a1\u4fe1\u606f"),t={"\u5ba2\u6237":this.cid},i=yield e.query(t);if(void 0!==i){let{ret:e}=i;if(e&&e.length>0){let t=e[0];t.\u5ba2\u6237=this.cid,this.formData3=t}}})}open(e){return a.a(this,void 0,void 0,function*(){if(void 0!==e){this.formData=e,this.cid=this.formData.id,this.formData2.\u5ba2\u6237=this.cid,this.formData3.\u5ba2\u6237=this.cid;let t=[];t.push(this.loadMap2()),t.push(this.loadMap3()),yield Promise.all(t)}this.openPage(this.view,e)})}reset(){this.formData={id:void 0},this.formData2={"\u5ba2\u6237":void 0},this.formData3={"\u5ba2\u6237":void 0}}get view(){let{label:e}=this.controller;return()=>s.createElement(o.Page,{header:e},s.createElement(o.Form,{className:"p-3",schema:Y,uiSchema:this.uiSchema,formData:this.formData,fieldLabelSize:2,onButtonClick:this.onFormButtonNextClick}))}get view2(){let{label:e}=this.controller;return()=>s.createElement(o.Page,{header:e},s.createElement(o.Form,{ref:e=>this.form2=e,className:"p-3",schema:X,uiSchema:this.uiSchema2,formData:this.formData2,fieldLabelSize:2,onButtonClick:this.onFormButtonNextClick2}))}get view3(){let{label:e}=this.controller;return()=>s.createElement(o.Page,{header:e},s.createElement(o.Form,{ref:e=>this.form3=e,className:"p-3",schema:Z,uiSchema:this.uiSchema3,formData:this.formData3,fieldLabelSize:2,onButtonClick:this.onFormButtonNextClick3}))}}class te extends l.VTuidSelect{constructor(){super(...arguments),this.onNew=(()=>a.a(this,void 0,void 0,function*(){O("\u5ba2\u6237\u4fe1\u606f",this.controller.cUq.cApp)})),this.clickRow=(e=>{this.backPage(),this.returnCall(e)}),this.mainView=Object(b.a)(()=>{let e=s.createElement(U.a,{className:"ml-2",color:"primary",onClick:this.onNew},"\u65b0\u589e"),t=s.createElement(m.SearchBox,{className:"mx-1 w-100",initKey:"",onSearch:this.onSearchMain,placeholder:"\u641c\u7d22"+this.label});return s.createElement(o.Page,{header:"\u9009\u62e9\u5ba2\u6237",right:e,back:"close"},t,s.createElement(m.List,{items:this.controller.PageItems.items,item:{render:this.renderMainRow,onClick:this.clickRow},before:"\u641c\u7d22"+this.label+"\u8d44\u6599"}))}),this.divView=(e=>{let t=s.createElement(U.a,{className:"ml-2",color:"primary",onClick:this.onNew},"\u65b0\u589e");return s.createElement(o.Page,{header:"\u9009\u62e9\u5ba2\u6237",right:t},s.createElement(m.List,{items:e.items,item:{render:this.renderDivRow,onClick:this.clickDivRow}}))})}open(e){return a.a(this,void 0,void 0,function*(){yield this.showM(e)})}showM(e){return a.a(this,void 0,void 0,function*(){this.mainRowContent=this.ui.rowContent||B.c,yield this.controller.searchMain(""),this.openPage(this.mainView)})}}class ie extends l.VTuidMainList{}class se extends l.VTuidMain{get view(){let{label:e,proxyLinks:t}=this.controller;return()=>s.createElement(o.Page,{header:e},void 0===t?s.createElement(s.Fragment,null,s.createElement(m.SearchBox,{className:"w-100",onSearch:this.onSearch,placeholder:"\u641c\u7d22"+e}),s.createElement("div",{className:"my-3"},s.createElement(U.a,{className:"ml-3",color:"primary",onClick:this.onNew},"\u65b0\u589e"),s.createElement(U.a,{className:"ml-3",color:"primary",onClick:this.onList},"\u5217\u8868"))):s.createElement(m.List,{className:"my-2",header:s.createElement(m.Muted,null,e," \u4ee3\u7406\u4e0b\u5217Tuid"),items:t,item:{render:this.entityRender,onClick:this.entityClick}}))}}const re=[{name:"id",type:"id",required:!1},{name:"\u540d\u79f0",type:"string",required:!0,maxLength:100},{name:"\u7f16\u7801",type:"string",required:!0,maxLength:100},{name:"\u67e5\u8be2\u7801",type:"string",required:!1,maxLength:100},{name:"\u6cd5\u4eba\u4ee3\u8868",type:"string",required:!1,maxLength:100},{name:"\u6ce8\u518c\u5730\u5740",type:"string",required:!1,maxLength:100},{name:"\u9000\u8d27\u5730\u5740",type:"string",required:!1,maxLength:100},{name:"\u4f01\u4e1a\u6027\u8d28",type:"string",maxLength:100},{name:"\u8054\u7cfb\u4eba",type:"string",maxLength:100},{name:"submit",type:"submit"}],ne=[{name:"\u4f9b\u5e94\u5546",type:"id",required:!1},{name:"\u56fe\u7247",type:"string",required:!0,maxLength:100},{name:"\u4f01\u4e1a\u7c7b\u578b",type:"string",required:!0,maxLength:100},{name:"\u8bb8\u53ef\u8bc1\u53f7",type:"string",required:!1,maxLength:100},{name:"\u8bb8\u53ef\u8bc1\u53d1\u8bc1\u65e5\u671f",type:"date",required:!1},{name:"\u8bb8\u53ef\u8bc1\u6709\u6548\u671f\u81f3",type:"date",required:!1},{name:"\u7ecf\u8425\u8303\u56f4",type:"string",required:!1,maxLength:100},{name:"\u8303\u56f4\u663e\u793a",type:"string",maxLength:100},{name:"\u8425\u4e1a\u6267\u7167\u53f7",type:"string",maxLength:100},{name:"\u8425\u4e1a\u6267\u7167\u53d1\u8bc1\u65e5\u671f",type:"date"},{name:"\u8425\u4e1a\u6267\u7167\u6709\u6548\u671f\u81f3",type:"date"},{name:"\u8425\u4e1a\u6267\u7167\u5e74\u68c0\u8bc1\u660e",type:"string",maxLength:100},{name:"\u7ec4\u7ec7\u673a\u6784\u4ee3\u7801\u8bc1\u53f7",type:"string",maxLength:100},{name:"\u7ec4\u7ec7\u4ee3\u7801\u53d1\u8bc1\u65e5\u671f",type:"date"},{name:"\u7ec4\u7ec7\u4ee3\u7801\u6709\u6548\u671f\u81f3",type:"date"},{name:"\u7ec4\u7ec7\u4ee3\u7801\u5e74\u68c0\u8bc1\u660e",type:"string",maxLength:100},{name:"\u7a0e\u52a1\u767b\u8bb0\u8bc1\u53f7",type:"string",maxLength:100},{name:"\u7a0e\u52a1\u767b\u8bb0\u8bc1\u53d1\u8bc1\u65e5\u671f",type:"date"},{name:"submit",type:"submit"}],ae=[{name:"\u4f9b\u5e94\u5546",type:"id",required:!1},{name:"\u8ba4\u8bc1",type:"string",required:!0,maxLength:100},{name:"\u8bc1\u4e66\u53f7",type:"string",required:!1,maxLength:100},{name:"\u53d1\u8bc1\u65e5\u671f",type:"date"},{name:"\u8bc1\u4e66\u6709\u6548\u671f\u542f",type:"date"},{name:"\u8bc1\u4e66\u6709\u6548\u671f\u81f3",type:"date"},{name:"\u8ba4\u8bc1\u8303\u56f4",type:"string",maxLength:100},{name:"submit",type:"submit"}];class oe extends l.VTuidEdit{constructor(){super(...arguments),this.uiSchema={items:{id:{widget:"id",visible:!1},"\u540d\u79f0":{widget:"text"},"\u7f16\u7801":{widget:"text"},"\u67e5\u8be2\u7801":{widget:"text"},"\u6cd5\u4eba\u4ee3\u8868":{widget:"text"},"\u6ce8\u518c\u5730\u5740":{widget:"text"},"\u9000\u8d27\u5730\u5740":{widget:"text"},"\u4f01\u4e1a\u6027\u8d28":{widget:"text"},"\u8054\u7cfb\u4eba":{widget:"text"},submit:{widget:"button",className:"btn btn-primary",Templet:s.createElement(s.Fragment,null,s.createElement("i",{className:"fa"}),"\xa0\u4e0b\u4e00\u6b65\xa0")}}},this.uiSchema2={items:{"\u4f9b\u5e94\u5546":{widget:"id",visible:!1},"\u56fe\u7247":{widget:"text"},"\u4f01\u4e1a\u7c7b\u578b":{widget:"text"},"\u8bb8\u53ef\u8bc1\u53f7":{widget:"text"},"\u8bb8\u53ef\u8bc1\u53d1\u8bc1\u65e5\u671f":{widget:"date",label:"\u53d1\u8bc1\u65e5\u671f"},"\u8bb8\u53ef\u8bc1\u6709\u6548\u671f\u81f3":{widget:"date",label:"\u6709\u6548\u671f\u81f3"},"\u7ecf\u8425\u8303\u56f4":{widget:"text"},"\u8303\u56f4\u663e\u793a":{widget:"text"},"\u8425\u4e1a\u6267\u7167\u53f7":{widget:"text"},"\u8425\u4e1a\u6267\u7167\u53d1\u8bc1\u65e5\u671f":{widget:"date",label:"\u53d1\u8bc1\u65e5\u671f"},"\u8425\u4e1a\u6267\u7167\u6709\u6548\u671f\u81f3":{widget:"date",label:"\u6709\u6548\u671f\u81f3"},"\u8425\u4e1a\u6267\u7167\u5e74\u68c0\u8bc1\u660e":{widget:"text"},"\u7ec4\u7ec7\u673a\u6784\u4ee3\u7801\u8bc1\u53f7":{widget:"text"},"\u7ec4\u7ec7\u4ee3\u7801\u53d1\u8bc1\u65e5\u671f":{widget:"date",label:"\u53d1\u8bc1\u65e5\u671f"},"\u7ec4\u7ec7\u4ee3\u7801\u6709\u6548\u671f\u81f3":{widget:"date",label:"\u6709\u6548\u671f\u81f3"},"\u7ec4\u7ec7\u4ee3\u7801\u5e74\u68c0\u8bc1\u660e":{widget:"text"},"\u7a0e\u52a1\u767b\u8bb0\u8bc1\u53f7":{widget:"text"},"\u7a0e\u52a1\u767b\u8bb0\u8bc1\u53d1\u8bc1\u65e5\u671f":{widget:"date",label:"\u53d1\u8bc1\u65e5\u671f"},submit:{widget:"button",className:"btn btn-primary",Templet:s.createElement(s.Fragment,null,s.createElement("i",{className:"fa"}),"\xa0\u4e0b\u4e00\u6b65\xa0")}}},this.uiSchema3={items:{"\u4f9b\u5e94\u5546":{widget:"id",visible:!1},"\u8ba4\u8bc1":{widget:"text"},"\u8bc1\u4e66\u53f7":{widget:"text"},"\u53d1\u8bc1\u65e5\u671f":{widget:"date",label:"\u53d1\u8bc1\u65e5\u671f"},"\u8bc1\u4e66\u6709\u6548\u671f\u542f":{widget:"date",label:"\u6709\u6548\u671f\u542f"},"\u8bc1\u4e66\u6709\u6548\u671f\u81f3":{widget:"date",label:"\u6709\u6548\u671f\u81f3"},"\u8ba4\u8bc1\u8303\u56f4":{widget:"text"},submit:{widget:"button",className:"btn btn-primary",Templet:s.createElement(s.Fragment,null,s.createElement("i",{className:"fa"}),"\xa0\u4e0b\u4e00\u6b65\xa0")}}},this.formData={id:void 0},this.formData2={"\u4f9b\u5e94\u5546":void 0},this.formData3={"\u4f9b\u5e94\u5546":void 0},this.onFormButtonNextClick=((e,t)=>a.a(this,void 0,void 0,function*(){"submit"===e&&(this.formData=t.data,this.openPage(this.view2),this.controller.regConfirmClose(()=>a.a(this,void 0,void 0,function*(){return this.formData2=this.form2.data,!0})))})),this.onFormButtonNextClick2=((e,t)=>a.a(this,void 0,void 0,function*(){"submit"===e&&(this.formData2=t.data,this.openPage(this.view3),this.controller.regConfirmClose(()=>a.a(this,void 0,void 0,function*(){return this.formData3=this.form3.data,!0})))})),this.onFormButtonNextClick3=((e,t)=>a.a(this,void 0,void 0,function*(){if("submit"===e){this.formData3=t.data,this.cid=this.formData.id;let e=this.controller.cUq.map("\u4f9b\u5e94\u5546\u8bc1\u7167\u4fe1\u606f"),i=this.controller.cUq.map("\u4f9b\u5e94\u5546\u8ba4\u8bc1\u4fe1\u606f"),r=yield this.controller.entity.save(this.cid,this.formData),{id:n,inId:a}=r;if(a<0&&n<0)return;a>0&&(n=a),this.formData2.\u4f9b\u5e94\u5546=n,this.formData3.\u4f9b\u5e94\u5546=n;let l=[];l.push(e.add(this.formData2)),l.push(i.add(this.formData3)),yield Promise.all(l),this.openPageElement(s.createElement(o.Page,{header:this.label+"\u63d0\u4ea4\u6210\u529f",back:"none"},s.createElement("div",{className:"m-3"},s.createElement("span",{className:"text-success"},s.createElement(m.FA,{name:"check-circle",size:"lg"})," \u6210\u529f\u63d0\u4ea4\uff01"),s.createElement("div",{className:"mt-5"},s.createElement("button",{className:"btn btn-primary mr-3",onClick:this.next},"\u7ee7\u7eed\u5f55\u5165"),s.createElement("button",{className:"btn btn-outline-primary",onClick:this.finish},"\u4e0d\u7ee7\u7eed")))))}})),this.next=(()=>a.a(this,void 0,void 0,function*(){this.reset(),this.closePage(4),yield this.open()})),this.finish=(()=>{this.closePage(4)})}loadMap2(){return a.a(this,void 0,void 0,function*(){let e=this.controller.cUq.map("\u4f9b\u5e94\u5546\u8bc1\u7167\u4fe1\u606f"),t={"\u4f9b\u5e94\u5546":this.cid},i=yield e.query(t);if(void 0!==i){let{ret:e}=i;if(e&&e.length>0){let t=e[0];t.\u4f9b\u5e94\u5546=this.cid,this.formData2=t}}})}loadMap3(){return a.a(this,void 0,void 0,function*(){let e=this.controller.cUq.map("\u4f9b\u5e94\u5546\u8ba4\u8bc1\u4fe1\u606f"),t={"\u4f9b\u5e94\u5546":this.cid},i=yield e.query(t);if(void 0!==i){let{ret:e}=i;if(e&&e.length>0){let t=e[0];t.\u4f9b\u5e94\u5546=this.cid,this.formData3=t}}})}open(e){return a.a(this,void 0,void 0,function*(){if(void 0!==e){this.formData=e,this.cid=this.formData.id,this.formData2.\u4f9b\u5e94\u5546=this.cid,this.formData3.\u4f9b\u5e94\u5546=this.cid;let t=[];t.push(this.loadMap2()),t.push(this.loadMap3()),yield Promise.all(t)}this.openPage(this.view,e)})}reset(){this.formData={id:void 0},this.formData2={"\u4f9b\u5e94\u5546":void 0},this.formData3={"\u4f9b\u5e94\u5546":void 0}}get view(){let{label:e}=this.controller;return()=>s.createElement(o.Page,{header:e},s.createElement(o.Form,{className:"p-3",schema:re,uiSchema:this.uiSchema,formData:this.formData,fieldLabelSize:2,onButtonClick:this.onFormButtonNextClick}))}get view2(){let{label:e}=this.controller;return()=>s.createElement(o.Page,{header:e},s.createElement(o.Form,{ref:e=>this.form2=e,className:"p-3",schema:ne,uiSchema:this.uiSchema2,formData:this.formData2,fieldLabelSize:2,onButtonClick:this.onFormButtonNextClick2}))}get view3(){let{label:e}=this.controller;return()=>s.createElement(o.Page,{header:e},s.createElement(o.Form,{ref:e=>this.form3=e,className:"p-3",schema:ae,uiSchema:this.uiSchema3,formData:this.formData3,fieldLabelSize:2,onButtonClick:this.onFormButtonNextClick3}))}}class le extends l.VTuidSelect{constructor(){super(...arguments),this.onNew=(()=>a.a(this,void 0,void 0,function*(){O("\u4f9b\u5e94\u5546\u4fe1\u606f",this.controller.cUq.cApp)})),this.clickRow=(e=>{this.backPage(),this.returnCall(e)}),this.mainView=Object(b.a)(()=>{let e=s.createElement(U.a,{className:"ml-2",color:"primary",onClick:this.onNew},"\u65b0\u589e"),t=s.createElement(m.SearchBox,{className:"mx-1 w-100",initKey:"",onSearch:this.onSearchMain,placeholder:"\u641c\u7d22"+this.label});return s.createElement(o.Page,{header:"\u9009\u62e9\u4f9b\u5e94\u5546",right:e,back:"close"},t,s.createElement(m.List,{items:this.controller.PageItems.items,item:{render:this.renderMainRow,onClick:this.clickRow},before:"\u641c\u7d22"+this.label+"\u8d44\u6599"}))}),this.divView=(e=>{let t=s.createElement(U.a,{className:"ml-2",color:"primary",onClick:this.onNew},"\u65b0\u589e");return s.createElement(o.Page,{header:"\u9009\u62e9\u4f9b\u5e94\u5546",right:t},s.createElement(m.List,{items:e.items,item:{render:this.renderDivRow,onClick:this.clickDivRow}}))})}open(e){return a.a(this,void 0,void 0,function*(){yield this.showM(e)})}showM(e){return a.a(this,void 0,void 0,function*(){this.mainRowContent=this.ui.rowContent||B.c,yield this.controller.searchMain(""),this.openPage(this.mainView)})}}class ce extends l.VTuidMainList{}class de extends l.VTuidSelect{constructor(){super(...arguments),this.onNew=(()=>a.a(this,void 0,void 0,function*(){O("\u751f\u4ea7\u5382\u5546",this.controller.cUq.cApp)})),this.clickRow=(e=>{this.backPage(),this.returnCall(e)}),this.mainView=Object(b.a)(()=>{let e=s.createElement(U.a,{className:"ml-2",color:"primary",onClick:this.onNew},"\u65b0\u589e"),t=s.createElement(m.SearchBox,{className:"mx-1 w-100",initKey:"",onSearch:this.onSearchMain,placeholder:"\u641c\u7d22"+this.label});return s.createElement(o.Page,{header:"\u9009\u62e9\u751f\u4ea7\u5382\u5546",right:e,back:"close"},t,s.createElement(m.List,{items:this.controller.PageItems.items,item:{render:this.renderMainRow,onClick:this.clickRow},before:"\u641c\u7d22"+this.label+"\u8d44\u6599"}))}),this.divView=(e=>{let t=s.createElement(U.a,{className:"ml-2",color:"primary",onClick:this.onNew},"\u65b0\u589e");return s.createElement(o.Page,{header:"\u9009\u62e9\u751f\u4ea7\u5382\u5546",right:t},s.createElement(m.List,{items:e.items,item:{render:this.renderDivRow,onClick:this.clickDivRow}}))})}open(e){return a.a(this,void 0,void 0,function*(){yield this.showM(e)})}showM(e){return a.a(this,void 0,void 0,function*(){this.mainRowContent=this.ui.rowContent||B.c,yield this.controller.searchMain(""),this.openPage(this.mainView)})}}class he extends l.VTuidSelect{constructor(){super(...arguments),this.onNew=(()=>a.a(this,void 0,void 0,function*(){O("\u804c\u5458\u4fe1\u606f",this.controller.cUq.cApp)})),this.clickRow=(e=>{this.backPage(),this.returnCall(e)}),this.mainView=Object(b.a)(()=>{let e=s.createElement(U.a,{className:"ml-2",color:"primary",onClick:this.onNew},"\u65b0\u589e"),t=s.createElement(m.SearchBox,{className:"mx-1 w-100",initKey:"",onSearch:this.onSearchMain,placeholder:"\u641c\u7d22"+this.label});return s.createElement(o.Page,{header:"\u9009\u62e9\u804c\u5458",right:e,back:"close"},t,s.createElement(m.List,{items:this.controller.PageItems.items,item:{render:this.renderMainRow,onClick:this.clickRow},before:"\u641c\u7d22"+this.label+"\u8d44\u6599"}))}),this.divView=(e=>{let t=s.createElement(U.a,{className:"ml-2",color:"primary",onClick:this.onNew},"\u65b0\u589e");return s.createElement(o.Page,{header:"\u9009\u62e9\u804c\u5458",right:t},s.createElement(m.List,{items:e.items,item:{render:this.renderDivRow,onClick:this.clickDivRow}}))})}open(e){return a.a(this,void 0,void 0,function*(){yield this.showM(e)})}showM(e){return a.a(this,void 0,void 0,function*(){this.mainRowContent=this.ui.rowContent||B.c,yield this.controller.searchMain(""),this.openPage(this.mainView)})}}class ue extends l.VTuidSelect{constructor(){super(...arguments),this.onNew=(()=>a.a(this,void 0,void 0,function*(){O("\u90e8\u95e8\u4fe1\u606f",this.controller.cUq.cApp)})),this.clickRow=(e=>{this.backPage(),this.returnCall(e)}),this.mainView=Object(b.a)(()=>{let e=s.createElement(U.a,{className:"ml-2",color:"primary",onClick:this.onNew},"\u65b0\u589e"),t=s.createElement(m.SearchBox,{className:"mx-1 w-100",initKey:"",onSearch:this.onSearchMain,placeholder:"\u641c\u7d22"+this.label});return s.createElement(o.Page,{header:"\u9009\u62e9\u90e8\u95e8",right:e,back:"close"},t,s.createElement(m.List,{items:this.controller.PageItems.items,item:{render:this.renderMainRow,onClick:this.clickRow},before:"\u641c\u7d22"+this.label+"\u8d44\u6599"}))}),this.divView=(e=>{let t=s.createElement(U.a,{className:"ml-2",color:"primary",onClick:this.onNew},"\u65b0\u589e");return s.createElement(o.Page,{header:"\u9009\u62e9\u90e8\u95e8",right:t},s.createElement(m.List,{items:e.items,item:{render:this.renderDivRow,onClick:this.clickDivRow}}))})}open(e){return a.a(this,void 0,void 0,function*(){yield this.showM(e)})}showM(e){return a.a(this,void 0,void 0,function*(){this.mainRowContent=this.ui.rowContent||B.c,yield this.controller.searchMain(""),this.openPage(this.mainView)})}}class me extends l.VTuidSelect{constructor(){super(...arguments),this.onNew=(()=>a.a(this,void 0,void 0,function*(){O("\u8d27\u4f4d\u4fe1\u606f",this.controller.cUq.cApp)})),this.clickRow=(e=>{this.backPage(),this.returnCall(e)}),this.mainView=Object(b.a)(()=>{let e=s.createElement(U.a,{className:"ml-2",color:"primary",onClick:this.onNew},"\u65b0\u589e"),t=s.createElement(m.SearchBox,{className:"mx-1 w-100",initKey:"",onSearch:this.onSearchMain,placeholder:"\u641c\u7d22"+this.label});return s.createElement(o.Page,{header:"\u9009\u62e9\u8d27\u4f4d",right:e,back:"close"},t,s.createElement(m.List,{items:this.controller.PageItems.items,item:{render:this.renderMainRow,onClick:this.clickRow},before:"\u641c\u7d22"+this.label+"\u8d44\u6599"}))}),this.divView=(e=>{let t=s.createElement(U.a,{className:"ml-2",color:"primary",onClick:this.onNew},"\u65b0\u589e");return s.createElement(o.Page,{header:"\u9009\u62e9\u8d27\u4f4d",right:t},s.createElement(m.List,{items:e.items,item:{render:this.renderDivRow,onClick:this.clickDivRow}}))})}open(e){return a.a(this,void 0,void 0,function*(){yield this.showM(e)})}showM(e){return a.a(this,void 0,void 0,function*(){this.mainRowContent=this.ui.rowContent||B.c,yield this.controller.searchMain(""),this.openPage(this.mainView)})}}class pe extends l.VTuidSelect{constructor(){super(...arguments),this.onNew=(()=>a.a(this,void 0,void 0,function*(){O("\u5e93\u533a\u4fe1\u606f",this.controller.cUq.cApp)})),this.clickRow=(e=>{this.backPage(),this.returnCall(e)}),this.mainView=Object(b.a)(()=>{let e=s.createElement(U.a,{className:"ml-2",color:"primary",onClick:this.onNew},"\u65b0\u589e"),t=s.createElement(m.SearchBox,{className:"mx-1 w-100",initKey:"",onSearch:this.onSearchMain,placeholder:"\u641c\u7d22"+this.label});return s.createElement(o.Page,{header:"\u9009\u62e9\u5e93\u533a",right:e,back:"close"},t,s.createElement(m.List,{items:this.controller.PageItems.items,item:{render:this.renderMainRow,onClick:this.clickRow},before:"\u641c\u7d22"+this.label+"\u8d44\u6599"}))}),this.divView=(e=>{let t=s.createElement(U.a,{className:"ml-2",color:"primary",onClick:this.onNew},"\u65b0\u589e");return s.createElement(o.Page,{header:"\u9009\u62e9\u5e93\u533a",right:t},s.createElement(m.List,{items:e.items,item:{render:this.renderDivRow,onClick:this.clickDivRow}}))})}open(e){return a.a(this,void 0,void 0,function*(){yield this.showM(e)})}showM(e){return a.a(this,void 0,void 0,function*(){this.mainRowContent=this.ui.rowContent||B.c,yield this.controller.searchMain(""),this.openPage(this.mainView)})}}class ve extends l.VTuidSelect{constructor(){super(...arguments),this.onNew=(()=>a.a(this,void 0,void 0,function*(){O("\u7269\u6d41\u4e2d\u5fc3",this.controller.cUq.cApp)})),this.clickRow=(e=>{this.backPage(),this.returnCall(e)}),this.mainView=Object(b.a)(()=>{let e=s.createElement(U.a,{className:"ml-2",color:"primary",onClick:this.onNew},"\u65b0\u589e"),t=s.createElement(m.SearchBox,{className:"mx-1 w-100",initKey:"",onSearch:this.onSearchMain,placeholder:"\u641c\u7d22"+this.label});return s.createElement(o.Page,{header:"\u9009\u62e9\u7269\u6d41\u4e2d\u5fc3",right:e,back:"close"},t,s.createElement(m.List,{items:this.controller.PageItems.items,item:{render:this.renderMainRow,onClick:this.clickRow},before:"\u641c\u7d22"+this.label+"\u8d44\u6599"}))}),this.divView=(e=>{let t=s.createElement(U.a,{className:"ml-2",color:"primary",onClick:this.onNew},"\u65b0\u589e");return s.createElement(o.Page,{header:"\u9009\u62e9\u7269\u6d41\u4e2d\u5fc3",right:t},s.createElement(m.List,{items:e.items,item:{render:this.renderDivRow,onClick:this.clickDivRow}}))})}open(e){return a.a(this,void 0,void 0,function*(){yield this.showM(e)})}showM(e){return a.a(this,void 0,void 0,function*(){this.mainRowContent=this.ui.rowContent||B.c,yield this.controller.searchMain(""),this.openPage(this.mainView)})}}const fe=Object(b.a)(e=>{let t,{id:i,ratio:r,name:n,$owner:a}=e,o=String(r);if(void 0!==a){let e=a.valueFromFieldName("packType");if(void 0!==e){let i=e.valueFromFieldName?e.valueFromFieldName("name"):e.name;i&&(t=n?n+" = "+(o+i):o+i)}}return void 0===t&&(t=(n?n+" "+o:o)+" err: no $owner in values"),s.createElement("div",{className:"px-3 py-2"},t)});var ge={product:{CTuidMain:class extends l.CTuidMain{get VTuidMain(){return j}},CTuidEdit:class extends l.CTuidEdit{constructor(){super(...arguments),this.pickManufactor=((e,t,i)=>a.a(this,void 0,void 0,function*(){let e=this.cUq.cTuidSelectFromName("\u751f\u4ea7\u5382\u5546");return(yield e.call()).id}))}get VTuidEditC(){return W}edit(e){return a.a(this,void 0,void 0,function*(){yield this.openVPage(this.VTuidEditC,e)})}},CTuidSelect:class extends l.CTuidSelect{get VTuidSelect(){return z}},CTuidList:class extends l.CTuidList{get VTuidList(){return K}},content:e=>{let{id:t,"\u540d\u79f0":i,"\u7f16\u7801":r}=e;return s.createElement(s.Fragment,null,i||"id "+t+" ...")},rowContent:Object(b.a)(e=>{let t,{id:i,"\u540d\u79f0":r,"\u7f16\u7801":n,packType:a}=e,o="id "+i;return a&&a.content&&(t=s.createElement(m.Muted,null,Object(l.tv)(a))),s.createElement(m.LMR,{className:"px-3 py-2",left:r+" "+n,right:o})}),divs:{packtype:{content:Object(b.a)(e=>{let{id:t,ratio:i,name:r,$owner:n}=e;if(void 0===n)return s.createElement(s.Fragment,null,r||i||"id"+t+" ...");let a=n.valueFromFieldName("packType");return s.createElement(s.Fragment,null,r||i+(a&&a.name)||"id"+t+" ...")}),rowContent:fe}},form:{items:{packType:{autoList:!0},pack:{rowContent:fe}}}},packType:{CTuidMain:class extends l.CTuidMain{get VTuidMain(){return G}},CTuidSelect:class extends l.CTuidSelect{get VTuidSelect(){return Q}},content:e=>{let{id:t,name:i,discription:r}=e;return s.createElement(s.Fragment,null,i||r||"id "+t+" ...")},rowContent:e=>{let{name:t,discription:i}=e,r=s.createElement(m.Muted,null,i);return s.createElement(m.LMR,{className:"px-3 py-2",left:t,right:r})},divs:{packtype:{content:e=>{let{id:t,name:i,discription:r}=e;return s.createElement(s.Fragment,null,i||r||"id "+t+" ...")},rowContent:e=>{let{name:t,discription:i}=e,r=s.createElement(m.Muted,null,i);return s.createElement(m.LMR,{className:"px-3 py-2",left:t,right:r})}}}},"\u751f\u4ea7\u5382\u5546":{CTuidSelect:class extends l.CTuidSelect{get VTuidSelect(){return de}},content:e=>{let{id:t,"\u540d\u79f0":i}=e;return s.createElement(s.Fragment,null,i||"id "+t+" ...")},rowContent:e=>{let{"\u540d\u79f0":t,id:i}=e,r=(s.createElement(m.Muted,null),s.createElement(s.Fragment,null,"id "+i));return s.createElement(m.LMR,{className:"px-3 py-2",left:t,right:r})}},"\u5ba2\u6237\u4fe1\u606f":{CTuidMain:class extends l.CTuidMain{get VTuidMain(){return J}},CTuidSelect:class extends l.CTuidSelect{get VTuidSelect(){return te}},CTuidEdit:class extends l.CTuidEdit{get VTuidEdit(){return ee}},CTuidList:class extends l.CTuidList{get VTuidList(){return ie}},content:e=>{let{id:t,"\u540d\u79f0":i,"\u7f16\u7801":r}=e;return s.createElement(s.Fragment,null,i||"id "+t+" "+r+" ...")},rowContent:e=>{let{id:t,"\u540d\u79f0":i,"\u7f16\u7801":r}=e,n=s.createElement(m.Muted,null,"id "+t);return s.createElement(m.LMR,{className:"px-3 py-2",left:i+" "+r,right:n})}},"\u4f9b\u5e94\u5546\u4fe1\u606f":{CTuidMain:class extends l.CTuidMain{get VTuidMain(){return se}},CTuidSelect:class extends l.CTuidSelect{get VTuidSelect(){return le}},CTuidEdit:class extends l.CTuidEdit{get VTuidEdit(){return oe}},CTuidList:class extends l.CTuidList{get VTuidList(){return ce}},content:e=>{let{id:t,"\u540d\u79f0":i,"\u7f16\u7801":r}=e;return s.createElement(s.Fragment,null,i||"id "+t+" "+r+" ...")},rowContent:e=>{let{id:t,"\u540d\u79f0":i,"\u7f16\u7801":r}=e,n=s.createElement(m.Muted,null,"id "+t);return s.createElement(m.LMR,{className:"px-3 py-2",left:i+" "+r,right:n})}},"\u804c\u5458\u4fe1\u606f":{CTuidSelect:class extends l.CTuidSelect{get VTuidSelect(){return he}},content:e=>{let{id:t,"\u540d\u79f0":i,"\u7f16\u7801":r}=e;return s.createElement(s.Fragment,null,i||"id "+t+" "+r+" ...")},rowContent:e=>{let{"\u540d\u79f0":t,"\u7f16\u7801":i,id:r}=e,n=(s.createElement(m.Muted,null),s.createElement(s.Fragment,null,"id "+r));return s.createElement(m.LMR,{className:"px-3 py-2",left:t+" "+i,right:n})}},"\u90e8\u95e8\u4fe1\u606f":{CTuidSelect:class extends l.CTuidSelect{get VTuidSelect(){return ue}},content:e=>{let{id:t,"\u540d\u79f0":i,"\u7f16\u7801":r}=e;return s.createElement(s.Fragment,null,i||"id "+t+" "+r+" ...")},rowContent:e=>{let{id:t,"\u540d\u79f0":i,"\u7f16\u7801":r}=e,n=(s.createElement(m.Muted,null),s.createElement(s.Fragment,null,"id "+t));return s.createElement(m.LMR,{className:"px-3 py-2",left:i+" "+r,right:n})}},"\u7269\u6d41\u4e2d\u5fc3":{CTuidSelect:class extends l.CTuidSelect{get VTuidSelect(){return ve}},content:e=>{let{id:t,"\u540d\u79f0":i,"\u7f16\u7801":r}=e;return s.createElement(s.Fragment,null,i||"id "+t+" "+r+" ...")},rowContent:e=>{let{"\u540d\u79f0":t,"\u7f16\u7801":i,id:r}=e,n=(s.createElement(m.Muted,null),s.createElement(s.Fragment,null,"id "+r));return s.createElement(m.LMR,{className:"px-3 py-2",left:t+" "+i,right:n})}},"\u8d27\u4f4d\u4fe1\u606f":{CTuidSelect:class extends l.CTuidSelect{get VTuidSelect(){return me}},content:e=>{let{id:t,"\u540d\u79f0":i,"\u7f16\u7801":r}=e;return s.createElement(s.Fragment,null,i||"id "+t+" "+r+" ...")},rowContent:e=>{let{id:t,"\u540d\u79f0":i,"\u7f16\u7801":r}=e,n=(s.createElement(m.Muted,null),s.createElement(s.Fragment,null,"id "+t));return s.createElement(m.LMR,{className:"px-3 py-2",left:i+" "+r,right:n})}},"\u5e93\u533a\u4fe1\u606f":{CTuidSelect:class extends l.CTuidSelect{get VTuidSelect(){return pe}},content:e=>{let{id:t,"\u540d\u79f0":i,"\u7f16\u7801":r}=e;return s.createElement(s.Fragment,null,i||"id "+t+" "+r+" ...")},rowContent:e=>{let{id:t,"\u540d\u79f0":i,"\u7f16\u7801":r}=e,n=(s.createElement(m.Muted,null),s.createElement(s.Fragment,null,"id "+t));return s.createElement(m.LMR,{className:"px-3 py-2",left:i+" "+r,right:n})}}},be=i(9);var ye={zh:{CN:{x:{no:"\u7f16\u53f7",team:"\u90e8\u95e8",staff:"\u5458\u5de5",noStaff:"\u65e0\u5458\u5de5",post:"\u804c\u4f4d",noPost:"\u65e0\u804c\u4f4d",a:"aaa",b:{s:"sss",d:()=>r.a.createElement("span",{className:"text-success"},"ddd")},c:()=>r.a.createElement("span",{className:"text-danger"},"ccc")},none:"\u65e0",usq:"scmbasedata",tuid:"\u57fa\u7840\u6863\u6848",map:"\u5bf9\u7167\u8868",tuidPlaceHolder:"\u9009\u62e9",sheet:"\u5355\u636e",history:"\u6d41\u6c34\u8d26",submit:"\u63d0\u4ea4",arrNew:"\u65b0\u589e",arrEdit:"\u4fdd\u5b58",entity:{product:{label:"\u5546\u54c1\u4fe1\u606f",fields:{discription:"\u540d\u79f0",packType:"\u8ba1\u91cf\u7c7b\u578b"},arrs:{pack:{label:"\u5305\u88c5\u5355\u4f4d",fields:{ratio:"\u6362\u7b97\u7387(\u76f8\u5bf9\u57fa\u672c\u5355\u4f4d)",name:"\u540d\u79f0"}}}},packtype:{label:"\u8ba1\u91cf\u7c7b\u578b",fields:{name:"\u8ba1\u91cf\u5355\u4f4d(\u5982 g,ml,\u53f0,\u4e2a)",discription:"\u8ba1\u91cf\u7c7b\u578b(\u5982 \u91cd\u91cf\uff0c\u957f\u5ea6,\u5355\u4f53)"}},price:{label:"\u4ef7\u683c\u8868"},message:{label:"\u6d88\u606f-message",arrNew:"\u65b0\u589e\u6d88\u606f",arrEdit:"\u4fdd\u5b58\u6d88\u606f",fields:{fromUser:"\u53d1\u9001\u4eba",fromUnit:"\u53d1\u9001\u90e8\u95e8",type:"\u7c7b\u578b",date:"\u65e5\u671f",subject:"\u4e3b\u9898",discription:"\u63cf\u8ff0",content:"\u5185\u5bb9"}},getMessage:{label:"\u83b7\u53d6Message",submit:"\u83b7\u53d6\u6d88\u606f",fields:{msg:"\u6d88\u606f"}},newMessage:{label:"\u65b0\u5efa\u6d88\u606f",fields:{type:"\u7c7b\u578b",subject:"\u4e3b\u9898"},arrs:{to:{label:"\u53d1\u9001",newSubmit:"\u65b0\u589eto",editSumbit:"\u4fdd\u5b58to"},cc:{label:"\u6284\u9001",newSubmit:"\u65b0\u589ecc",editSumbit:"\u4fdd\u5b58cc"}}},teamPerson:{label:"\u90e8\u95e8\u5458\u5de5\u804c\u4f4d",fields:{},confirmDelete:i.n(be).a.template("\u771f\u7684\u8981\u5220\u9664${label}\u5417")},user:{label:"\u7528\u6237"}}}}},we=i(5),Ee=i.n(we),Ce=i(18);const xe=[{name:"\u4f9b\u8d27\u8005",type:"id",required:!0},{name:"\u516c\u53f8\u673a\u6784",type:"string",required:!1,maxLength:100},{name:"\u5408\u540c\u5355\u53f7",type:"string",required:!1,maxLength:100},{name:"\u65e5\u671f",type:"date",required:!1},{name:"\u7269\u6d41\u4e2d\u5fc3",type:"id",required:!1},{name:"\u9001\u8d27\u4eba",type:"string",required:!1,maxLength:100},{name:"\u662f\u5426\u7a7a\u5165",type:"string",maxLength:10},{name:"\u5355\u53f7",type:"string",required:!1,maxLength:100},{name:"\u968f\u8d27\u540c\u884c\u5355\u53f7",type:"string",required:!1,maxLength:100},{name:"\u627f\u8fd0\u65b9\u5f0f",type:"string",required:!1,maxLength:100},{name:"\u59d4\u6258\u8fd0\u8f93\u5355\u53f7",type:"string",required:!1,maxLength:100},{name:"\u53d1\u8fd0\u5730\u70b9",type:"string",required:!1,maxLength:100},{name:"\u8fd0\u8f93\u5355\u4f4d",type:"string",required:!1,maxLength:100},{name:"\u8fd0\u8f93\u65b9\u5f0f",type:"string",required:!1,maxLength:100},{name:"\u8fd0\u8f93\u5de5\u5177",type:"string",required:!1,maxLength:100},{name:"\u8fd0\u8f93\u72b6\u6001",type:"string",required:!1,maxLength:100},{name:"\u8fd0\u8f93\u8f66\u724c\u53f7",type:"string",required:!1,maxLength:100},{name:"\u6e29\u63a7\u65b9\u5f0f",type:"string",required:!1,maxLength:100},{name:"\u6e29\u63a7\u72b6\u6001",type:"string",required:!1,maxLength:100},{name:"\u542f\u8fd0\u6e29\u5ea6",type:"number"},{name:"\u5230\u8d27\u6e29\u5ea6",type:"number"},{name:"\u542f\u8fd0\u65f6\u95f4",type:"date",required:!1},{name:"\u9884\u5230\u8d27\u65f6\u95f4",type:"date",required:!1},{name:"\u5230\u8d27\u65f6\u95f4",type:"date",required:!1},{name:"products",type:"arr",arr:[{name:"product",type:"id",required:!0},{name:"\u4ef7\u683c",type:"number",required:!0},{name:"\u6570\u91cf",type:"number",required:!0},{name:"\u91d1\u989d",type:"number",required:!0}]},{name:"submit",type:"submit"}];var ke={appName:"bruce/SCMBase",CApp:class extends l.CApp{internalStart(){return a.a(this,void 0,void 0,function*(){this.isLogined,this.cFunctionCategory=new D(this,void 0),this.cHome=new E(this,void 0);let e=[];e.push(this.cFunctionCategory.start()),yield Promise.all(e),this.showMain()})}showMain(e){this.openVPage(this.VAppMain,e)}showOneVPage(e,t){return a.a(this,void 0,void 0,function*(){yield new e(this).open(t)})}onDispose(){}},main:class extends o.VPage{constructor(){super(...arguments),this.render=(e=>{let{cHome:t}=this.controller,i=[{name:"home",label:"\u9996\u9875",icon:"home",content:t.tab,notify:void 0},{name:"me",label:"\u6211\u7684",icon:"user",content:h}].map(e=>{let{name:t,label:i,icon:s,content:r,notify:n}=e;return{name:t,caption:e=>Object(o.TabCaptionComponent)(i,s,u(e)),content:r,notify:n}});return s.createElement(o.Page,{header:!1},s.createElement(o.Tabs,{tabs:i}))})}open(e){return a.a(this,void 0,void 0,function*(){this.openPage(this.render)})}},uqs:{"bruce/scmbasedata":{tuid:ge,sheet:{"\u91c7\u8d2d\u6536\u8d27":{CSheet:class extends l.CSheet{},main:class extends l.VEntity{constructor(){super(...arguments),this.newClick=(()=>this.event("new")),this.schemaClick=(()=>this.event("schema")),this.archivesClick=(()=>this.event("archives")),this.sheetStateClick=(e=>this.event("state",e)),this.renderState=((e,t)=>{let{state:i,count:r}=e;if(0===r)return null;let n=s.createElement("span",{className:"badge badge-success ml-5 align-self-end"},r);return s.createElement(m.LMR,{className:"px-3 py-2",left:this.controller.getStateLabel(i),right:n})}),this.view=Object(b.a)(()=>{let e,t=this.controller.statesCount.filter(e=>e.count),i=s.createElement("button",{className:"btn btn-outline-primary",onClick:this.archivesClick},"\u5df2\u5f52\u6863");return!0===this.isDev&&(e=s.createElement("button",{className:"btn btn-primary mr-2",color:"primary",onClick:this.schemaClick},"\u6a21\u677f")),s.createElement(o.Page,{header:this.label},s.createElement(m.LMR,{className:"mx-3 my-2",right:i},s.createElement("button",{className:"btn btn-primary mr-2",color:"primary",onClick:this.newClick},"\u65b0\u5efa"),e),s.createElement(m.List,{className:"my-2",header:s.createElement(m.Muted,{className:"mx-3 my-1"},"\u5f85\u5904\u7406",this.label),none:"[ \u65e0 ]",items:t,item:{render:this.renderState,onClick:this.sheetStateClick}}))})}open(){return a.a(this,void 0,void 0,function*(){this.openPage(this.view)})}},sheetNew:class extends l.VEntity{constructor(){super(...arguments),this.formData={"\u5355\u53f7":void 0},this.ArrContainer=((e,t)=>s.createElement("div",null,s.createElement("div",{className:Ee()("small text-muted text-center bg-light py-1 px-3 mt-4 mb-1")},e),t)),this.uiSchema={items:{"\u4f9b\u8d27\u8005":{widget:"id"},"\u516c\u53f8\u673a\u6784":{widget:"text"},"\u5408\u540c\u5355\u53f7":{widget:"text"},"\u65e5\u671f":{widget:"text"},"\u7269\u6d41\u4e2d\u5fc3":{widget:"id"},"\u9001\u8d27\u4eba":{widget:"text"},"\u662f\u5426\u7a7a\u5165":{widget:"text"},"\u5355\u53f7":{widget:"text"},"\u968f\u8d27\u540c\u884c\u5355\u53f7":{widget:"text"},"\u627f\u8fd0\u65b9\u5f0f":{widget:"text"},"\u59d4\u6258\u8fd0\u8f93\u5355\u53f7":{widget:"text"},"\u53d1\u8fd0\u5730\u70b9":{widget:"text"},"\u8fd0\u8f93\u5355\u4f4d":{widget:"text"},"\u8fd0\u8f93\u65b9\u5f0f":{widget:"text"},"\u8fd0\u8f93\u5de5\u5177":{widget:"text"},"\u8fd0\u8f93\u72b6\u6001":{widget:"text"},"\u8fd0\u8f93\u8f66\u724c\u53f7":{widget:"text"},"\u6e29\u63a7\u65b9\u5f0f":{widget:"text"},"\u6e29\u63a7\u72b6\u6001":{widget:"text"},"\u542f\u8fd0\u6e29\u5ea6":{widget:"custom",WidgetClass:Ce.a},"\u5230\u8d27\u6e29\u5ea6":{widget:"custom",WidgetClass:Ce.a},"\u542f\u8fd0\u65f6\u95f4":{widget:"date"},"\u5230\u8d27\u65f6\u95f4":{widget:"date"},submit:{widget:"button",className:"btn btn-primary",Templet:s.createElement(s.Fragment,null,s.createElement("i",{className:"fa"}),"\xa0\u786e\u5b9a\xa0")},products:{widget:"arr",items:{product:{widget:"id",readOnly:!0},"\u4ef7\u683c":{widget:"custom",readOnly:!0,WidgetClass:Ce.a},"\u6570\u91cf":{widget:"custom",readOnly:!0,WidgetClass:Ce.a},"\u91d1\u989d":{widget:"custom",readOnly:!0,WidgetClass:Ce.a}},label:"\u5546\u54c1",Templet:()=>s.createElement("div",{className:"form-inline"},s.createElement(o.Field,{name:"product"}),s.createElement(o.Field,{name:"\u4ef7\u683c"}),s.createElement(o.Field,{name:"\u6570\u91cf"}),s.createElement(o.Field,{name:"\u91d1\u989d"})),ArrContainer:this.ArrContainer}}},this.onFormButtonNextClick=((e,t)=>a.a(this,void 0,void 0,function*(){})),this.rowPurchaseClick=(e=>a.a(this,void 0,void 0,function*(){let t=(yield this.controllerPurchase.getSheetData(e.id)).data;this.formData.\u5355\u53f7=e.no,this.formData["\u4f9b\u8d27\u8005"]=t.\u4f9b\u8d27\u8005.id,this.formData["\u5408\u540c\u5355\u53f7"]=t.\u5408\u540c\u53f7;let i=[];t.products&&t.products.forEach((e,t)=>{let s=e;s.product=e.product.id,i.push(s)}),this.formData.products=i,this.openPage(this.view)})),this.onScrollBottomSelectPurchase=(()=>{console.log("onScrollBottom"),this.controllerPurchase.pageStateItems.more()}),this.rowContentSelectPurchase=(e=>{let{id:t,no:i,discription:r,date:n,processing:a}=e,o=s.createElement(s.Fragment,null,i," \xa0 ",s.createElement(m.Muted,null,r)," ",1===a?"...":""),l=s.createElement(m.Muted,null,s.createElement(m.EasyDate,{date:n}));return s.createElement(m.LMR,{className:"px-3 py-2",left:o,right:l})}),this.renderRowSelectPurchase=((e,t)=>s.createElement(this.row,Object.assign({},e))),this.viewSelectPurchase=(()=>{let{pageStateItems:e}=this.controllerPurchase;return s.createElement(o.Page,{header:this.label+" - "+this.stateLabel,onScrollBottom:this.onScrollBottomSelectPurchase},s.createElement(s.Fragment,null,"\u9009\u62e9\u91c7\u8d2d\u8ba2\u5355"),s.createElement(m.List,{items:e,item:{render:this.renderRowSelectPurchase,onClick:this.rowPurchaseClick}}))})}open(e){return a.a(this,void 0,void 0,function*(){this.row=this.rowContentSelectPurchase,this.stateName="$",this.controllerPurchase=this.controller.cUq.cSheetFromName("\u91c7\u8d2d\u8ba2\u5355"),this.stateLabel=this.controllerPurchase.getStateLabel(this.stateName),this.controllerPurchase.pageStateItems=this.controllerPurchase.entity.createPageStateItems(),yield this.controllerPurchase.pageStateItems.first(this.stateName),this.openPage(this.viewSelectPurchase)})}get view(){let{label:e}=this.controller;return()=>s.createElement(o.Page,{header:e},s.createElement(o.Form,{className:"p-3",schema:xe,uiSchema:this.uiSchema,formData:this.formData,fieldLabelSize:2,onButtonClick:this.onFormButtonNextClick}))}get viewGetSheetNo(){return()=>s.createElement(o.Page,{header:"\u91c7\u8d2d\u6536\u8d27 \u65b0\u5f00"},s.createElement(o.Form,{className:"p-3",schema:xe,uiSchema:this.uiSchema,formData:this.formData,fieldLabelSize:2,onButtonClick:this.onFormButtonNextClick}))}openSelectPurchase(e){return a.a(this,void 0,void 0,function*(){this.row=this.rowContentSelectPurchase,this.stateName="$",this.controllerPurchase=this.controller.cUq.cSheetFromName("\u91c7\u8d2d\u8ba2\u5355"),this.stateLabel=this.controllerPurchase.getStateLabel(this.stateName),yield this.controllerPurchase.pageStateItems.first(this.stateName),this.openPage(this.viewSelectPurchase)})}}}},res:ye}}};var Ne=class extends s.Component{constructor(){super(...arguments),this.onLogined=(()=>a.a(this,void 0,void 0,function*(){yield Object(l.startApp)(ke)}))}render(){return s.createElement(o.NavView,{onLogined:this.onLogined})}};i(129);const Se=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Fe(e){navigator.serviceWorker.register(e).then(e=>{e.onupdatefound=(()=>{const t=e.installing;t&&(t.onstatechange=(()=>{"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}))})}).catch(e=>{console.error("Error during service worker registration:",e)})}n.render(s.createElement(Ne,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL(".",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",()=>{const e="./service-worker.js";Se?(function(e){fetch(e).then(t=>{404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(e=>{e.unregister().then(()=>{window.location.reload()})}):Fe(e)}).catch(()=>{console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(()=>{console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):Fe(e)})}}()}],[[99,5,4]]]);
//# sourceMappingURL=main.63cbab18.chunk.js.map